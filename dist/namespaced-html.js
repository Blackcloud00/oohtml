(()=>{var Ke=Object.defineProperty;var et=(n,e,r)=>e in n?Ke(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var se=(n,e,r)=>(et(n,typeof e!="symbol"?e+"":e,r),r);function C(n){return!Array.isArray(n)&&typeof n=="object"&&n}function x(n){return Array.isArray(n)}function me(n,e,r=null){return x(e)?n.filter(t=>r?e.filter(i=>r(t,i)).length:e.indexOf(t)!==-1):[]}function U(n,...e){if(globalThis.webqit||(globalThis.webqit={}),globalThis.webqit.refs||Object.defineProperty(globalThis.webqit,"refs",{value:new Y}),!arguments.length)return globalThis.webqit.refs;let r=globalThis.webqit.refs.get(n);r||(r=new Y,globalThis.webqit.refs.set(n,r));let t,i;for(;t=e.shift();)(i=r)&&!(r=r.get(t))&&(r=new Y,i.set(t,r));return r}var Y=class extends Map{constructor(...e){super(...e),this.observers=new Set}set(e,r){let t=super.set(e,r);return this.fire("set",e,r,e),t}delete(e){let r=super.delete(e);return this.fire("delete",e),r}has(e){return this.fire("has",e),super.has(e)}get(e){return this.fire("get",e),super.get(e)}keyNames(){return Array.from(super.keys())}observe(e,r,t){let i={type:e,key:r,callback:t};return this.observers.add(i),()=>this.observers.delete(i)}unobserve(e,r,t){if(Array.isArray(e)||Array.isArray(r))throw new Error('The "type" and "key" arguments can only be strings.');for(let i of this.observers)!(fe([e,"*"],i.type)&&fe([r,"*"],i.key)&&i.callback===t)||this.observers.delete(i)}fire(e,r,...t){for(let i of this.observers)!(fe([e,"*"],i.type)&&fe([r,"*"],i.key))||i.callback(...t)}},fe=(n,e)=>Array.isArray(e)?me(n,e).length:n.includes(e);function G(n){return typeof n=="function"}function Q(n){return n===null||n===""}function W(n){return arguments.length&&(n===void 0||typeof n>"u")}function q(n){return Array.isArray(n)||typeof n=="object"&&n||G(n)}function de(n){return Q(n)||W(n)||n===!1||n===0||q(n)&&!Object.keys(n).length}function E(n){return G(n)||n&&{}.toString.call(n)==="[object function]"}function Z(n){return n instanceof Number||typeof n=="number"}function M(n){return Z(n)||n!==!0&&n!==!1&&n!==null&&n!==""&&!isNaN(n*1)}function X(n){return n instanceof String||typeof n=="string"&&n!==null}function pe(n){return!X(n)&&!W(n.length)}function le(n,...e){return e.forEach(r=>{n.indexOf(r)<0&&n.push(r)}),n}function he(t,e){e=e||Object.prototype,e=e&&!x(e)?[e]:e;for(var r=[],t=t;t&&(!e||e.indexOf(t)<0)&&t.name!=="default";)r.push(t),t=t?Object.getPrototypeOf(t):null;return r}function ge(n,e){var r=[];return he(n,e).forEach(t=>{le(r,...Object.getOwnPropertyNames(t))}),r}function k(n,e,r=!1,t=!1,i=!1){var o=0,s=n.shift();if((M(s)||s===!0||s===!1)&&(o=s,s=n.shift()),!n.length)throw new Error("_merge() requires two or more array/objects.");return n.forEach((f,m)=>{!q(f)&&!E(f)||(r?ge(f):Object.keys(f)).forEach(p=>{if(!!e(p,s,f,m)){var c=s[p],u=f[p];if((x(c)&&x(u)||C(c)&&C(u))&&(o===!0||o>0))s[p]=x(c)&&x(u)?[]:{},k([M(o)?o-1:o,s[p],c,u],e,r,t,i);else if(x(s)&&x(f))t?s[p]=u:s.push(u);else try{i?Object.defineProperty(s,p,Object.getOwnPropertyDescriptor(f,p)):s[p]=f[p]}catch{}}})}),s}function K(...n){return k(n,(e,r,t)=>!0,!1,!1,!1)}function I(n,e=!0){return x(n)?n:!e&&C(n)?[n]:n!==!1&&n!==0&&de(n)?[]:pe(n)?Array.prototype.slice.call(n):C(n)?Object.values(n):[n]}function ee(n,e,r={},t={}){e=I(e).slice();for(var i=n;!W(i)&&!Q(i)&&e.length;){var o=e.shift();if(!(r.get?r.get(i,o):q(i)?o in i:i[o])){t.exists=!1;return}i=r.get?r.get(i,o):i[o]}return t.exists=!0,i}function _e(n,e,r,t={},i={}){let o=(c,u,a)=>i.set?i.set(c,u,a):(M(e[f])&&x(c)?c.push(a):c[u]=a,!0);e=I(e);for(var s=n,f=0;f<e.length;f++)if(f<e.length-1){if(!s||!q(s)&&!E(s))return!1;var m=ee(s,e[f],i);if(!q(m)){if(i.buildTree===!1)return!1;m=E(i.buildTree)?i.buildTree(f):M(e[f+1])?[]:{};var p=o(s,e[f],m);if(!p)return!1}s=m}else return o(s,e[f],r)}var te=class{constructor(e,r=!1){Object.defineProperty(this,"window",{value:e}),Object.defineProperty(this,"readCallbacks",{value:new Set}),Object.defineProperty(this,"writeCallbacks",{value:new Set}),Object.defineProperty(this,"_synthesis",{value:0,writable:!0}),!r&&this.window.requestAnimationFrame?this._loop():this._synthesis++}get synthesis(){return this._synthesis}async synthesizeWhile(e){this._synthesis++,this._fulfill();let r=await e();return this._synthesis--,r}_fulfill(){for(let e of this.readCallbacks)e(),this.readCallbacks.delete(e);for(let e of this.writeCallbacks)e(),this.writeCallbacks.delete(e)}_loop(){this.window.requestAnimationFrame(()=>{this._fulfill(),this._loop()})}onread(e,r=!1){if(r)return new Promise(t=>{this.synthesis?t(e()):this.readCallbacks.add(()=>{t(e())})});this.synthesis?Promise.resolve().then(e):this.readCallbacks.add(e)}onwrite(e,r=!1){if(r)return new Promise(t=>{this.synthesis?t(e()):this.writeCallbacks.add(()=>{t(e())})});this.synthesis?Promise.resolve().then(e):this.writeCallbacks.add(e)}cycle(e,r,t){this.onread(()=>{let i=e(t),o=s=>{s!==void 0&&this.onwrite(()=>{let f=r(s,t),m=p=>{p!==void 0&&this.cycle(e,r,p)};f instanceof Promise?f.then(m):m(f)})};i instanceof Promise?i.then(o):o(i)})}};function Ie(n){return(n=n.trim())&&n.startsWith("(")&&n.endsWith(")")}function ae(n,e,r,t=!0){r=(Array.isArray(r)?r:[r]).map(s=>(s+"").replace("(",t?"(.//":"(./")).join("|");let i=[],o;try{let s=n.document.evaluate(r,e,null,XPathResult.ANY_TYPE);for(;o=s.iterateNext();)i.push(o)}catch{}return i}function Me(n,e,r){r=(Array.isArray(r)?r:[r]).map(t=>(t+"").replace("(","(self::")).join("|");try{return n.document.evaluate(`${r}`,e,null,XPathResult.BOOLEAN_TYPE).booleanValue}catch{}}function je(n,e="|"){return[...n].reduce(([r,t,i,o],s)=>!r&&t===0&&(Array.isArray(e)?e:[e]).includes(s)?[r,t,[""].concat(i)]:(!r&&["(","[","{"].includes(s)&&!i[0].endsWith("\\")&&t++,!r&&[")","]","}"].includes(s)&&!i[0].endsWith("\\")&&t--,['"',"'","`"].includes(s)&&!i[0].endsWith("\\")&&(r=r===s?null:r||s),i[0]+=s,[r,t,i]),[null,0,[""]])[2].reverse()}var j=class{constructor(e){this.content=e,this.type=typeof e=="string"?"selector":"instance",this.kind=this.type==="instance"?null:Ie(e)?"xpath":"css",this.kind==="xpath"&&(this.isXpathAttr=je(e.trim().slice(1,-1),"@").length>1)}toString(){return this.content}};var V=class{constructor(e,r,t){this.context=e,this.namespace=r,this.window=e.defaultView||e.ownerDocument?.defaultView||t,this.document=this.window.document,this.webqit=this.window.webqit,Object.defineProperty(this,"#",{value:{}})}resolveArgs(e){if(E(e[0])?e=[[],...e]:C(e[0])&&!(e[0]instanceof j)&&e.length===1?e=[[],void 0,e[0]]:C(e[1])&&e.length===2?e=[I(e[0],!1),void 0,e[1]]:e[0]=I(e[0],!1),e[0].filter(r=>typeof r!="string"&&!(r instanceof j)&&!(r instanceof this.window.Node)).length)throw new Error("Argument #2 must be either a string or a Node object, or a list of those.");return e[0]=e[0].map(r=>r instanceof j?r:new j(r)),e}registry(...e){return U("realdom.realtime",this.window,this.namespace,...e)}createSignalGenerator(){return{generate(){return this.lastController?.abort(),this.lastController=new AbortController,{signal:this.lastController.signal}},disconnect(){this.lastController?.abort()}}}forEachMatchingContext(e,r,t){let{window:i}=this,o=Array.isArray(r)?r:[r],s=new Set;for(let[f,m]of this.registry(e))for(let[p,c]of m){let u=o.filter(a=>p.contains(a.target)?f==="subtree"||a.target===p:!1);if(!!u.length){Array.isArray(r)||(u=u[0]);for(let a of c)s.add([a,u,p])}}for(let[f,m,p]of s)t.call(i,f,m,p)}disconnectables(e,...r){let t={disconnect(){r.forEach(i=>i&&E(i.disconnect)&&i.disconnect()||E(i)&&i()||C(i)&&(i.disconnected=!0))}};return e&&e.addEventListener("abort",()=>t.disconnect()),t}};var N=class extends V{constructor(e,...r){super(e,"attr",...r)}get(e,r=void 0,t={}){let i=typeof e=="string"||e instanceof j;[e=[],r=void 0,t={}]=this.resolveArgs(arguments);let{context:o}=this,s=He(o,e);if(!r)return s;let f=t.lifecycleSignals&&this.createSignalGenerator();if(i)for(let m of s){let p=f?.generate()||{};r(m,p,o)}else{let m=f?.generate()||{};r(s,m,o)}if(t.live){f&&(t={...t,signalGenerator:f});let m=this.observe(i?e[0]:e,r,{newValue:!0,...t});return this.disconnectables(t.signal,m)}}observe(e,r,t={}){let i=typeof e=="string"||e instanceof j;if([e=[],r,t={}]=this.resolveArgs(arguments),["sync","intercept"].includes(t.timing))return this.observeSync(i?e[0]:e,r,t);if(t.timing&&t.timing!=="async")throw new Error(`Timing option "${t.timing}" invalid.`);let{context:o,window:s,webqit:f}=this;t.eventDetails&&!f.realdom.attrInterceptionHooks?.intercepting&&Le.call(s,"intercept",()=>{});let m=new s.MutationObserver(a=>{a=De(a).map(h=>Fe.call(s,h)),ke.call(s,u,a,o)}),p={attributes:!0,attributeOldValue:t.oldValue,subtree:t.subtree};e.length&&(p.attributeFilter=e.map(a=>a+"")),m.observe(o,p);let c=t.signalGenerator||t.lifecycleSignals&&this.createSignalGenerator(),u={context:o,spec:e,callback:r,params:t,atomics:new Map,originalFilterIsString:i,signalGenerator:c,disconnectable:m};return this.disconnectables(t.signal,m,c)}observeSync(e,r,t={}){let i=typeof e=="string"||e instanceof j;[e,r,t={}]=this.resolveArgs(arguments);let{context:o,window:s}=this;if(t.timing&&!["sync","intercept"].includes(t.timing))throw new Error(`Timing option "${t.timing}" invalid.`);let f=t.timing==="intercept"?"intercept":"sync",m=t.subtree?"subtree":"children";this.registry(f).size||Le.call(s,f,_=>{this.forEachMatchingContext(f,_,ke)});let p={disconnect(){h.delete(u),h.size||a.delete(o)}},c=t.signalGenerator||t.lifecycleSignals&&this.createSignalGenerator(),u={context:o,spec:e,callback:r,params:t,atomics:new Map,originalFilterIsString:i,signalGenerator:c,disconnectable:p},a=this.registry(f,m);a.has(o)||a.set(o,new Set);let h=a.get(o);return h.add(u),this.disconnectables(t.signal,p,c)}};function De(n){return n.reduce((e,r,t)=>e[t-1]?.attributeName===r.attributeName?e:e.concat(r),[])}function ke(n,e){let{context:r,spec:t,callback:i,params:o,atomics:s,originalFilterIsString:f,signalGenerator:m}=n,p=t.map(a=>a+"");if(o.atomic&&!s.size?e=He(r,t,e):o.timing!=="async"&&t.length&&(e=e.filter(a=>p.includes(a.name))),!e.length)return;o.newValue===null&&o.oldValue===null&&o.eventDetails||(e=e.map(a=>{let h;return o.eventDetails||({event:h,...a}=a),!o.oldValue&&"oldValue"in a&&({oldValue:h,...a}=a),!o.newValue&&"value"in a?{value:h,...a}=a:o.newValue&&typeof a.value>"u"&&(a={...a,value:a.target.getAttribute(a.name)}),a})),o.atomic&&(e.forEach(a=>s.set(a.name,a)),e=Array.from(s.entries()).map(([,a])=>a));let c=f?e[0]:e,u=m?.generate()||{};i(c,u,r)}function He(n,e,r=[]){let t={event:null,type:"attribute"};return e.length?e.map(o=>(o=o+"",r.find(s=>s.name===o)||{target:n,name:o,value:n.getAttribute(o),...t})):Array.from(n.attributes).map(o=>r.find(s=>s.name===o.nodeName)||{target:n,name:o.nodeName,value:o.nodeValue,...t})}function Fe({target:n,attributeName:e,value:r,oldValue:t}){let s=(this.webqit.realdom.attrInterceptionRecords?.get(n)||{})[e]?.[0]||"mutation";return{target:n,name:e,value:r,oldValue:t,type:"observation",event:s}}function Le(n,e){let r=this,{webqit:t,document:i,Element:o}=r;t.realdom.attrInterceptionHooks||Object.defineProperty(t.realdom,"attrInterceptionHooks",{value:new Map}),t.realdom.attrInterceptionHooks.has(n)||t.realdom.attrInterceptionHooks.set(n,new Set),t.realdom.attrInterceptionHooks.get(n).add(e);let s=()=>t.realdom.attrInterceptionHooks.get(n).delete(e);if(t.realdom.attrInterceptionHooks?.intercepting)return s;console.warn("Attr mutation APIs are now being intercepted."),t.realdom.attrInterceptionHooks.intercepting=!0,Object.defineProperty(t.realdom,"attrInterceptionRecords",{value:new Map});let f=(c,u)=>{t.realdom.attrInterceptionRecords.has(c.target)||t.realdom.attrInterceptionRecords.set(c.target,{});let a=t.realdom.attrInterceptionRecords.get(c.target);a[c.name]=a[c.name]||[],a[c.name].unshift(c.event),t.realdom.attrInterceptionHooks.get("intercept")?.forEach(_=>_([c]));let h=u();return t.realdom.attrInterceptionHooks.get("sync")?.forEach(_=>_([c])),h};new r.MutationObserver(c=>{c=c.filter(u=>!(r.webqit.realdom.attrInterceptionRecords?.get(u.target)||{})[u.attributeName]?.shift()),c=De(c).map(u=>Fe.call(r,u)),c.length&&(t.realdom.attrInterceptionHooks.get("intercept")?.forEach(u=>u(c)),t.realdom.attrInterceptionHooks.get("sync")?.forEach(u=>u(c)))}).observe(i,{attributes:!0,subtree:!0,attributeOldValue:!0});let p=Object.create(null);return["setAttribute","removeAttribute","toggleAttribute"].forEach(c=>{p[c]=o.prototype[c],o.prototype[c]=function(...u){let a,h=this.getAttribute(u[0]);["setAttribute","toggleAttribute"].includes(c)&&(a=u[1]),c==="toggleAttribute"&&a===void 0&&(a=h===null);let _={target:this,name:u[0],value:a,oldValue:h,type:"interception",event:[this,c]};return f(_,()=>p[c].call(this,...u))}}),s}var re=class extends V{constructor(e,...r){super(e,"tree",...r)}attr(e,r=void 0,t={}){let{context:i,window:o}=this;return new N(i,o).get(...arguments)}query(e,r=void 0,t={}){[e,r=void 0,t={}]=this.resolveArgs(arguments);let{context:i}=this,o=new Map,s=p=>(o.has(p)||o.set(p,{target:p,entrants:[],exits:[],type:"query",event:null}),o.get(p));if(!t.generation||t.generation==="entrants"){if(!e.length)[...i.children].forEach(p=>s(i).entrants.push(p));else if(e.every(p=>p.type==="selector")){let[p,c]=e.reduce(([a,h],_)=>_.kind==="xpath"?[a,h.concat(_)]:[a.concat(_),h],[[],[]]),u=[];t.subtree?(p.length&&u.push(...i.querySelectorAll(p.join(","))),c.length&&u.push(...ae(this.window,i,c))):(p.length&&u.push(...[...i.children].filter(a=>a.matches(p))),c.length&&u.push(...ae(this.window,i,c,!1))),u.forEach(a=>s(a.parentNode||i).entrants.push(a))}}if(!r)return o;let f={disconnected:!1},m=r&&t.lifecycleSignals&&this.createSignalGenerator();for(let[,p]of o){if(f.disconnected)break;let c=m?.generate()||{};r(p,c,i)}if(t.live){m&&(t={...t,signalGenerator:m});let p=this.observe(e,r,t);return this.disconnectables(t.signal,f,p)}return this.disconnectables(t.signal,f,m)}children(e,r=void 0,t={}){return[e,r=void 0,t={}]=this.resolveArgs(arguments),this.query(e,r,{...t,subtree:!1})}subtree(e,r=void 0,t={}){return[e,r=void 0,t={}]=this.resolveArgs(arguments),this.query(e,r,{...t,subtree:!0})}observe(e,r,t={}){if([e,r,t={}]=this.resolveArgs(arguments),["sync","intercept"].includes(t.timing))return this.observeSync(e,r,t);if(t.timing&&t.timing!=="async")throw new Error(`Timing option "${t.timing}" invalid.`);let{context:i,window:o,webqit:s,document:f}=this;t.eventDetails&&(s.realdom.domInterceptionRecordsAlwaysOn=!0),(f.readyState==="loading"||s.realdom.domInterceptionRecordsAlwaysOn)&&!s.realdom.domInterceptionHooks?.intercepting&&Be.call(o,"sync",()=>{});let m=new o.MutationObserver(u=>u.forEach(a=>{be.call(o,c,Ne.call(o,a),i)}));m.observe(i,{childList:!0,subtree:t.subtree});let p=t.signalGenerator||t.lifecycleSignals&&this.createSignalGenerator(),c={context:i,spec:e,callback:r,params:t,signalGenerator:p,disconnectable:m};if(t.staticSensitivity){let u=We.call(o,c);return this.disconnectables(t.signal,m,p,u)}return this.disconnectables(t.signal,m,p)}observeSync(e,r,t={}){[e,r,t={}]=this.resolveArgs(arguments);let{context:i,window:o}=this;if(t.timing&&!["sync","intercept"].includes(t.timing))throw new Error(`Timing option "${t.timing}" invalid.`);let s=t.timing==="intercept"?"intercept":"sync",f=t.subtree?"subtree":"children";this.registry(s).size||Be.call(o,s,_=>{this.forEachMatchingContext(s,_,be)});let m=new o.MutationObserver(_=>_.forEach(d=>{Array.isArray((d=Ne.call(o,d)).event)||be.call(o,u,d,i)}));m.observe(i,{childList:!0,subtree:t.subtree});let p={disconnect(){m.disconnect(),h.delete(u),h.size||a.delete(i)}},c=t.signalGenerator||t.lifecycleSignals&&this.createSignalGenerator(),u={context:i,spec:e,callback:r,params:t,signalGenerator:c,disconnectable:p},a=this.registry(s,f);a.has(i)||a.set(i,new Set);let h=a.get(i);if(h.add(u),t.staticSensitivity){let _=We.call(o,u);return this.disconnectables(t.signal,p,c,_)}return this.disconnectables(t.signal,p,c)}};function We(n){let e=this,{context:r,spec:t,callback:i,params:o,signalGenerator:s}=n,f=t.filter(h=>h.kind==="css"),m=h=>h.match(/\.([\w-]+)/g)?.length?["class"]:[],p=h=>h.match(/#([\w-]+)/g)?.length?["id"]:[],c=h=>[...h.matchAll(/\[([^\=\]]+)(\=[^\]]+)?\]/g)].map(_=>_[1]).concat(m(h)).concat(p(h));if(!(n.$attrs=Array.from(new Set(f.filter(h=>(h+"").includes("[")).reduce((h,_)=>h.concat(c(_+"")),[])))).length)return;let u=new Set,a=new Set;return u.push=h=>(a.delete(h),u.add(h)),a.push=h=>(u.delete(h),a.add(h)),n.$deliveryCache={entrants:u,exits:a},new N(r,e).observe(n.$attrs,h=>{let _=new Map,d=y=>(_.has(y)||_.set(y,{target:y,entrants:[],exits:[],type:"static",event:null}),_.get(y)),O=new WeakMap,w=y=>(O.has(y)||O.set(y,f.some(A=>y.matches(A+""))),O.get(y));for(let y of h)["entrants","exits"].forEach(A=>{o.generation&&A!==o.generation||n.$deliveryCache[A].has(y.target)||(A==="entrants"?!w(y.target):w(y.target))||(n.$deliveryCache[A].push(y.target),d(y.target)[A].push(y.target),d(y.target).event=y.event)});for(let[,y]of _){let A=s?.generate()||{};i(y,A,r)}},{subtree:o.subtree,timing:o.timing,eventDetails:o.eventDetails})}function be(n,e){let{context:r,spec:t,callback:i,params:o,signalGenerator:s,$deliveryCache:f}=n,m={...e,entrants:[],exits:[]};if(o.eventDetails||delete m.event,["entrants","exits"].forEach(c=>{if(!(o.generation&&c!==o.generation)&&(t.length?m[c]=ht.call(this,t,e[c],e.event!=="parse"):m[c]=[...e[c]],!!f))for(let u of m[c])f[c].push(u)}),!m.entrants.length&&!m.exits.length)return;let p=s?.generate()||{};i(m,p,r)}function ht(n,e,r){e=Array.isArray(e)?e:[...e];let t=(i,o)=>{if(o.type==="selector"){let s=o.isXpathAttr?[]:i.filter(f=>o.kind==="xpath"?Me(this,f,o+""):f.matches&&f.matches(o+""));if((r||o.isXpathAttr)&&(s=i.reduce((f,m)=>o.kind==="xpath"?[...f,...ae(this,m,o,r)]:m.querySelectorAll?[...f,...m.querySelectorAll(o+"")]:f,s)),s.length)return s}else if(i.includes(o.content)||r&&i.some(s=>s.contains(o.content)))return[o.content]};return e.$$searchCache||(e.$$searchCache=new Map),n.reduce((i,o)=>{let s;return e.$$searchCache.has(o.content)?s=e.$$searchCache.get(o.content):(s=t(e,o)||[],o.type==="instance"&&e.$$searchCache.set(o.content,s)),i.concat(s)},[])}function Ne({target:n,addedNodes:e,removedNodes:r}){let t=this,i;return i=I(e).reduce((o,s)=>o||t.webqit.realdom.domInterceptionRecords?.get(s),null),i=I(r).reduce((o,s)=>o||t.webqit.realdom.domInterceptionRecords?.get(s),i),i=i||t.document.readyState==="loading"&&"parse"||"mutation",{target:n,entrants:e,exits:r,type:"observation",event:i}}function Be(n,e){let r=this,{webqit:t,document:i,Node:o,CharacterData:s,Element:f,HTMLElement:m,HTMLTemplateElement:p,DocumentFragment:c}=r;t.realdom.domInterceptionHooks||Object.defineProperty(t.realdom,"domInterceptionHooks",{value:new Map}),t.realdom.domInterceptionHooks.has(n)||t.realdom.domInterceptionHooks.set(n,new Set),t.realdom.domInterceptionHooks.get(n).add(e);let u=()=>t.realdom.domInterceptionHooks.get(n).delete(e);if(t.realdom.domInterceptionHooks?.intercepting)return u;console.warn("DOM mutation APIs are now being intercepted."),t.realdom.domInterceptionHooks.intercepting=!0,Object.defineProperty(t.realdom,"domInterceptionRecords",{value:new Map});let a=(d,O)=>{d.entrants.concat(d.exits).forEach(y=>{clearTimeout(t.realdom.domInterceptionRecords.get(y)?.timeout),t.realdom.domInterceptionRecords.set(y,d.event);let A=setTimeout(()=>{t.realdom.domInterceptionRecords.delete(y)},0);Object.defineProperty(d.event,"timeout",{value:A,configurable:!0})}),t.realdom.domInterceptionHooks.get("intercept")?.forEach(y=>y(d));let w=O();return t.realdom.domInterceptionHooks.get("sync")?.forEach(y=>y(d)),w},h={characterData:Object.create(null),other:Object.create(null)};["insertBefore","insertAdjacentElement","insertAdjacentHTML","setHTML","replaceChildren","replaceWith","remove","replaceChild","removeChild","before","after","append","prepend","appendChild"].forEach(d=>{function O(...w){let y=this instanceof s?h.characterData:h.other,A=()=>y[d].call(this,...w);if(!(this instanceof s||this instanceof f||this instanceof c))return A();let S=[],P=[],D=this;["insertBefore"].includes(d)?P=[w[0]]:["insertAdjacentElement","insertAdjacentHTML"].includes(d)?(P=[w[1]],["beforebegin","afterend"].includes(w[0])&&(D=this.parentNode)):["setHTML","replaceChildren"].includes(d)?(S=[...this.childNodes],P=d==="replaceChildren"?[...w]:[w[0]]):["replaceWith","remove"].includes(d)?(S=[this],P=d==="replaceWith"?[...w]:[],D=this.parentNode):["replaceChild"].includes(d)?(S=[w[1]],P=[w[0]]):["removeChild"].includes(d)?S=[...w]:(P=[...w],["before","after"].includes(d)&&(D=this.parentNode));let $=d;if(["insertAdjacentHTML","setHTML"].includes(d)){let l=this.nodeName;if(d==="insertAdjacentHTML"&&["beforebegin","afterend"].includes(w[0])){if(!this.parentNode)return y[d].call(this,...w);l=this.parentNode.nodeName}let g=i.createElement(l);y.setHTML.call(g,P[0],d==="setHTML"?w[1]:{}),P=[...g.childNodes],d==="insertAdjacentHTML"?($="insertAdjacentElement",w[1]=new c,w[1].______isTemp=!0,w[1].append(...g.childNodes)):($="replaceChildren",w=[...g.childNodes])}return a({target:D,entrants:P,exits:S,type:"interception",event:[this,d]},()=>y[$].call(this,...w))}["insertBefore","replaceChild","removeChild","appendChild"].includes(d)?(h.other[d]=o.prototype[d],o.prototype[d]=O):(["after","before","remove","replaceWith"].includes(d)&&(h.characterData[d]=s.prototype[d],s.prototype[d]=O),f.prototype[d]&&(h.other[d]=f.prototype[d],f.prototype[d]=O))});let _=Object.create(null);return["outerHTML","outerText","innerHTML","innerText","textContent","nodeValue"].forEach(d=>{let O=["textContent","nodeValue"].includes(d)?o:["outerText","innerText"].includes(d)?m:f;_[d]=Object.getOwnPropertyDescriptor(O.prototype,d),Object.defineProperty(O.prototype,d,{..._[d],set:function(w){let y=()=>_[d].set.call(this,w);if(!(this instanceof f))return y();let A=[],S=[],P=this;if(["outerHTML","outerText"].includes(d)?(A=[this],P=this.parentNode):A=[...this.childNodes],["outerHTML","innerHTML"].includes(d)){let $=this.nodeName;if(d==="outerHTML"){if(!this.parentNode)return y();$=this.parentNode.nodeName}let H=i.createElement($==="TEMPLATE"?"div":$);_[d].set.call(H,w),S=this instanceof p?[]:[...H.childNodes],d==="outerHTML"?(w=new c,w.______isTemp=!0,w.append(...H.childNodes),y=()=>f.prototype.replaceWith.call(this,w)):this instanceof p?y=()=>this.content.replaceChildren(...H.childNodes):y=()=>f.prototype.replaceChildren.call(this,...H.childNodes)}return a({target:P,entrants:S,exits:A,type:"interception",event:[this,d]},y)}})}),["append","prepend","replaceChildren"].forEach(d=>{[i,c.prototype].forEach(O=>{let w=O[d];O[d]=function(...y){if(this.______isTemp)return w.call(this,...y);let A=d==="replaceChildren"?[...this.childNodes]:[];return a({target:this,entrants:y,exits:A,type:"interception",event:[this,d]},()=>w.call(this,...y))}})}),u}function Re(){gt.call(this),yt.call(this),_t.call(this)}function gt(){let n=this;n.CSS||(n.CSS={}),n.CSS.escape||(n.CSS.escape=e=>e.replace(/([\:@\~\$\&])/g,"\\$1"))}function yt(){let n=this;"isConnected"in n.Node.prototype||Object.defineProperty(n.Node.prototype,"isConnected",{get:function(){return!this.ownerDocument||!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}function _t(){let n=this;n.Element.prototype.matches||(n.Element.prototype.matches=n.Element.prototype.matchesSelector||n.Element.prototype.mozMatchesSelector||n.Element.prototype.msMatchesSelector||n.Element.prototype.oMatchesSelector||n.Element.prototype.webkitMatchesSelector||function(e){for(var r=(this.document||this.ownerDocument).querySelectorAll(e),t=r.length;--t>=0&&r.item(t)!==this;);return t>-1})}function Ve(){let n=this;if(n.webqit||(n.webqit={}),n.webqit.realdom)return n.webqit.realdom;n.webqit.realdom={},Re.call(n),n.webqit.realdom.meta=(...r)=>wt.call(n,...r),n.webqit.realdom.ready=(...r)=>xe.call(n,...r),n.webqit.realdom.realtime=(r,t="dom")=>{if(t==="dom")return new re(r,n);if(t==="attr")return new N(r,n)};let e=new te(n);return n.webqit.realdom.schedule=(r,...t)=>e[`on${r}`](...t),n.webqit.realdom.synthesizeWhile=(...r)=>e.synthesizeWhile(...r),n.webqit.realdom}function xe(...n){let e="interactive",r;X(n[0])?(e=n[0],E(n[1])&&(r=n[1])):E(n[0])&&(r=n[0]);let t={interactive:["interactive","complete"],complete:["complete"]};if(!t[e])throw new Error(`Invalid ready-state timing: ${e}.`);let i=this;if(!r)return i.webqit.realdom.readyStatePromises||(i.webqit.realdom.readyStatePromises={interactive:new Promise(o=>xe.call(this,"interactive",o)),complete:new Promise(o=>xe.call(this,"complete",o))}),i.webqit.realdom.readyStatePromises[e];if(t[e].includes(i.document.readyState))return r(i);i.webqit.realdom.readyStateCallbacks||(i.webqit.realdom.readyStateCallbacks={interactive:[],complete:[]},i.document.addEventListener("readystatechange",()=>{let o=i.document.readyState;for(let s of i.webqit.realdom.readyStateCallbacks[o].splice(0))s(i)},!1)),i.webqit.realdom.readyStateCallbacks[e].push(r)}function wt(n){let e=this,r={},t;return(t=e.document.querySelector(`meta[name="${n}"]`))&&(r=(t.content||"").split(";").filter(i=>i).reduce((i,o)=>{let s=o.split("=").map(f=>f.trim());return _e(i,s[0].split("."),s[1]==="true"?!0:s[1]==="false"?!1:M(s[1])?parseInt(s[1]):s[1]),i},{})),{get name(){return n},get content(){return t.content},json(){return JSON.parse(JSON.stringify(r))}}}function ue(n,e){return typeof n!="string"?n:n.replace(/\w\S*/g,function(r){return r.charAt(0).toUpperCase()+(typeof e!==void 0&&e?r.substr(1).toLowerCase():r.substr(1))})}var v=(...n)=>U("oohtml",...n),L={};function Ge(n,e,r){let t=this,i=Ve.call(t);L.window=t,t.webqitConfig||(t.webqitConfig=i.meta("webqit").json()),t.webqit||(t.webqit={}),t.webqit.oohtml||(t.webqit.oohtml={}),t.webqit.oohtml.configs||(t.webqit.oohtml.configs={});let o=n.toUpperCase().replace("-","_");if(!t.webqit.oohtml.configs[o]){t.webqit.oohtml.configs[o]={};let s=t.webqit.oohtml.configs[o];K(2,s,r,e,i.meta(n).json()),t.webqitConfig.prefix&&Object.keys(s).forEach(f=>{Object.keys(s[f]).forEach(m=>{f==="api"&&typeof s[f][m]=="string"?s[f][m]=`${t.webqitConfig.prefix}${ue(s[f][m])}`:["attr","elements"].includes(f)&&s[f][m]?.startsWith("data-")===!1&&(s[f][m]=`${t.webqitConfig.prefix}-${s[f][m]}`)})})}return{config:t.webqit.oohtml.configs[o],realdom:i,window:t}}function Xe(n,e){return[...n].reduce(([r,t,i],o)=>!r&&t===0&&(Array.isArray(e)?e:[e]).includes(o)?[r,t,[""].concat(i)]:(!r&&["(","[","{"].includes(o)&&!i[0].endsWith("\\")&&t++,!r&&[")","]","}"].includes(o)&&!i[0].endsWith("\\")&&t--,['"',"'","`"].includes(o)&&!i[0].endsWith("\\")&&(r=r===o?null:r||o),i[0]+=o,[r,t,i]),[null,0,[""]])[2].reverse()}var vt=()=>(0|Math.random()*9e6).toString(36),ve=new Map;function ze(n){let e;return(e=ve.get(n))||(e=vt(),ve.set(n,e)),e}function Je(n){let e;return ve.forEach((r,t)=>{r===n&&(e=t)}),e}function Ye(){let{window:n}=L,{webqit:e}=n;if(e.DOMContextRequestEvent)return e.DOMContextRequestEvent;class r extends n.Event{constructor(...i){let o=i.pop();if(typeof o!="function")throw new Error("Callback must be provided.");let s=i.pop();if(!s?.kind)throw new Error('"options.kind" must be specified.');let f=["contextrequest","contextclaim"],m=i.pop()||f[0];if(!f.includes(m))throw new Error(`Invalid event type. Must be one of: ${f.join(",")}`);let{kind:p,detail:c,targetContext:u,live:a,signal:h,diff:_,...d}=s;super(m,{...d,bubbles:d.bubbles!==!1}),Object.defineProperty(this,"callback",{get:()=>o}),Object.defineProperty(this,"kind",{get:()=>p}),Object.defineProperty(this,"targetContext",{get:()=>u}),Object.defineProperty(this,"detail",{get:()=>c}),Object.defineProperty(this,"live",{get:()=>a}),Object.defineProperty(this,"signal",{get:()=>h}),Object.defineProperty(this,"diff",{get:()=>_}),Object.defineProperty(this,"options",{get:()=>d})}respondWith(i){if(this.diff){if("_prevValue"in this&&this._prevValue===i)return;Object.defineProperty(this,"_prevValue",{value:i,configurable:!0})}return this.callback(i)}}return e.DOMContextRequestEvent=r,r}var ne=class extends AbortController{constructor(e){super(),e(r=>{let{window:{webqit:{Observer:t}}}=L;t.defineProperty(this,"value",{value:r,configurable:!0,enumerable:!0})},this)}};var ie=class extends Error{};var oe=class{static instance(e){return v(e).get("contexts::instance")||new this(e)}constructor(e){v(e).get("contexts::instance")?.dispose(),v(e).set("contexts::instance",this);let r={host:e,contexts:new Set};Object.defineProperty(this,"#",{get:()=>r})}get[Symbol.iterator](){return this["#"].contexts[Symbol.iterator]}get length(){return this["#"].contexts.size}find(...e){return[...this["#"].contexts].find(r=>typeof e[0]=="function"?e[0](r):r.constructor.kind===e[0]&&(e.length===1||r.detail===e[1]))}attach(e){if(!(e instanceof B))throw new TypeError("Context is not a valid DOMContext instance.");if(this.find(e.constructor.kind,e.detail))throw new ie(`Context of same kind "${e.constructor.kind}"${e.detail?` and detail "${e.detail}"`:""} already exists.`);this["#"].contexts.add(e),e.initialize(this["#"].host)}detach(e){e.dispose(this["#"].host),this["#"].contexts.delete(e)}request(...e){return new ne((r,t)=>{typeof e[e.length-1]!="function"&&(e[e.length-1]?e.push(r):e[e.length-1]=r);let i;(i=e.find(s=>typeof s=="object"&&s))&&i.live&&(i.signal&&i.signal.addEventListener("abort",()=>t.abort()),e[e.indexOf(i)]={...i,signal:t.signal});let o=new(Ye())(...e);this["#"].host.dispatchEvent(o)})}};var Oe=class{static createRequest(){return{kind:this.kind}}constructor(e=null){Object.defineProperty(this,"detail",{get:()=>e}),Object.defineProperty(this,"subscriptions",{value:new Set})}get configs(){let{window:{webqit:{oohtml:{configs:e}}}}=L;return e}get name(){return this.host===L.window.document?1/0:this.host.getAttribute(this.configs.CONTEXT_API.attr.contextname)}subscribed(e){}handle(e){}unsubscribed(e){}matchEvent(e){return e.kind===this.constructor.kind&&(!e.targetContext||e.targetContext===this.name)}handleEvent(e){if(!(this.disposed||typeof e.respondWith!="function")){if(e.type==="contextclaim"){if(e.target===this.host||!(e.detail instanceof Oe))return;let r=new Set;return this.subscriptions.forEach(t=>{!e.target.contains(t.target)||!e.detail.matchEvent(t)||(e.stopPropagation(),this.subscriptions.delete(t),r.add(t))}),e.respondWith(r)}if(e.type==="contextrequest")return this.matchEvent(e)?(e.live&&(this.subscriptions.add(e),this.subscribed(e),e.signal?.addEventListener("abort",()=>{this.subscriptions.delete(e),this.unsubscribed(e)})),e.stopPropagation(),this.handle(e)):void 0}}initialize(e){this.host=e,this.disposed=!1,e.addEventListener("contextrequest",this),e.addEventListener("contextclaim",this);let{value:r}=oe.instance(e).request("contextclaim",{kind:this.constructor.kind,detail:this});return r?.forEach(t=>{this.subscriptions.add(t),this.subscribed(t),this.handle(t)}),this}dispose(e){return this.disposed=!0,e.removeEventListener("contextrequest",this),e.removeEventListener("contextclaim",this),this.subscriptions.forEach(r=>{this.subscriptions.delete(r),this.unsubscribed(r);let{target:t}=r;t.dispatchEvent(r)}),this}},B=Oe;se(B,"kind");var z=class extends B{static createRequest(e=null){let r=super.createRequest();if(e?.startsWith("@")){let[t,...i]=i.slice(1).split("/").map(o=>o.trim());r.targetContext=t,r.detail=i.join("/")}else r.detail=e;return r}get namespaceObj(){return this.host[this.configs.NAMESPACED_HTML.api.namespace]}handle(e){let{window:{webqit:{Observer:r}}}=L;if(e._controller?.abort(),!(e.detail||"").trim())return e.respondWith(r.unproxy(this.namespaceObj));let t=(e.detail||"").split("/").map(i=>i.trim()).filter(i=>i);if(!t.length)return e.respondWith();t=t.join(`/${this.configs.NAMESPACED_HTML.api.namespace}/`)?.split("/")||[],e._controller=r.reduce(this.namespaceObj,t,r.get,i=>{this.disposed||e.respondWith(i.value)},{live:e.live,signal:e.signal,descripted:!0})}unsubscribed(e){e._controller?.abort()}};se(z,"kind","namespace");function Ae(n={}){let{config:e,window:r}=Ge.call(this,"namespaced-html",n,{attr:{namespace:"namespace",lid:"id"},api:{namespace:"namespace"},tokens:{lidrefPrefix:"~",lidrefSeparator:":"},target:{attr:":target",event:":target",scrolling:!0}});e.lidSelector=`[${r.CSS.escape(e.attr.lid)}]`,e.namespaceSelector=`[${r.CSS.escape(e.attr.namespace)}]`,r.webqit.DOMNamingContext=z,Ot.call(r,e),At.call(r,e)}function Qe(n,e=null,r=!1){let t=this,{webqit:{oohtml:{configs:{NAMESPACED_HTML:i}}}}=t,{lidrefPrefix:o,lidrefSeparator:s}=i.tokens,f=new RegExp(`${e?":scope|":""}#${[...o].map(u=>/\w/.test(u)?u:r?`\\\\${u}`:`\\${u}`).join("")}([\\w-]|\\\\.)+`,"g"),[m,p]=Xe(n,",").reduce(([u,a],h)=>{let _,d;return h=h.replace(f,(O,w,y)=>{if(_||(_=[...h.matchAll(/(["'])(?:(?=(\\?))\2.)*?\1/g)]),_.some(S=>y>S.index&&y+O.length<S.index+O.length))return O;if(O===":scope")return d=!0,e;let A=O.replace(`#${r?[...o].map(S=>/\w/.test(S)?S:`\\${S}`).join(""):o}`,"");return i.attr.lid==="id"?`[id^="${o}"][id$="${s}${A}"]`:`[${t.CSS.escape(i.attr.lid)}="${A}"]`}),d?[u,a.concat(h)]:[u.concat(h),a]},[[],[]]),c;return e&&m.length?c=[m.length>1?`${e} :is(${m.join(", ")})`:`${e} ${m[0]}`,p.join(", ")].filter(u=>u).join(", "):c=[...m,...p].join(", "),c}function Ze(n){if(!v(n).has("namespace")){let e=Object.create(null);v(n).set("namespace",e)}return v(n).get("namespace")}function Ot(n){let e=this,{webqit:{Observer:r}}=e;if(n.api.namespace in e.document)throw new Error(`document already has a "${n.api.namespace}" property!`);if(n.api.namespace in e.Element.prototype)throw new Error(`The "Element" class already has a "${n.api.namespace}" property!`);Object.defineProperty(e.document,n.api.namespace,{get:function(){return r.proxy(Ze.call(e,e.document))}}),Object.defineProperty(e.Element.prototype,n.api.namespace,{get:function(){return r.proxy(Ze.call(e,this))}})}function At(n){let e=this,{webqit:{Observer:r,realdom:t,oohtml:{configs:i},DOMNamingContext:o}}=e,{lidrefPrefix:s,lidrefSeparator:f}=n.tokens;e.document[i.CONTEXT_API.api.contexts].attach(new o),t.realtime(e.document).subtree(n.namespaceSelector,l=>{l.exits.forEach(g=>{let b=g[i.CONTEXT_API.api.contexts],T=b.find(o.kind);T&&b.detach(T)}),l.entrants.forEach(g=>{let b=g[i.CONTEXT_API.api.contexts];b.find(o.kind)||b.attach(new o)})},{live:!0,timing:"sync",staticSensitivity:!0});let m=["aria-owns","aria-controls","aria-labelledby","aria-describedby","aria-flowto"],p=["for","list","form","aria-activedescendant","aria-details","aria-errormessage"],c=[n.attr.lid,...m,...p],u={id:"id",for:"htmlFor","aria-owns":"ariaOwns","aria-controls":"ariaControls","aria-labelledby":"ariaLabelledBy","aria-describedby":"ariaDescribedBy","aria-flowto":"ariaFlowto","aria-activedescendant":"ariaActiveDescendant","aria-details":"ariaDetails","aria-errormessage":"ariaErrorMessage"},a=l=>l.startsWith(s)&&l.includes(f),h=l=>l.startsWith(s)&&!l.includes(f),_=(l,g)=>`${s}${l}${f}${g}`,d=l=>a(l)?l.split(f)[1]:l,O=l=>a(l)?`${s}${l.split(f)[1]}`:l,w=Object.getOwnPropertyDescriptor(e.Element.prototype,"getAttribute");Object.defineProperty(e.Element.prototype,"getAttribute",{...w,value(l){let g=w.value.call(this,l);return!v(this,"lock").get(l)&&c.includes(l)?(l==="id"?d:O)(g):g}});let y=Object.getOwnPropertyDescriptor(e.Document.prototype,"getElementById");Object.defineProperty(e.Document.prototype,"getElementById",{...y,value(l){return h(l)?this.querySelector(Qe.call(e,`#${l}`)):y.value.call(this,l)}});for(let l of["querySelector","querySelectorAll"])for(nodeApi of[e.Document,e.Element]){let g=Object.getOwnPropertyDescriptor(nodeApi.prototype,l);Object.defineProperty(nodeApi.prototype,l,{...g,value(b){return g.value.call(this,Qe.call(e,b))}})}for(let l of c){if(!(l in u))continue;let g=l==="for"?[e.HTMLLabelElement,e.HTMLOutputElement]:[e.Element];for(let b of g){let T=Object.getOwnPropertyDescriptor(b.prototype,u[l]);!T||Object.defineProperty(b.prototype,u[l],{...T,get(){return(l==="id"?d:O)(T.get.call(this,l)||"")}})}}n.attr.lid!=="id"&&Object.defineProperty(e.Element.prototype,n.attr.lid,{configurable:!0,enumerable:!0,get(){return this.getAttribute(n.attr.lid)},set(l){return this.setAttribute(n.attr.lid,l)}});let A=(l,g,b)=>{if(v(l,"lock").get(g))return;v(l,"lock").set(g,!0),typeof b=="function"&&(b=b());let T=v(l).get("ownerNamespace");if(g===n.attr.lid){let R=d(b);r.get(T,R)===l&&r.deleteProperty(T,R)}else{let R=b.split(" ").map(F=>(F=F.trim())&&O(F)).join(" ");l.setAttribute(g,R)}v(l,"lock").delete(g)},S=(l,g,b)=>{if(v(l,"lock").get(g))return;v(l,"lock").set(g,!0),typeof b=="function"&&(b=b());let T=v(l).get("ownerNamespace"),R=v(l).get("namespaceUUID");if(g===n.attr.lid){let F=d(b);r.get(T,F)!==l&&(l.setAttribute("id",_(R,F)),r.set(T,F,l))}else{let F=b.split(" ").map(J=>(J=J.trim())&&!h(J)?J:_(R,J.replace(s,""))).join(" ");l.setAttribute(g,F)}v(l,"lock").delete(g)},P=(l,g=!0)=>{for(let b of c)!l.hasAttribute(b)||A(l,b,()=>l.getAttribute(b));v(l).delete("ownerNamespace"),v(l).delete("namespaceUUID"),g&&(v(l).get("namespaceBinding").abort(),v(l).delete("namespaceBinding"))},D=l=>{if(!v(l).get("ownerNamespace")){let g={...o.createRequest(),live:!0},b=l.parentNode[i.CONTEXT_API.api.contexts].request(g,T=>{v(l).get("namespaceUUID")&&P(l,!1),v(l).set("ownerNamespace",T),v(l).set("namespaceUUID",Je(T)||ze(T)),D(l)});v(l).set("namespaceBinding",b);return}for(let g of c)!l.hasAttribute(g)||S(l,g,()=>l.getAttribute(g))};t.realtime(e.document).subtree(`[${c.map(l=>e.CSS.escape(l)).join("],[")}]`,l=>{l.exits.forEach(P),l.entrants.forEach(D)},{live:!0,timing:"sync"}),t.realtime(e.document,"attr").observe(c,l=>{for(let g of l)g.oldValue?(A(g.target,g.name,g.oldValue),g.value&&S(g.target,g.name,g.value)):D(entry)},{subtree:!0,timing:"sync",newValue:!0,oldValue:!0});let $,H=()=>{if(!e.location.hash?.startsWith(`#${s}`))return;let l=e.location.hash?.substring(`#${s}`.length).split("/").map(b=>b.trim()).filter(b=>b)||[],g=l.reduce((b,T)=>b&&b[n.api.namespace][T],e.document);$&&n.target.attr&&$.toggleAttribute(n.target.attr,!1),g&&g!==e.document&&(n.target.attr&&g.toggleAttribute(n.target.attr,!0),n.target.event&&g.dispatchEvent(new e.CustomEvent(n.target.event)),n.target.scrolling&&l.length>1&&g.scrollIntoView(),$=g)};e.addEventListener("hashchange",H),t.ready(H)}Ae.call(window);})();
//# sourceMappingURL=namespaced-html.js.map
