(()=>{function y(e){return!Array.isArray(e)&&typeof e=="object"&&e}function L(e,...r){globalThis.WebQitInternalsRegistry||(globalThis.WebQitInternalsRegistry=new Map);var n=globalThis.WebQitInternalsRegistry.get(e);if(!n){if(n=new Map,r[0]===!1)return n;globalThis.WebQitInternalsRegistry.set(e,n)}for(var o,t;o=r.shift();)if((t=n)&&!(n=n.get(o))){if(n=new Map,r[0]===!1)return n;t.set(o,n)}return n}function d(e){return Array.isArray(e)}function A(e){return typeof e=="function"}function q(e){return e===null||e===""}function C(e){return arguments.length&&(e===void 0||typeof e>"u")}function w(e){return Array.isArray(e)||typeof e=="object"&&e||A(e)}function z(e){return q(e)||C(e)||e===!1||e===0||w(e)&&!Object.keys(e).length}function g(e){return A(e)||e&&{}.toString.call(e)==="[object function]"}function M(e){return e instanceof Number||typeof e=="number"}function b(e){return M(e)||e!==!0&&e!==!1&&e!==null&&e!==""&&!isNaN(e*1)}function E(e){return e instanceof String||typeof e=="string"&&e!==null}function J(e){return!E(e)&&!C(e.length)}function D(e,...r){return r.forEach(n=>{e.indexOf(n)<0&&e.push(n)}),e}function G(o,r){r=r||Object.prototype,r=r&&!d(r)?[r]:r;for(var n=[],o=o;o&&(!r||r.indexOf(o)<0)&&o.name!=="default";)n.push(o),o=o?Object.getPrototypeOf(o):null;return n}function j(e,r){var n=[];return G(e,r).forEach(o=>{D(n,...Object.getOwnPropertyNames(o))}),n}function O(e,r,n=!1,o=!1,t=!1){var i=0,f=e.shift();if((b(f)||f===!0||f===!1)&&(i=f,f=e.shift()),!e.length)throw new Error("_merge() requires two or more array/objects.");return e.forEach((u,l)=>{!w(u)&&!g(u)||(n?j(u):Object.getOwnPropertyNames(u)).forEach(m=>{if(!!r(m,f,u,l)){var s=f[m],c=u[m];if((d(s)&&d(c)||y(s)&&y(c))&&(i===!0||i>0))f[m]=d(s)&&d(c)?[]:{},O([b(i)?i-1:i,f[m],s,c],r,n,o,t);else if(d(f)&&d(u))o?f[m]=c:f.push(c);else try{t?Object.defineProperty(f,m,Object.getOwnPropertyDescriptor(u,m)):f[m]=u[m]}catch{}}})}),f}function F(...e){return O(e,(r,n,o)=>!0,!1,!1,!1)}function U(e,r,n=!1){if(r=="")return e;var o=n?e.lastIndexOf(r):e.indexOf(r);return o===-1?"":e.substr(o+r.length)}function X(e,r,n=!1){if(r=="")return e;var o=n?e.lastIndexOf(r):e.indexOf(r);return o===-1?e:e.substr(0,o)}function x(e,r=!0){return d(e)?e:!r&&y(e)?[e]:e!==!1&&e!==0&&z(e)?[]:J(e)?Array.prototype.slice.call(e):y(e)?Object.values(e):[e]}function Y(e,r,n=null){return d(r)?e.filter(o=>n?r.filter(t=>n(o,t)).length:r.indexOf(o)!==-1):[]}function S(e,r,n={},o={}){r=x(r).slice();for(var t=e;!C(t)&&!q(t)&&r.length;){var i=r.shift();if(!(n.get?n.get(t,i):w(t)?i in t:t[i])){o.exists=!1;return}t=n.get?n.get(t,i):t[i]}return o.exists=!0,t}function k(e,r,n,o={},t={}){let i=(s,c,p)=>t.set?t.set(s,c,p):(b(r[u])&&d(s)?s.push(p):s[c]=p,!0);r=x(r);for(var f=e,u=0;u<r.length;u++)if(u<r.length-1){if(!f||!w(f)&&!g(f))return!1;var l=S(f,r[u],t);if(!w(l)){if(t.buildTree===!1)return!1;l=g(t.buildTree)?t.buildTree(u):b(r[u+1])?[]:{};var m=i(f,r[u],l);if(!m)return!1}f=l}else return i(f,r[u],n)}var B=(e,r=Array)=>class extends r{constructor(...o){super(...o),Object.defineProperty(this,"window",{value:e})}get(o,t={}){let i=this[o];return We.call(e,i,t.context,!1)}each(o,t={}){this.forEach((i,f)=>{(i=this.get(f,t))&&o(i)})}attributes(o=[]){let t=this.get(0);return t?o.length?o.reduce((i,f)=>i.concat(t.getAttribute(f)),[]):Array.from(t.attributes).reduce((i,f)=>i.concat({name:f.name,value:f.value}),[]):[]}children(o={}){let t=this.get(0,o);return t?this.constructor.from(t instanceof this.window.HTMLTemplateElement?t.content.children:t.children):this.constructor.from([])}querySelectorAll(o,t={}){let i=this.get(0,t)||t.context||e.document.documentElement;return this.constructor.from(le.call(e,o,i,!0))}};function We(e,r=null,n=!0){let o=this;if(E(e)){let i;if(e.trim().startsWith("<")){var t=o.document.createElement("div");t.innerHTML=e,i=n?t.children:t.firstChild}else i=le.call(o,e,r,n);return i}return e instanceof o.Element?n?[e]:e:n?x(e,!1):e}function le(e,r=null,n=!0){r=r||this.document;var t,i=n?"querySelectorAll":"querySelector";try{t=r[i](e)}catch{try{t=r[i](e.replace(/\:is\(/g,":matches("))}catch{try{t=r[i](e.replace(/\:is\(/g,":-webkit-any("))}catch{try{t=r[i](e.replace(/\:is\(/g,":-moz-any("))}catch(m){throw m}}}}return t}function ae(e){let r=this;r.document.readyState==="complete"?e(r):(r.document.domReadyCallbacks||(r.document.domReadyCallbacks=[],r.document.addEventListener("DOMContentLoaded",()=>{r.document.domReadyCallbacks.splice(0).forEach(n=>n(r))},!1)),r.document.domReadyCallbacks.push(e))}function pe(e,r=!1){let n=this,o={content:{}};return!(o.el=n.document.querySelector('meta[name="oohtml"]'))&&r&&(o.el=n.document.createElement("meta"),o.el.setAttribute("name",e),n.document.head.append(o.el)),o.el&&(o.content=(o.el.getAttribute("content")||"").split(";").filter(t=>t).reduce((t,i)=>{let f=i.split("=").map(u=>u.trim());return k(t,f[0].split("."),f[1]==="true"?!0:f[1]==="false"?!1:b(f[1])?parseInt(f[1]):f[1]),t},{})),o.get=function(t){return JSON.stringify(S(this.content,t.split(".")))},o.copy=function(){return JSON.stringify(this.content)},o.copyWithDefaults=function(...t){return t.length?F(!0,{},...t.reverse().concat(this.content)):this.copy()},o}var de=e=>class{constructor(n=!0){Object.defineProperty(this,"window",{value:e}),Object.defineProperty(this,"readCallbacks",{value:new Set}),Object.defineProperty(this,"writeCallbacks",{value:new Set}),this.async=n,this.window.requestAnimationFrame?this._run():this.async=!1}_run(){this.window.requestAnimationFrame(()=>{this.readCallbacks.forEach(n=>{n()||this.readCallbacks.delete(n)}),this.writeCallbacks.forEach(n=>{n()||this.writeCallbacks.delete(n)}),this._run()})}onread(n,o=!1){if(o)return new Promise((t,i)=>{this.async===!1?n(t,i):this.readCallbacks.add(()=>{n(t,i)})});this.async===!1?n():this.readCallbacks.add(n)}onwrite(n,o=!1){if(o)return new Promise((t,i)=>{this.async===!1?n(t,i):this.writeCallbacks.add(()=>{n(t,i)})});this.async===!1?n():this.writeCallbacks.add(n)}cycle(n,o,t){this.onread(()=>{var i=n(t);if(i){var f=u=>{this.onwrite(()=>{var l=o(u,t);if(l){var m=s=>{this.cycle(n,o,s)};l instanceof Promise?l.then(m):m()}})};i instanceof Promise?i.then(f):f()}})}};var he=(e,r=Array)=>class extends B(e,r){attributes(o,t,i={}){g(arguments[0],i)&&(i=t||{},t=o,o=[]);let f=super.attributes(o);return f.length&&t(...f),this.attributeChangeCallback(o,t,i)}attributeChangeCallback(o,t,i={}){g(arguments[0])&&(i=t||{},t=o,o=[]);let f=new e.MutationObserver(m=>{if(!o.length){t(...Array.from(m).reduce((s,c)=>s.concat({name:c.attributeName,value:u.getAttribute(c.attributeName),oldValue:c.oldValue}),[]));return}t(...o.reduce((s,c)=>s.concat(u.getAttribute(c)),[]))});i={attributes:!0,attributeOldValue:!o.length,subtree:i.subtree},o.length&&(i.attributeFilter=o);let u=this.get(0,i);f.observe(u,i);let l=this;return{disconnect(){return f.disconnect(),{reconnect(){return l.attributeChangeCallback(o,t,i)}}}}}children(o,t={}){N(super.children(t),o,t,1);let i=new e.MutationObserver(m=>{let[s,c,p,a]=ge(m);N(s,o,t,0,1),N(c,o,t,1,0),N(p,o,t,0),N(a,o,t,1)}),f=this.get(0,t),u=f instanceof e.HTMLTemplateElement?f.content:f;i.observe(u,{childList:!0});let l=this;return{disconnect(){return i.disconnect(),{reconnect(){return l.children(o)}}}}}querySelectorAll(o,t,i={}){let f=super.querySelectorAll(o,i);N(f,t,i,1);let u=this.get(0,i);return this.constructor.from([o]).presenceChangeCallback(t,{...i,context:u||i.context})}querySelectorNone(o,t,i={}){super.querySelectorAll(o,i).length===0&&(i.each?t(null,0):t([],0));let f=this.get(0,i);return this.constructor.from([o]).presenceChangeCallback(t,{...i,context:f||i.context})}connectedCallback(o,t={}){let i=[];return this.each(f=>{!f.isConnected||(t.each?o(f,1):i.push(f))},t),i.length&&o(i,1),this.presenceChangeCallback(o,{...t,on:"added"})}disconnectedCallback(o,t={}){let i=[];return this.each(f=>{f.isConnected||(t.each?o(f,0):i.push(f))},t),i.length&&o(i,0),this.presenceChangeCallback(o,{...t,on:"removed"})}presenceChangeCallback(o,t={}){let i=(p,[...a])=>{if(a=a.filter(h=>h.matches),E(p)){let h=a.filter(_=>_.matches(p));if(t.observeIndirectMutation!==!1&&(h=a.reduce((_,v)=>_.concat(x(v.querySelectorAll(p))),h),h.length))return h}else{if(a.includes(p))return[p];if(t.observeIndirectMutation!==!1&&a.length){let h=p;for(;h=h.parentNode;)if(a.includes(h))return[p]}}},f=(p,a)=>(a.$$searchCache||(a.$$searchCache=new Map),p.reduce((h,_)=>{let v;return a.$$searchCache.has(_)?v=a.$$searchCache.get(_):(v=i(_,a,E(_))||[],a.$$searchCache.set(_,v)),h.concat(v)},[])),u=this,l=new Set,m=new Set,s=(p,a,h)=>{a&&t.on==="removed"||!a&&t.on==="added"||(p=f(u,p)).length&&(p.forEach(_=>{a?(l.add(_),m.delete(_)):(l.delete(_),m.add(_))}),t.maintainCallState?N(p,o,t,a,h,l,m):N(p,o,t,a,h))},c=t.context||e.document.documentElement;return _e.call(e,c,(p,a,h,_)=>{s(p,0,1),s(a,1,0),s(h,0,0),s(_,1,1)})}};function N(e,r,n,...o){n.each?e.forEach(t=>r(t,...o)):e instanceof Set&&e.size?r([...e],...o):Array.isArray(e)&&e.length&&r(e,...o)}var T=new Map;function _e(e,r){let n=this;if(!T.has(e)){let t=new Set,i=new n.MutationObserver(u=>{if(!t.size)return;let[l,m,s,c]=ge(u);t.forEach(p=>p(l,m,s,c))}),f=e instanceof n.HTMLTemplateElement?e.content:e;i.observe(f,{childList:!0,subtree:!0}),T.set(e,{callbacks:t,observer:i})}T.get(e).callbacks.add(r);let o={disconnect(){let t=T.get(e);return t.callbacks.delete(r),t.callbacks.size||(t.observer.disconnect(),T.delete(e)),{reconnect(){let i=T.get(e);return i?(i.callbacks.add(r),o):_e.call(n,e,r)}}}};return o}function ge(e){let r=new Set,n=new Set,o=new Set,t=new Set;return e.forEach(i=>{i.addedNodes.forEach(f=>{f.isConnected?r.add(f):t.add(f)}),i.removedNodes.forEach(f=>{f.isConnected&&r.has(f)?(r.delete(f),n.add(f)):o.add(f)}),t.forEach(f=>{o.has(f)||(t.delete(f),r.add(f))})}),[n,t,o,r]}function ye(){Be.call(this),He.call(this),Qe.call(this)}function Be(){let e=this;e.CSS||(e.CSS={}),e.CSS.escape||(e.CSS.escape=r=>r.replace(/([\:@\~\$\&])/g,"\\$1"))}function He(){let e=this;"isConnected"in e.Node.prototype||Object.defineProperty(e.Node.prototype,"isConnected",{get:function(){return!this.ownerDocument||!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}function Qe(){let e=this;e.Element.prototype.matches||(e.Element.prototype.matches=e.Element.prototype.matchesSelector||e.Element.prototype.mozMatchesSelector||e.Element.prototype.msMatchesSelector||e.Element.prototype.oMatchesSelector||e.Element.prototype.webkitMatchesSelector||function(r){for(var n=(this.document||this.ownerDocument).querySelectorAll(r),o=n.length;--o>=0&&n.item(o)!==this;);return o>-1})}function xe(){let e=this;if(e.wq||(e.wq={}),e.wq.dom)return e.wq.dom;let r=B(e),n=de(e),o=he(e);return r.prototype.realtime=function(...t){return t.length?new o(...t):new o(...this)},e.wq.dom=new r,e.wq.dom.reflow=new n,e.wq.dom.ready=ae.bind(e),e.wq.dom.meta=pe.bind(e),e.wq.dom.extend=(t,i,{supportsRealtime:f=!1}={})=>{f!=="only"&&(r.prototype[t]=i),f&&(o.prototype[t]=i)},ye.call(e),e.wq.dom}function K(e,r){return X(e,r,!0)}function ee(e,r,n){return K(U(e,r),n)}function te(e,r,n){return e.startsWith(r)&&e.endsWith(n)}function be(e,r,n=null,o={},t={}){let i=x(e,!1).map(s=>Oe(null,null,s)),f=n||(s=>s),u={...o},l={...t};u.keys||(u.keys=s=>y(s)&&Reflect.ownKeys(s)||[]),u.get||(u.get=(s,c)=>y(s)&&Reflect.get(s,c)),l.delim||(l.delim="/");let m=$(i,r,f,u,l);return l.realtime&&g(o.subscribe)?{unsubscribe(){i.forEach(s=>(s.unsubscribe(),m))}}:m}function $(e,r,n,o,t,i=0){let f=Array.isArray(r)?r:H(r,[t.delim]).map(s=>s.trim());if(!f.length)return n([]);let u=()=>{let s=f.slice(0),c=s.shift(),p;return c.endsWith("?")&&(c=c.substr(0,c.length-1),p=!0),ze(e,c,a=>s.length?$(a,s,h=>p&&h.length===0?n(a):n(h),o,t,i+1):n(a),o,t,i)},m=t.await&&g(o.ready)&&e.map(s=>o.ready(s.value,i))||[];return m.filter(s=>s).length?t.await==="atomic"?Promise.allSettled(m).then(u):Promise.race(m).then(u):u()}function H(e,r,n=!1){e=e.trim();let o=["()","{}","[]"];if(r.length===1&&o.includes(r[0])){let[i,f]=e.split(r[0][0],2);return f&&f.endsWith(r[0][1])&&(f=f.substr(0,f.length-1)),[i,f]}let[t]=e.split("").reduce(([i,f],u)=>(r.includes(u)&&!f?i.unshift(n?u:""):(["(","{","["].includes(u)?f++:[")","}","]"].includes(u)&&f--,i[0]+=u),[i,f]),[[""],0]);return t.reverse()}function ze(e,r,n,o,t,i){let f=["|","&","+"],u=H(r,f,!0).map(l=>l.trim());return function l(m,s,c,p=null){let a=s.shift();return a?function h(_,v,Xe=null){let oe=v.shift();if(!oe)return l(m.concat(_),s,c,"end-of-tokens");let[V,ve,Ce]=Je(oe,f);return V==="|"&&_.length||V==="&"&&!_.length?l(m.concat(_),s,c,"early-return-1"):Ge(a,ve,Ce,ne=>V==="&"&&!ne.length?l(m.concat(_),s,c,"early-return-2"):h(_.concat(ne),v,"next-token"),o,t,i)}([],c.slice(0)):n(m)}([],e.slice(0),u)}var we=new Map;function Je(e,r=[]){let n=we.get(e);if(!n){let o=e,t;r.includes(o.substr(0,1))&&(t=o.substr(0,1),o=o.substr(1).trim());let[i,...f]=H(o.trim(),[":"]),u=f.reduce((l,m)=>{let[s,c]=H(m.trim(),["()"]);return l[s]=c||!0,l},{});n=[t,i,u],we.set(e,n)}return n.slice(0)}function Ge(e,r,n,o,t,i,f){let u=Object.keys(n),l=[];function m(s){let c=u.shift();if(!c)return o(s);if(l.push(c),c==="deep"||c==="deepest"){if(!s.length||c==="deepest"){let p=`*${i.delim}${r}${l.map(a=>`:${a}(${n[a]===!0?"":n[a]})`).join("")}`;return $([e],p,a=>!a.length&&c==="deepest"&&e.name===r?m([e]):m(a),t,i,f)}return m(s)}if(c==="having"||c==="not-having"){let p=[],a;return function h(){return s.length?$([a=s.shift()],n[c],_=>((c==="not-having"&&!_.length||_.length)&&p.push(a),h()),t,i):m(p)}()}throw new Error(`Modifier not recognized: ${c}`)}if((r==="*"||r===""&&u.length)&&(r="("+(t.ownKeys||t.keys)(e.value).join("+")+")"),te(r,"(",")")){let s=c=>m(c);return $([e],ee(r,"(",")"),s,t,i,f)}return function s(c=null){c&&c.unsubscribe&&c.unsubscribe();let p=t.get(e.value,r),a;i.realtime&&g(t.subscribe)&&!e.nowUnsubscribed&&(a=t.subscribe(e.value,r,()=>s(c),f));let h=Oe(e,r,p,a,c&&!0);return c=h,m(p?[h]:[])}()}var Oe=(e,r,n,o=null,t=!1)=>{let i=e&&e.path.concat(r)||[],f=()=>{l.forEach(m=>m()),o&&o(),e&&e.unsubscribeCallbacks.delete(f),u.nowUnsubscribed=!0};e&&e.unsubscribeCallbacks.add(f);let u={name:r,value:n,unsubscribe:f},l=new Set;return Object.defineProperties(u,{context:{value:e},path:{value:i},event:{value:t?u:e&&e.event},unsubscribeCallback:{value:o},unsubscribeCallbacks:{value:l},nowUnsubscribed:{value:e&&e.nowUnsubscribed,writable:!0}}),u};var I=class extends Map{constructor(...r){super(...r),this.observers=new Set,this.state=new Map}set(r,n){let o=super.set(r,n);return this.fire("set",r,n,r),o}delete(r){let n=super.delete(r);return this.fire("delete",r),n}get(r){return this.fire("get",r),super.get(r)}keyNames(){return Array.from(super.keys())}setState(r,n){let o=this.state.set(r,n);return this.fire("set:state",r,n),o}getState(r){return this.fire("get:state",r),this.state.get(r)}observe(r,n,o){let t={type:r,key:n,callback:o};return this.observers.add(t),()=>this.observers.delete(t)}unobserve(r,n,o){if(Array.isArray(r)||Array.isArray(n))throw new Error('The "type" and "key" arguments can only be strings.');this.observers.forEach(t=>{!(Q([r,"*"],t.type)&&Q([n,"*"],t.key)&&t.callback===o)||this.observers.delete(t)})}fire(r,n,...o){Array.from(this.observers).forEach(t=>{!(Q([r,"*"],t.type)&&Q([n,"*"],t.key))||t.callback(...o)})}},Q=(e,r)=>Array.isArray(r)?Y(e,r).length:e.includes(r);var P=(e,...r)=>L(e,"oohtml",...r);function je(e){let r=this;class n extends I{set(t,i){if(!("innerHTML"in i))throw new Error(`Value for namespace entry "${t}" must be an Element.`);return super.set(t,i)}expose(){return this}query(t,i,f={},u={}){let l=this.context;if(!l||l!==r.document&&!(l instanceof r.Element))throw new Error("HTMLNamespaceCollection.query() expects an element or the document object.");return be(l,t,i,{get:(m,s)=>n.node(m).get(s),keys:m=>n.node(m).keyNames(),subscribe:(m,s,c)=>n.node(m).observe(["set","delete"],s,c),...u},f)}static node(t){if(!P(t).has("namespace")){let i=new this;Object.defineProperty(i,"context",{value:t}),i.observe("get",f=>{if(i.has(f))return;let u=x(t.querySelectorAll(`[${r.CSS.escape(e.attr.id)}="${f}"]`)).filter(l=>{let m=l.parentNode.closest(e.namespaceSelector);return t===r.document?!m:m===t})[0];u&&i.set(f,u)}),P(t).set("namespace",i)}return P(t).get("namespace")}}return r.wq.HTMLNamespaceCollection=n,{HTMLNamespaceCollection:n}}function Ze(e){let r=this,{dom:n,HTMLNamespaceCollection:o}=r.wq;n.realtime().querySelectorAll(e.idSelector,(t,i)=>{let f=t.getAttribute(e.attr.id),u=t.parentNode&&t.parentNode.closest(e.namespaceSelector)||P(t).get("ownerNamespace");u||(u=r.document);let l=o.node(u);i?l.get(f)!==t&&(l.set(f,t),P(t).set("ownerNamespace",u)):l.get(f)===t&&(l.delete(f),P(t).delete("ownerNamespace"))},{each:!0})}function Re(e){let r=this,{HTMLNamespaceCollection:n}=r.wq;if(e.api.namespace in r.document)throw new Error(`document already has a "${e.api.namespace}" property!`);if(e.api.namespace in r.Element.prototype)throw new Error(`The "Element" class already has a "${e.api.namespace}" property!`);Object.defineProperty(r.document,e.api.namespace,{get:function(){return n.node(r.document).expose()}}),Object.defineProperty(r.Element.prototype,e.api.namespace,{get:function(){return n.node(this).expose()}})}function re(e={}){let r=this,o=xe.call(r).meta("oohtml").copyWithDefaults(e,{attr:{namespace:"namespace",id:"id"},api:{namespace:"namespace"},eagermode:!0});o.idSelector=`[${r.CSS.escape(o.attr.id)}]`,o.namespaceSelector=`[${r.CSS.escape(o.attr.namespace)}]`;let{HTMLNamespaceCollection:t}=je.call(this,o);return Ze.call(this,o),o.expose!==!1&&Re.call(this,o),{HTMLNamespaceCollection:t}}re.call(window);})();
//# sourceMappingURL=namespaced-html.js.map
