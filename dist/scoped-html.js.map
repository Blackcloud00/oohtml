{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../commons/js/isTypeObject.js","webpack:///../commons/js/isArray.js","webpack:///./src/chtml/ENV.js","webpack:///../commons/arr/from.js","webpack:///../commons/js/isEmpty.js","webpack:///../commons/js/isTypeArray.js","webpack:///../commons/js/isObject.js","webpack:///../commons/js/isFunction.js","webpack:///./src/scoped-html/ENV.js","webpack:///../commons/js/isUndefined.js","webpack:///../commons/js/isNumeric.js","webpack:///./src/scoped-js/ENV.js","webpack:///../commons/js/isString.js","webpack:///../commons/js/isNull.js","webpack:///../commons/arr/pushUnique.js","webpack:///../commons/js/isTypeFunction.js","webpack:///../commons/obj/each.js","webpack:///../commons/arr/unique.js","webpack:///../commons/arr/intersect.js","webpack:///../commons/obj/from.js","webpack:///../reflex/src/internal/Event.js","webpack:///../reflex/src/internal/QueryEvent.js","webpack:///../commons/js/isNumber.js","webpack:///../commons/js/isPlainObject.js","webpack:///../commons/js/isBoolean.js","webpack:///../commons/obj/even.js","webpack:///../commons/obj/compareCallback.js","webpack:///../reflex/src/internal/Fireable.js","webpack:///../reflex/src/internal/Firebase.js","webpack:///../reflex/src/internal/Trap.js","webpack:///../reflex/src/internal/TrapBase.js","webpack:///../commons/obj/getAllPropertyNames.js","webpack:///../commons/obj/getPrototypeChain.js","webpack:///../commons/obj/mergeCallback.js","webpack:///../commons/obj/copy.js","webpack:///../commons/obj/merge.js","webpack:///../reflex/src/internal/MutationEvent.js","webpack:///../reflex/src/internal/ObserverBase.js","webpack:///../reflex/src/unobserve.js","webpack:///../reflex/src/unlink.js","webpack:///../commons/js/getType.js","webpack:///../commons/obj/get.js","webpack:///../reflex/src/internal/Observer.js","webpack:///../commons/arr/crossJoin.js","webpack:///../reflex/src/observe.js","webpack:///../reflex/src/link.js","webpack:///../reflex/src/transaction.js","webpack:///../reflex/src/get.js","webpack:///../commons/js/isClass.js","webpack:///../commons/arr/all.js","webpack:///../reflex/src/has.js","webpack:///../reflex/src/_setProp.js","webpack:///../reflex/src/set.js","webpack:///../reflex/src/init.js","webpack:///../reflex/src/_getProps.js","webpack:///../reflex/src/keys.js","webpack:///../reflex/src/trap.js","webpack:///../reflex/src/def.js","webpack:///../reflex/src/del.js","webpack:///../reflex/src/internal/ListenerBase.js","webpack:///../reflex/src/internal/Listener.js","webpack:///../reflex/src/index.js","webpack:///../reflex/src/build.js","webpack:///../reflex/src/untrap.js","webpack:///../reflex/src/ownKeys.js","webpack:///../reflex/src/on.js","webpack:///../reflex/src/off.js","webpack:///../reflex/src/trigger.js","webpack:///../commons/str/after.js","webpack:///./src/ENV_ALL.js","webpack:///./src/scoped-html/Schema.js","webpack:///./src/scoped-html/ScopedHTML.js","webpack:///./src/scoped-html/disconnectedCallback.js","webpack:///./src/scoped-html/index.js","webpack:///./src/scoped-html/browser-entry.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Array","isArray","val","Window","Trap","ScopedHTML","ScopedJS","params","namespaceAttribute","bundleAttribute","importElement","keyValAttributes","listAttributes","norecomposeAttributes","recomposeCallback","castObject","keys","length","slice","values","toString","factory","rootAttribute","roleAttribute","hintAttribute","scopeTreePropertyName","arguments","undefined","isNaN","scriptElement","autoHide","globals","items","forEach","itm","arr","indexOf","push","returnValue","obj","k","callback","parseFloat","filter","index","self","arr2","val1","val2","target","details","this","$","propagationStopped","defaultPrevented","promisesInstance","promises","prop","promise","Promise","Error","all","rspns","proms","isEvent","stopPropagation","preventDefault","Event","super","getPrototypeOf","_even","obj1","obj2","assertion","depth","obj1Keys","obj2Keys","result","contn","v1","testPass","v2","netComparison","contrast","returnOnFirstFalse","disconnected","fireables","currentlyFiringEvents","fireable","tags","_fireable","query","observer","handler","type","Base","firebases","firebaseKey","set","Fireable","evt","next","recieved","Firebase","defaultHandler","e","_args","trap","fire","args","pop","createForTarget","getForTarget","keysAll","until","prototypalChain","getOwnPropertyNames","mergeCallback","objs","deepProps","isReplace","withSymbols","shift","valAtObj1","valAtObj2","getOwnPropertyDescriptor","data","fields","srcEvt","dataEven","originatingTarget","originatingType","originatingFields","originatingData","_originatingData","field","path","_path","originatingCreated","originatingDeleted","_data","created","deleted","findFireables","firebase","originalCallback","removeFireable","unobserve","reciever","_ctxt","ctxt","_key","exists","fieldsArray","isDynamicField","startsWith","endsWith","join","diff","fireCallback","fieldData","reduce","originatingField","_value","fieldQuery","split","currentValue","response","prevValue","dynamicFieldOutcomes","observedField","replace","inputOriginatingField","inputOriginatingFieldSplit","observedDynamicFieldOutcome","map","seg","observeUp","observeDown","currTable","column","newTable","row","_row","addFireable","Observer","observe","entries","_entries","base","MutationEvent","bubbling","context","targets","targetCopy","setData","_setData","delData","_delData","cntxt","mutationBase","initialKeys","currentKeys","changedKeys","concat","includes","unlink","returnEvent","trapBase","defaultGet","QueryEvent","test","Function","transaction","apply","prevTest","defaultHas","_state","keysOrPayload","handleSet","related","descriptor","define","success","defaultSet","_success","successStates","payloadKeys","state","_setProp","onGetFire","onSetFire","currentDescriptor","writable","newValue","defaultKeys","_keys","ownKeys","_getProps","defaultDel","listener","Static","deleteProperty","del","def","build","_init","init","untrap","link","has","on","Listener","off","trigger","search","subject","pos","afterLast","lastIndexOf","substr","ENV_ALL","commons","Chtml","Schema","std","html","model","singleton","caption","col","colgroup","dd","implicitRole","dt","figcaption","head","legend","li","optgroup","option","param","rp","rt","source","summary","track","tbody","td","tfoot","thead","tr","a","abbr","address","area","article","acceptableRoles","aside","audio","b","bdi","bdo","blockquote","body","br","button","canvas","cite","code","datalist","dfn","dialog","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","img","input","ins","kbd","label","main","mark","math","menu","meta","names","meter","nav","noscript","ol","output","picture","pre","progress","q","ruby","samp","script","section","select","slot","small","span","strong","style","sub","sup","svg","table","template","textarea","time","title","u","ul","var","video","wbr","aria","banner","contentinfo","complementary","navigation","list","listitem","el","elTagName","nodeName","toLowerCase","expandRules","roleInclusive","elSchema","currentElCategories","hasAttribute","getAttribute","role","trim","node","valid","contextModel","HTMLElement","getContentModelFor","nodeCategories","getCategoriesFor","allowedNode","disallowedNode","scope","nodeSchema","closest","contextCategories","current","parentNode","assertNodeBelongsInContentModel","rules","rles","categories","rule","matches","querySelector","scopeDefinition","ENV","store","find","nodesHint","add","isNode","_node","disconnectedCallback","MutationObserver","called","mutations","removedNodes","childList","_remove","nodeList","nodeNames","findExplicit","findImplicit","_objFrom","requestNodeName","definition","case","CSSEscape","CSS","escape","str","matchedNode","closestSuper","_matchedNode","closestSuperSelector","nodeSelector","shadowRoot","isSameNode","match","tries","selector","tagname","trie","querySelectorAll","assertNodeBelongsInScopeAs","schema","Element","window","WebNative"],"mappings":"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","file":"scoped-html.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 22);\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"object\".\r\n * This holds true for anything object, including built-ins.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val) || typeof val === 'object' || _isTypeFunction(val);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"array\".\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val);\r\n};\r\n","\r\n/**\r\n * We expect the following here\r\n */\r\nconst ENV = {\r\n    Window: null,\r\n    Trap: null,\r\n    ScopedHTML: null,\r\n    ScopedJS: null,\r\n    params: {\r\n        namespaceAttribute: 'namespace',\r\n        bundleAttribute: 'chtml-bundle',\r\n        importElement: 'chtml-import',\r\n        keyValAttributes: [],\r\n        listAttributes: [],\r\n        norecomposeAttributes: ['nocompose', 'shadow',],\r\n        recomposeCallback: null,\r\n    },\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default ENV;","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isTypeArray from '../js/isTypeArray.js';\r\nimport _isEmpty from '../js/isEmpty.js';\r\nimport _isObject from '../js/isObject.js';\r\n\r\n/**\r\n * Casts an array-like object to an array.\r\n *\r\n * @param mixed \tval\r\n * @param bool\t \tcastObject\r\n *\r\n * @return array\r\n */\r\nexport default function(val, castObject = true) {\r\n\tif (_isArray(val)) {\r\n\t\treturn val;\r\n\t};\r\n\tif (!castObject && _isObject(val)) {\r\n\t\treturn [val];\r\n\t};\r\n\tif (val !== false && val !== 0 && _isEmpty(val)) {\r\n\t\treturn [];\r\n\t};\r\n\tif (_isTypeArray(val)) {\r\n\t\treturn Array.prototype.slice.call(val);\r\n\t};\r\n\tif (_isObject(val)) {\r\n\t\treturn Object.values(val);\r\n\t};\r\n\treturn [val];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from './isNull.js';\r\nimport _isUndefined from './isUndefined.js';\r\nimport _isTypeObject from './isTypeObject.js';\r\n\r\n/**\r\n * Tells if val is empty in its own type.\r\n * This holds true for NULLs, UNDEFINED, FALSE, 0,\r\n * objects without keys, empty arrays.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isNull(val) || _isUndefined(val) || val === false || val === 0 \r\n\t\t|| (_isTypeObject(val) && !Object.keys(val).length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from './isString.js';\r\nimport _isUndefined from './isUndefined.js';\r\n\r\n/**\r\n * Tells if val is \"array-like\".\r\n * This holds true for anything that has a length property.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !_isString(val) && !_isUndefined(val.length);\r\n};\r\n","\r\n/**\r\n * Tells if val is pure object.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !Array.isArray(val) && typeof val === 'object' && val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"function\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isTypeFunction(val) || (val && {}.toString.call(val) === '[object function]');\r\n};\r\n","\r\n/**\r\n * We expect the following here\r\n */\r\nconst ENV = {\r\n    factory: null,\r\n    Window: null,\r\n    Trap: null,\r\n    params: {\r\n        rootAttribute: 'scope',\r\n        roleAttribute: 'scope',\r\n        hintAttribute: 'hint',\r\n        scopeTreePropertyName: 'scope',\r\n    },\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default ENV;","\r\n/**\r\n * Tells if val is undefined or is of type \"undefined\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn arguments.length && (val === undefined || typeof val === 'undefined');\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\" or a numeric string.\r\n * This holds true for both numbers and numeric strings.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val !== true && val !== false && val !== null && val !== '' && !isNaN(val * 1);\r\n};\r\n","\r\n/**\r\n * We expect the following here\r\n */\r\nconst ENV = {\r\n    Window: null,\r\n    Trap: null,\r\n    params: {\r\n        scriptElement: 'script[type=\"text/scoped-js\"]',\r\n        autoHide: true,\r\n    },\r\n    globals: {},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default ENV;","\r\n/**\r\n * Tells if val is of type \"string\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'string';\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is null.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === null || val === '';\r\n};\r\n","\r\n/**\r\n * Adds an item if not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...itms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...items) {\r\n\titems.forEach(itm => {\r\n\t\tif (arr.indexOf(itm) < 0) {\r\n\t\t\tarr.push(itm);\r\n\t\t}\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"function\".\r\n * This holds true for both regular functions and classes.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'function';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Loops thru obj flatly with a callback function.\r\n * Stops when callback returns a non-undefined value.\r\n *\r\n * @param array|object \t\t\tobj \t\t\tThe array or object to iterate.\r\n * @param function \t\t\t\tcallback \t\tThe callback function.\r\n *\r\n * @return mixed|null\t\t\tAny non-null return from callback\r\n */\r\nexport default function(obj, callback) {\r\n\tvar returnValue = undefined;\r\n\tif (_isTypeObject(obj)) {\r\n\t\tObject.keys(obj).forEach((k, i) => {\r\n\t\t\tif (returnValue !== false) {\r\n\t\t\t\treturnValue = callback(_isNumeric(k) ? parseFloat(k) : k, obj[k], i);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn returnValue;\r\n};\r\n","\r\n/**\r\n * Returns a list of unique items.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n *\t *\r\n * @return array\r\n */\r\nexport default function(arr) {\r\n\tconst distinct = (value, index, self) => {\r\n\t\treturn self.indexOf(value) === index;\r\n\t};\r\n\treturn arr.filter(distinct);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the intersection of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) !== -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isString from '../js/isString.js';\r\n\r\n/**\r\n * Return an object for the given pair(s) of input.\r\n *\r\n * @param string|array \t\t\tkey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nexport default function(key, val = null) {\r\n\tvar obj = {};\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(key)) {\r\n\t\t\tobj[key] = val;\r\n\t\t} else if (_isArray(key) && _isArray(val)) {\r\n\t\t\tkey.forEach((k, i) => obj[k] = val[i]);\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Event class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tthis.$ = {};\r\n\t\tthis.$.target = target;\r\n\t\tthis.$.details = details;\r\n\t\tthis.$.propagationStopped = false;\r\n\t\tthis.$.defaultPrevented = false;\r\n\t\tthis.$.promisesInstance = null;\r\n\t\tthis.$.promises = [];\r\n\t\t// -----------------------\r\n\t\t_each(details, (prop, value) => {\r\n\t\t\tif (prop !== '$') {\r\n\t\t\t\tObject.defineProperty(this, prop, {value});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the \"target\" object.\r\n\t *\r\n\t * @return array|object\r\n\t */\r\n\tget target() {\r\n\t\treturn this.$.target;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the \"details\" object.\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tget details() {\r\n\t\treturn this.$.details;\r\n\t}\r\n\r\n\t/**\r\n\t * -----------------------\r\n\t * RESPONSE HANDLERS\r\n\t * -----------------------\r\n\t */\r\n\r\n\t/**\r\n\t * Stops the evnt from reaching other listeners.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.$.propagationStopped = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if stopPropagation() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget propagationStopped() {\r\n\t\treturn this.$.propagationStopped;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a disposition that asks event initiator not to\r\n\t * proceed with default action.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.$.defaultPrevented = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if preventDefault() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget defaultPrevented() {\r\n\t\treturn this.$.defaultPrevented;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a Promise disposition.\r\n\t *\r\n\t * @param Promise\tpromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpromise(promise) {\r\n\t\tif (!(promise instanceof Promise)) {\r\n\t\t\tthrow new Error('Event.promise() must be called with a Promise.');\r\n\t\t}\r\n\t\tthis.$.promises.push(promise);\r\n\t\tthis.$.promisesInstance = null;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) returns all promises.\r\n\t *\r\n\t * @return Promise|null\r\n\t */\r\n\tget promises() {\r\n\t\tif (!this.$.promisesInstance && this.$.promises.length) {\r\n\t\t\tthis.$.promisesInstance = Promise.all(this.$.promises);\r\n\t\t}\r\n\t\treturn this.$.promisesInstance;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Evaluates the given disposition value and\r\n\t * calls an appropriate disposition method.\r\n\t *\r\n\t * @params mixed \trspns\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tresponse(rspns) {\r\n\t\tvar proms;\r\n\t\tvar isEvent = _isObject(rspns) && !_isUndefined(rspns.propagationStopped) && !_isUndefined(rspns.defaultPrevented)\r\n\t\tif ((rspns === false) || (isEvent && rspns.propagationStopped)) {\r\n\t\t\tthis.stopPropagation();\r\n\t\t} else if ((rspns === false) || (isEvent && rspns.defaultPrevented)) {\r\n\t\t\tthis.preventDefault();\r\n\t\t} else if ((rspns instanceof Promise && (proms = rspns))\r\n\t\t|| (isEvent && (proms = rspns.promises))) {\r\n\t\t\tthis.promise(proms);\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The QueryEvent class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Event {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tsuper(target, details);\r\n\t}\r\n};","\r\n/**\r\n * Tells if val is of type \"number\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'number';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if an object is direct instance of Object.prototype.\r\n * Quite useful in differentiating native objects and class instances from plain objects ({}).\r\n *\r\n * @param object \tobj\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj) {\r\n\treturn _isObject(obj) && Object.getPrototypeOf(obj) === Object.prototype;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"boolean\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === true || val === false;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNumber from '../js/isNumber.js';\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isPlainObject from '../js/isPlainObject.js';\r\nimport _compareCallback from './compareCallback.js';\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n * @param int\t\t\t\tdepth\r\n *\r\n * @return bool\r\n */\r\nconst _even = function(obj1, obj2, assertion = true, depth = 1) {\r\n\tif (_isArray(obj1) && _isArray(obj2) && obj1.length !== obj2.length) {\r\n\t\treturn !assertion;\r\n\t}\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar obj1Keys = Object.keys(obj1);\r\n\t\tvar obj2Keys = Object.keys(obj2);\r\n\t\tif (!obj1Keys.length && !obj2Keys.length) {\r\n\t\t\t// Objects that won't show keys must be compared by instance\r\n\t\t\t// Many native objects won't. So we can't judge by keys alone.\r\n\t\t\treturn _isPlainObject(obj1) && _isPlainObject(obj2) \r\n\t\t\t\t? assertion\r\n\t\t\t\t: (obj1 === obj2) === assertion;\r\n\t\t}\r\n\t\tif (!_even(obj1Keys, obj2Keys)) {\r\n\t\t\treturn !assertion;\r\n\t\t}\r\n\t}\r\n\tif (depth > 0 && ((_isArray(obj1) && _isArray(obj2)) || (_isObject(obj1) && _isObject(obj2)))) {\r\n\t\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\t\treturn _even(v1, v2, assertion, depth - 1);\r\n\t\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\t\treturn _isArray(result) \r\n\t\t\t? result.length === obj1.length && result.length === obj2.length \r\n\t\t\t: (_isObject(result) && _isObject(obj1) \r\n\t\t\t\t? Object.keys(result).length === Object.keys(obj1).length && Object.keys(result).length ===  Object.keys(obj2).length \r\n\t\t\t\t: result);\r\n\t}\r\n\treturn _isFunction(assertion) ? assertion(obj1, obj2) : (\r\n\t\t_isNumber(obj1) && _isNumber(obj2) && isNaN(obj1) && isNaN(obj2) \r\n\t\t\t? assertion \r\n\t\t\t: (obj1 === obj2) === assertion\r\n\t);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _even;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isBoolean from '../js/isBoolean.js';\r\nimport _each from './each.js';\r\n\r\n/**\r\n * Gets the match(es) between (members of) two values;\r\n * assertion optionally custom.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetComparison\r\n * @param bool\t\t\t\tcontrast\r\n * @param bool\t\t\t\treturnOnFirstFalse\r\n *\r\n * @return bool|array|object\r\n */\r\nexport default function(obj1, obj2, assertion = true, netComparison = true, contrast = false, returnOnFirstFalse = false) {\r\n\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\tvar result = [];\r\n\t\tvar contn = true;\r\n\t\tobj1.forEach(v1 => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = false;\r\n\t\t\t_each(obj2, (k, v2) => {\r\n\t\t\t\tif (!testPass || (netComparison && _isTypeObject(v1))) {\r\n\t\t\t\t\ttestPass = assertion(v1, v2);\r\n\t\t\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\t\t\ttestPass = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_isTypeObject(testPass) && netComparison) {\r\n\t\t\t\t\t\t// Further recursions should use this testPass as v1\r\n\t\t\t\t\t\tv1 = testPass;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult.push(netComparison ? testPass : v1);\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult.push(testPass);\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult.push(v1);\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar result = {};\r\n\t\tvar contn = true;\r\n\t\tObject.keys(obj1).forEach(k => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = assertion(obj1[k], obj2[k]);\r\n\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\ttestPass = false;\r\n\t\t\t}\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult[k] = netComparison ? testPass : obj1[k];\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult[k] = testPass;\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult[k] = obj1[k];\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n};\r\n","\r\n/**\r\n * ---------------------------\r\n * The Fireable class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Sets a \"disconnected\" flag on the Fireable.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tdisconnect() {\r\n\t\tthis.disconnected = true;\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport Fireable from './Fireable.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Firebase class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.fireables = [];\r\n\t\tthis.currentlyFiringEvents = [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds an Fireable instance\r\n\t * with optional tags.\r\n\t *\r\n\t * @param Fireable\t\t\tfireable\r\n\t *\r\n\t * @return Fireable\r\n\t */\r\n\taddFireable(fireable) {\r\n\t\tthis.fireables.push(fireable);\r\n\t\treturn fireable;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Removes an Fireable instance\r\n\t * with optional tags.\r\n\t *\r\n\t * @param Fireable\t\t\tfireable\r\n\t * @param array\t\t\t\ttags\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tremoveFireable(fireable, tags = []) {\r\n\t\tthis.fireables = this.fireables.filter(_fireable => _fireable !== fireable);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds the Observer instances\r\n\t * with the given query parameters.\r\n\t *\r\n\t * @param object\t\t\tquery\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfindFireables(query) {\r\n\t\treturn this.fireables.filter(observer => {\r\n\t\t\treturn (!query.handler || observer.handler === query.handler) && (!query.params || (\r\n\t\t\t\t(!query.params.type || observer.params.type === query.params.type)\r\n\t\t\t\t&& (!query.params.tags || _intersect(observer.params.tags || [], query.params.tags).length === query.params.tags.length)\r\n\t\t\t));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create an object's firebase.\r\n\t *\r\n\t * @param array|object\tobject\r\n\t * @param string\t\ttype\r\n\t *\r\n\t * @return Firebase\r\n\t */\r\n\tstatic createForTarget (object, type, Base) {\r\n\t\tif (object && _isTypeObject(object)) {\r\n\t\t\tvar firebases;\r\n\t\t\tif (!(firebases = object[firebaseKey])) {\r\n\t\t\t\tfirebases = {};\r\n\t\t\t\tObject.defineProperty(object, firebaseKey, {\r\n\t\t\t\t\tget:() => firebases,\r\n\t\t\t\t\tset:value => {\r\n\t\t\t\t\t\tif (value !== firebases) {\r\n\t\t\t\t\t\t\tthrow new Error('Attempt to overwrite the \"' + firebaseKey + '\" special property!');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tenumerable:false,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tfirebases[type] = type === 'listeners' ? new Base(object) : new Base;\r\n\t\t\treturn firebases[type];\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns an object's firebase.\r\n\t *\r\n\t * @param array|object\tobject\r\n\t * @param string\t\ttype\r\n\t *\r\n\t * @return Firebase\r\n\t */\r\n\tstatic getForTarget(object, type) {\r\n\t\tvar firebases;\r\n\t\tif (object && _isTypeObject(object) && (firebases = object[firebaseKey])) {\r\n\t\t\treturn firebases[type];\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @var string\r\n */\r\nconst firebaseKey = '.reflex';\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport QueryEvent from './QueryEvent.js';\r\nimport Fireable from './Fireable.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Trap class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Fireable {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param function\t\thandler\r\n\t * @param object\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(handler, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.handler = handler;\r\n\t\tthis.params = params;\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Calls the observer's handler function\r\n\t * on matching with the event's fields.\r\n\t *\r\n\t * @param MutationEvent\t\t\t \tevt\r\n\t * @param function\t\t\t\t\tnext\r\n\t * @param mixed\t\t\t\t\t \trecieved\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tfire(evt, next, recieved) {\r\n\t\tif (this.disconnected || (this.params.type && this.params.type !== evt.type)) {\r\n\t\t\treturn next(..._arrFrom(arguments).slice(2));\r\n\t\t}\r\n\t\treturn this.handler(evt, recieved, next);\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport QueryEvent from './QueryEvent.js';\r\nimport Firebase from './Firebase.js';\r\nimport Trap from './Trap.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nexport default class TrapBase extends Firebase {\r\n\t\r\n\t/**\r\n\t * Fires all observers with the given evt (change).\r\n\t *\r\n\t * @param Event\t\t\t\tevt\r\n\t * @param function\t\t\tdefaultHandler\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tfire(evt, defaultHandler = null) {\r\n\t\tif (this.currentlyFiringEvents.filter(e => e.type === evt.type && e.query === evt.query).length) {\r\n\t\t\treturn defaultHandler ? defaultHandler() : undefined;\r\n\t\t}\r\n\t\tthis.currentlyFiringEvents.push(evt);\r\n\t\tconst next = (index, ..._args) => {\r\n\t\t\tvar trap = this.fireables[index];\r\n\t\t\tif (trap) {\r\n\t\t\t\treturn trap.fire(evt, (...args) => {\r\n\t\t\t\t\treturn next(index + 1, ...args);\r\n\t\t\t\t}/*next*/, ..._args);\r\n\t\t\t}\r\n\t\t\treturn defaultHandler ? defaultHandler(..._args) : _args[0];\r\n\t\t};\r\n\t\tvar value = next(0);\r\n\t\tthis.currentlyFiringEvents.pop();\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic createForTarget(object) {\r\n\t\treturn super.createForTarget(object, 'traps', TrapBase);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic getForTarget(object) {\r\n\t\treturn super.getForTarget(object, 'traps');\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from '../arr/pushUnique.js';\r\nimport _getPrototypeChain from './getPrototypeChain.js';\r\n\r\n/**\r\n * Eagerly retrieves object members all down the prototype chain.\r\n *\r\n * @param object\t \tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return array\r\n */\r\nexport default function(obj, until) {\r\n\tvar keysAll = [];\r\n\t_getPrototypeChain(obj, until).forEach(obj => {\r\n\t\t_pushUnique(keysAll, ...Object.getOwnPropertyNames(obj));\r\n\t});\r\n\treturn keysAll;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the prototype chain.\r\n *\r\n * @param object \t\tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, until) {\r\n\tuntil = until || Object.prototype;\r\n\tuntil = until && !_isArray(until) ? [until] : until;\r\n\t// We get the chain of inheritance\r\n\tvar prototypalChain = [];\r\n\tvar obj = obj;\r\n\twhile((obj && (!until || until.indexOf(obj) < 0) && obj.name !== 'default')) {\r\n\t\tprototypalChain.push(obj);\r\n\t\tobj = obj ? Object.getPrototypeOf(obj) : null;\r\n\t}\r\n\treturn prototypalChain;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _getAllPropertyNames from './getAllPropertyNames.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function mergeCallback(objs, callback, deepProps = false, isReplace = false, withSymbols = true) {\r\n\tvar depth = 0;\r\n\tvar obj1 = objs.shift();\r\n\tif (_isNumeric(obj1) || obj1 === true || obj1 === false) {\r\n\t\tdepth = obj1;\r\n\t\tobj1 = objs.shift();\r\n\t}\r\n\tif (!objs.length) {\r\n\t\tthrow new Error('_merge() requires two or more array/objects.');\r\n\t}\r\n\tobjs.forEach((obj2, i) => {\r\n\t\tif (!_isTypeObject(obj2) && !_isFunction(obj2)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t(deepProps ? _getAllPropertyNames(obj2) : Object.getOwnPropertyNames(obj2)).forEach(key => {\r\n\t\t\tvar valAtObj1 = obj1[key];\r\n\t\t\tvar valAtObj2 = obj2[key];\r\n\t\t\tif (((_isArray(valAtObj1) && _isArray(valAtObj2)) || (_isObject(valAtObj1) && _isObject(valAtObj2))) \r\n\t\t\t&& (depth === true || depth > 0)) {\r\n\t\t\t\t// RECURSE...\r\n\t\t\t\tobj1[key] = _isArray(valAtObj1) && _isArray(valAtObj2) ? [] : {};\r\n\t\t\t\tmergeCallback([_isNumeric(depth) ? depth - 1 : depth, obj1[key], valAtObj1, valAtObj2], callback, deepProps, isReplace, withSymbols);\r\n\t\t\t} else if (callback(key, obj1, obj2, i)) {\r\n\t\t\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\t\t\tif (isReplace) {\r\n\t\t\t\t\t\tobj1[key] = valAtObj2;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj1.push(valAtObj2);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// In case we're setting a read-only property\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (withSymbols) {\r\n\t\t\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj2, key));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tobj1[key] = obj2[key];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn obj1;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tfilter\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = [], withSymbols = true) {\r\n\tvar depth = 0;\r\n\tif (_isNumeric(arguments[0]) && _isTypeObject(arguments[1])) {\r\n\t\tdepth = arguments[0];\r\n\t\tobj = arguments[1];\r\n\t\tfilter = arguments[2] || [];\r\n\t}\r\n\treturn _mergeCallback([depth, {}, obj], (key, obj1, obj2) => {\r\n\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t}, false/*deepProps*/, false/*isReplace*/, withSymbols);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (k, obj1, obj2) => {\r\n\t\treturn true;\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The MutationEvent class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Event {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tif (details.data) {\r\n\t\t\tdetails.fields = Object.keys(details.data);\r\n\t\t}\r\n\t\tsuper(target, details);\r\n\t\t// -----------------------\r\n\t\tif (this.srcEvt) {\r\n\t\t\tthis.dataEven = this.srcEvt.dataEven;\r\n\t\t\tthis.originatingTarget = this.srcEvt.originatingTarget;\r\n\t\t\tthis.originatingType = this.srcEvt.originatingType;\r\n\t\t\tthis.originatingFields = [];\r\n\t\t\tthis.originatingData = {};\r\n\t\t\tthis._originatingData = {};\r\n\t\t\tvar field = this.fields[0];\r\n\t\t\tObject.keys(this.srcEvt.originatingData).forEach(path => {\r\n\t\t\t\tvar _path = field + '.' + path;\r\n\t\t\t\tthis.originatingFields.push(_path);\r\n\t\t\t\tthis.originatingData[_path] = this.srcEvt.originatingData[path];\r\n\t\t\t\tthis._originatingData[_path] = this.srcEvt._originatingData[path];\r\n\t\t\t});\r\n\t\t\tthis.originatingCreated = this.srcEvt.originatingCreated;\r\n\t\t\tthis.originatingDeleted = this.srcEvt.originatingDeleted;\r\n\t\t} else {\r\n\t\t\tthis.dataEven = _even(this.data, this._data);\r\n\t\t\tthis.originatingTarget = this.target;\r\n\t\t\tthis.originatingType = this.type;\r\n\t\t\tthis.originatingFields = this.fields;\r\n\t\t\tthis.originatingData = this.data;\r\n\t\t\tthis._originatingData = this._data;\r\n\t\t\tthis.originatingCreated = this.created;\r\n\t\t\tthis.originatingDeleted = this.deleted;\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\nimport _concatUnique from '@web-native-js/commons/arr/concatUnique.js';\r\nimport _exclude from '@web-native-js/commons/arr/exclude.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport _isNull from '@web-native-js/commons/js/isNull.js';\r\nimport MutationEvent from './MutationEvent.js';\r\nimport Firebase from './Firebase.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nexport default class ObserverBase extends Firebase {\r\n\t\r\n\t/**\r\n\t * Finds the Observer instances\r\n\t * with the given query parameters.\r\n\t *\r\n\t * @param object\t\t\tquery\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfindFireables(query) {\r\n\t\treturn super.findFireables(query).filter(observer => {\r\n\t\t\treturn _isNull(query.fields) || _isUndefined(query.fields) || _even(_arrFrom(observer.fields), _arrFrom(query.fields));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires all observers with the given evt (change).\r\n\t *\r\n\t * @param Event\t\t\t\tevt\r\n\t *\r\n\t * @return Event\r\n\t */\r\n\tfire(evt) {\r\n\t\tif (this.currentlyFiringEvents.filter(e => e.type === evt.type && e.fields === evt.fields).length) {\r\n\t\t\treturn evt;\r\n\t\t}\r\n\t\tthis.currentlyFiringEvents.push(evt);\r\n\t\tthis.fireables.forEach(observer => {\r\n\t\t\tif (evt.propagationStopped || (observer.params.type && observer.params.type !== evt.type)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tobserver.fire(evt);\r\n\t\t});\r\n\t\tthis.currentlyFiringEvents.pop();\r\n\t\treturn evt;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic createForTarget(object) {\r\n\t\treturn super.createForTarget(object, 'observers', ObserverBase);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic getForTarget(object) {\r\n\t\treturn super.getForTarget(object, 'observers');\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from '@web-native-js/commons/js/isNull.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\n\r\n/**\r\n * Removes an observer from an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param string|array|function\t\tfields\r\n * @param function\t\t\t\t\toriginalCallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return void\r\n */\r\nexport default function(object, fields, originalCallback = null, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (_isFunction(fields) || _isNull(fields) || _isUndefined(fields)) {\r\n\t\tparams = arguments.length > 2 ? originalCallback : {};\r\n\t\toriginalCallback = fields;\r\n\t\tfields = null;\r\n\t}\r\n\tvar firebase;\r\n\tif (firebase = ObserverBase.getForTarget(object)) {\r\n\t\tfirebase.findFireables({handler:originalCallback, fields, params}).forEach(observer => {\r\n\t\t\tfirebase.removeFireable(observer);\r\n\t\t});\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport unobserve from './unobserve.js';\r\n\r\n/**\r\n * Unbubble helper\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tfield\r\n * @param array|object\tobject\r\n *\r\n * @return void\r\n */\r\nexport default function(target, field, object) {\r\n\tunobserve(object, null, {tags:['#e-bubbling', field, target]});\r\n}\r\n","\r\n/**\r\n * Returns the val's type.\r\n *\r\n * @param string \tval\r\n *\r\n * @return string\r\n */\r\nexport default function(val) {\r\n\treturn typeof val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isUndefined from '../js/isUndefined.js';\r\nimport _isNull from '../js/isNull.js';\r\nimport _arrFrom from '../arr/from.js';\r\n\r\n/**\r\n * Retrieves the value at the given path.\r\n *\r\n * A return value of undefined is ambiguous, and can mean either that the\r\n * path does not exist, or that the path actually exists but with a value of undefined. If it is required to\r\n * know whether the path actually exists, pass an object as a third argument.\r\n * This object will have an \"exists\" key set to true/false.\r\n *\r\n * @param object \t\t\t\tctxt\r\n * @param array \t\t\t\tpath\r\n * @param object \t\t\t\ttrap\r\n * @param object \t\t\t\treciever\r\n *\r\n * @return mixed\r\n */\r\nexport default function(ctxt, path, trap = {}, reciever = {}) {\r\n\tpath = _arrFrom(path).slice();\r\n\tvar _ctxt = ctxt;\r\n\twhile(!_isUndefined(_ctxt) && !_isNull(_ctxt) && path.length) {\r\n\t\tvar _key = path.shift();\r\n\t\tif (!(trap.get ? trap.get(_ctxt, _key) : (_isTypeObject(_ctxt) ? _key in _ctxt : _ctxt[_key]))) {\r\n\t\t\treciever.exists = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_ctxt = trap.get ? trap.get(_ctxt, _key) : _ctxt[_key];\r\n\t}\r\n\treciever.exists = true;\r\n\treturn _ctxt;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _crossJoin from '@web-native-js/commons/arr/crossJoin.js';\r\nimport _pushUnique from '@web-native-js/commons/arr/pushUnique.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _strAfter from '@web-native-js/commons/str/after.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _commonsGet from '@web-native-js/commons/obj/get.js';\r\nimport Fireable from './Fireable.js';\r\nimport MutationEvent from './MutationEvent.js';\r\nimport reflexGet from '../get.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Observer class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Fireable {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param function\t\thandler\r\n\t * @param string|array\tfields\r\n\t * @param object\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(handler, fields = null, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.handler = handler;\r\n\t\tthis.fields = fields;\r\n\t\tthis.params = params;\r\n\t\t// -----------------------\r\n\t\tthis.fieldsArray = _arrFrom(this.fields);\r\n\t\tthis.isDynamicField = this.fieldsArray.filter(\r\n\t\t\tfield => field.indexOf('..') > -1 || field.startsWith('.') || field.endsWith('.')\r\n\t\t).length;\r\n\t\tif (this.isDynamicField && this.fieldsArray.length > 1) {\r\n\t\t\tthrow new Error('Only one \"Dynamic Field\" must be observed at a time! \"' + this.fieldsArray.join(', ') + '\" have been bound together.');\r\n\t\t}\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Calls the observer's handler function\r\n\t * on matching with the event's fields.\r\n\t *\r\n\t * @param MutationEvent\t\t\t \tevt\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tfire(evt) {\r\n\t\tif (this.disconnected || (this.params.type && this.params.type !== evt.type)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (evt.dataEven && this.params.diff !== false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.fireCallback(evt, fields => {\r\n\t\t\tif (fields) {\r\n\t\t\t\t// Call listener...\r\n\t\t\t\tvar data = [];\r\n\t\t\t\tvar _data = [];\r\n\t\t\t\tif (this.params.data !== false) {\r\n\t\t\t\t\tfields.forEach(field => {\r\n\t\t\t\t\t\t// --------------------------\r\n\t\t\t\t\t\t// The NEW/OLD values of the change of field which could be a path\r\n\t\t\t\t\t\tvar fieldData = evt.originatingFields.reduce((fieldData, originatingField) => {\r\n\t\t\t\t\t\t\t// So field is the exact originatingField path?\r\n\t\t\t\t\t\t\tvar value = evt.originatingData[originatingField];\r\n\t\t\t\t\t\t\tvar _value = evt._originatingData[originatingField];\r\n\t\t\t\t\t\t\tif (!fieldData && field === originatingField) {\r\n\t\t\t\t\t\t\t\treturn [value, _value];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// Field matches, but is deeper than, originatingField path?\r\n\t\t\t\t\t\t\tif (!fieldData && (field + '.').startsWith((originatingField + '.'))) {\r\n\t\t\t\t\t\t\t\tvar fieldQuery = _strAfter(field, originatingField + '.');\r\n\t\t\t\t\t\t\t\treturn [\r\n\t\t\t\t\t\t\t\t\t// Notice we're using _commonsGet to dig the path\r\n\t\t\t\t\t\t\t\t\t// but with reflexGet as trap for \"reactive getting\"\r\n\t\t\t\t\t\t\t\t\t_commonsGet(value, fieldQuery.split('.'), {get:reflexGet}),\r\n\t\t\t\t\t\t\t\t\t_commonsGet(_value, fieldQuery.split('.'), {get:reflexGet})\r\n\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn fieldData;\r\n\t\t\t\t\t\t}, null);\r\n\t\t\t\t\t\t// --------------------------\r\n\t\t\t\t\t\tif (fieldData) {\r\n\t\t\t\t\t\t\tdata.push(fieldData.shift());\r\n\t\t\t\t\t\t\t_data.push(fieldData.shift());\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar currentValue = _commonsGet(evt.target, _isString(field) ? field.split('.') : field, {get:reflexGet});\r\n\t\t\t\t\t\t\tdata.push(currentValue);\r\n\t\t\t\t\t\t\t_data.push(currentValue);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn _isArray(this.fields) // NOTE:we're asking the original format!\r\n\t\t\t\t\t? evt.response(this.handler(data, _data, evt))\r\n\t\t\t\t\t: evt.response(this.handler(data[0], _data[0], evt));\r\n\t\t\t}\r\n\t\t\tvar data = {};\r\n\t\t\tvar _data = {};\r\n\t\t\tevt.fields.forEach(field => {\r\n\t\t\t\t// Remeber that evt.originatingData might actually be bubbling\r\n\t\t\t\t// in which case we don't expect to see eventName key.\r\n\t\t\t\tvar currentValue = field in evt.data \r\n\t\t\t\t\t? evt.data[field] \r\n\t\t\t\t\t: reflexGet(evt.target, field);\r\n\t\t\t\tvar prevValue = field in evt._data\r\n\t\t\t\t\t? evt._data[field] \r\n\t\t\t\t\t: currentValue;\r\n\t\t\t\tdata[field] = currentValue;\r\n\t\t\t\t_data[field] = prevValue;\r\n\t\t\t});\r\n\t\t\t// Call listener...\r\n\t\t\treturn evt.response(this.handler(data, _data, evt));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Validates a proposed fire operation.\r\n\t *\r\n\t * @param MutationEvent\t\t \tevt\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tfireCallback(evt, callback) {\r\n\t\tif (this.fieldsArray.length) {\r\n\t\t\tvar dynamicFieldOutcomes = [];\r\n\t\t\tvar matches = this.fieldsArray.filter((observedField, i) => {\r\n\t\t\t\tobservedField = _isString(observedField) \r\n\t\t\t\t\t? observedField.replace(/`/g, '')\r\n\t\t\t\t\t: observedField;\r\n\t\t\t\tdynamicFieldOutcomes[i] = [];\r\n\t\t\t\t// one observedField can turn out to be two if dynamic\r\n\t\t\t\t// and evt.originatingFields is multiple\r\n\t\t\t\treturn evt.originatingFields.filter(inputOriginatingField => {\r\n\t\t\t\t\tvar inputOriginatingFieldSplit = inputOriginatingField.split('.');\r\n\t\t\t\t\tvar observedDynamicFieldOutcome = this.isDynamicField \r\n\t\t\t\t\t\t? observedField.split('.').map((seg, k) => seg || inputOriginatingFieldSplit[k] || '').join('.')\r\n\t\t\t\t\t\t: observedField;\r\n\t\t\t\t\t_pushUnique(dynamicFieldOutcomes[i], observedDynamicFieldOutcome);\r\n\t\t\t\t\treturn (observedDynamicFieldOutcome === inputOriginatingField && !evt.srcEvt\r\n\t\t\t\t\t\t|| (this.params.observeUp !== false && (observedDynamicFieldOutcome + '.').startsWith(inputOriginatingField + '.'))\r\n\t\t\t\t\t\t|| (this.params.observeDown && (inputOriginatingField + '.').startsWith(observedDynamicFieldOutcome + '.'))\r\n\t\t\t\t\t) && (!this.isDynamicField || !observedDynamicFieldOutcome.split('.').filter(seg => !seg).length);\r\n\t\t\t\t}).length;\r\n\t\t\t}).length;\r\n\t\t\tif (matches) {\r\n\t\t\t\t_crossJoin(dynamicFieldOutcomes).forEach(callback);\r\n\t\t\t}\r\n\t\t} else if (!this.fields/** if this.fieldsArray is empty because this.fields is null */\r\n\t\t\t&& (!evt.srcEvt || this.params.observeDown)) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from './from.js';\r\n\r\n/**\r\n * Accepts a list of column and joins them to a table.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nexport default function(arr) {\r\n\treturn arr.reduce((currTable, column) => {\r\n\t\tvar newTable = [];\r\n\t\tcurrTable.forEach(row => {\r\n\t\t\t_arrFrom(column).forEach(column => {\r\n\t\t\t\tvar _row = row.slice();\r\n\t\t\t\t_row.push(column);\r\n\t\t\t\tnewTable.push(_row);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn newTable;\r\n\t}, [[]]);\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _getType from '@web-native-js/commons/js/getType.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport Observer from './internal/Observer.js';\r\n\r\n/**\r\n * Adds an observer to an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param string|array|function\t\tfields\r\n * @param function\t\t\t\t\tcallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return Observer\r\n */\r\nexport default function(object, fields, callback = null, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (_isFunction(fields)) {\r\n\t\tparams = arguments.length > 2 ? callback : {};\r\n\t\tcallback = fields;\r\n\t\tfields = null;\r\n\t}\r\n\tif (!_isFunction(callback)) {\r\n\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t}\r\n\tvar firebase;\r\n\tif (!(firebase = ObserverBase.getForTarget(object))) {\r\n\t\tfirebase = ObserverBase.createForTarget(object);\r\n\t}\r\n\treturn firebase.addFireable(new Observer(callback, fields, params));\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _objFrom from '@web-native-js/commons/obj/from.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport observe from './observe.js';\r\n\r\n/**\r\n * Bubble helper\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tfield\r\n * @param array|object\tobject\r\n *\r\n * @return void\r\n */\r\nexport default function(target, field, object) {\r\n\tvar firebase;\r\n\tobserve(object, (entries, _entries, e) => {\r\n\t\tif (firebase = ObserverBase.getForTarget(target)) {\r\n\t\t\tvar base = _objFrom(field, object);\r\n\t\t\treturn firebase.fire(new MutationEvent(target, {type:e.type, bubbling:true, data:base, _data:base, srcEvt:e}));\r\n\t\t}\r\n\t}, {observeDown:true, tags:['#e-bubbling', field, target]});\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _copy from '@web-native-js/commons/obj/copy.js';\r\nimport _merge from '@web-native-js/commons/obj/merge.js';\r\nimport _unique from '@web-native-js/commons/arr/unique.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport unlink from './unlink.js';\r\nimport link from './link.js';\r\n\r\n/**\r\n * Executes a callback function on a target in \"transaction\" mode.\r\n * Fires any observers that may be bound to target on recorded changes.\r\n *\r\n * @param array\t\t\ttargets\r\n * @param function\t\tcallback\r\n * @param array\t\t\tkeys\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return array|Event\r\n */\r\nexport default function(targets, callback, keys = [], returnEvent = false) {\r\n\tvar context = targets.map((target, i) => {\r\n\t\tif (!target || !_isTypeObject(target)) {\r\n\t\t\tthrow new Error('Target must be of type object!');\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttarget,\r\n\t\t\ttargetCopy: _copy(target, keys),\r\n\t\t\tsetData: {},\r\n\t\t\t_setData: {},\r\n\t\t\tdelData: {}, \r\n\t\t\t_delData: {},\r\n\t\t\tcreated: [],\r\n\t\t\tdeleted: [],\r\n\t\t};\r\n\t});\r\n\t// ---------------------------------\r\n\tvar result = callback(...targets);\r\n\t// ---------------------------------\r\n\tcontext.map(cntxt => {\r\n\t\tvar initialKeys = Object.keys(cntxt.targetCopy);\r\n\t\tvar currentKeys = Object.keys(cntxt.target);\r\n\t\tvar changedKeys = _unique(initialKeys.concat(currentKeys)).filter(key => {\r\n\t\t\tif ((keys.length && !keys.includes(key)) \r\n\t\t\t|| (_isArray(cntxt.target) && (key === 'length' || key === '.reflex'))) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!currentKeys.includes(key)) {\r\n\t\t\t\tcntxt._delData[key] = cntxt.targetCopy[key];\r\n\t\t\t\tcntxt.delData[key] = undefined;\r\n\t\t\t\tcntxt.deleted.push(key);\r\n\t\t\t} else {\r\n\t\t\t\tcntxt._setData[key] = cntxt.targetCopy[key];\r\n\t\t\t\tcntxt.setData[key] = cntxt.target[key];\r\n\t\t\t\tif (!initialKeys.includes(key)) {\r\n\t\t\t\t\tcntxt.created.push(key);\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t\tif (cntxt.targetCopy[key] !== cntxt.target[key]) {\r\n\t\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\t\tif (cntxt.targetCopy[key] && _isTypeObject(cntxt.targetCopy[key])) {\r\n\t\t\t\t\tunlink(cntxt.target, key, cntxt.targetCopy[key]);\r\n\t\t\t\t}\r\n\t\t\t\t// Observe incoming value for bubbling\r\n\t\t\t\tif (cntxt.target[key] && _isTypeObject(cntxt.target[key])) {\r\n\t\t\t\t\tlink(cntxt.target, key, cntxt.target[key]);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tdelete cntxt.setData[key];\r\n\t\t\tdelete cntxt._setData[key];\r\n\t\t});\r\n\t\t// ---------------------------------\r\n\t\tvar evt, mutationBase;\r\n\t\tif ((mutationBase = ObserverBase.getForTarget(cntxt.target)) || returnEvent) {\r\n\t\t\tevt = new MutationEvent(cntxt.target, {\r\n\t\t\t\ttype:'transaction', \r\n\t\t\t\tdata:_merge(cntxt.setData, cntxt.delData),\r\n\t\t\t\t_data:_merge(cntxt._setData, cntxt._delData),\r\n\t\t\t\tcreated:cntxt.created,\r\n\t\t\t\tdeleted:cntxt.deleted\r\n\t\t\t});\r\n\t\t\tif (mutationBase) {\r\n\t\t\t\tif (Object.keys(cntxt.delData).length) {\r\n\t\t\t\t\tevt.response(mutationBase.fire(\r\n\t\t\t\t\t\tnew MutationEvent(cntxt.target, {type:'del', data:cntxt.delData, _data:cntxt._delData, deleted:cntxt.deleted})\r\n\t\t\t\t\t));\r\n\t\t\t\t}\r\n\t\t\t\tif (Object.keys(cntxt.setData).length) {\r\n\t\t\t\t\tevt.response(mutationBase.fire(\r\n\t\t\t\t\t\tnew MutationEvent(cntxt.target, {type:'set', data:cntxt.setData, _data:cntxt._setData, created:cntxt.created})\r\n\t\t\t\t\t));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn returnEvent ? evt : changedKeys;\r\n\t});\r\n\treturn result;\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _objFrom from '@web-native-js/commons/obj/from.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isNumeric from '@web-native-js/commons/js/isNumeric.js';\r\nimport _isClass from '@web-native-js/commons/js/isClass.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport transaction from './transaction.js';\r\n\r\n/**\r\n * Runs a \"get\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n *\r\n * @return mixed\r\n */\r\nexport default function(target, keys) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"get\" traps, otherwise \"get\" the default way\r\n\tvar value, trapBase, defaultGet = function(_value) {\r\n\t\treturn arguments.length ? _value : (_isArray(keys) ? _objFrom(keys, target) : target[keys]);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\tvalue = trapBase.fire(new QueryEvent(target, {type:'get', query:keys}), defaultGet);\r\n\t} else {\r\n\t\tvalue = defaultGet();\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute array methods in \"mutation\" mode\r\n\tif (_isArray(target) && !_isNumeric(keys) && _isFunction(value) && !_isClass(value)) {\r\n\t\treturn function reflexArrayMethodWrapper(...args) {\r\n\t\t\treturn transaction([target], () => {\r\n\t\t\t\treturn value.apply(target, args);\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\treturn value;\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"class\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isTypeFunction(val) && /^class\\s?/.test(Function.prototype.toString.call(val));\r\n};\r\n","\r\n/**\r\n * Tells if ALL items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nexport default function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest && callback(itm), true);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\n\r\n/**\r\n * Runs an \"in\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tkey\r\n *\r\n * @return bool\r\n */\r\nexport default function(target, key) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"has\" traps, otherwise \"test\" the default way\r\n\tvar trapBase, defaultHas = function(_state) {\r\n\t\treturn arguments.length ? _state : (key in target);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\treturn trapBase.fire(new QueryEvent(target, {type:'has', query:key}), defaultHas);\r\n\t}\r\n\treturn defaultHas();\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _all from '@web-native-js/commons/arr/all.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isNumber from '@web-native-js/commons/js/isNumber.js';\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport unlink from './unlink.js';\r\nimport link from './link.js';\r\nimport reflexHas from './has.js';\r\n\r\n/**\r\n * Executes a \"_setProp\" type of operation on a target.\r\n * Fires any observers for the specific type that may be bound to target.\r\n *\r\n * @param bool\t\t\tdefine\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(define, target, keysOrPayload, value = null, returnEvent = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\tif (_isObject(keysOrPayload)) {\r\n\t\treturnEvent = value;\r\n\t}\r\n\tvar keys = keysOrPayload, _data = {}, data = {}, created = [];\r\n\tvar handleSet = (key, value, related) => {\r\n\t\t_data[key] = target[key];\r\n\t\tif (!reflexHas(target, key)) {\r\n\t\t\tcreated.push(key);\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tvar descriptor;\r\n\t\tif (define) {\r\n\t\t\tdescriptor = value || {};\r\n\t\t\tvalue = descriptor.value;\r\n\t\t}\r\n\t\t// Execute any \"set\" traps, otherwise \"set\" the default way\r\n\t\tvar success, trapBase, defaultSet = function(_success) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\tif (descriptor) {\r\n\t\t\t\t\tObject.defineProperty(target, key, descriptor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget[key] = value;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn _success;\r\n\t\t};\r\n\t\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\t\tvar details = descriptor \r\n\t\t\t\t? {type:'def', query:key, descriptor, related} \r\n\t\t\t\t: {type:'set', query:key, value, related};\r\n\t\t\tsuccess = trapBase.fire(new QueryEvent(target, details), defaultSet);\r\n\t\t} else {\r\n\t\t\tsuccess = defaultSet();\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tif (success) {\r\n\t\t\tdata[key] = value;\r\n\t\t\tif (data[key] !== _data[key]) {\r\n\t\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\t\tif (_data[key] && _isTypeObject(_data[key])) {\r\n\t\t\t\t\tunlink(target, key, _data[key]);\r\n\t\t\t\t}\r\n\t\t\t\t// Observe incoming value for bubbling\r\n\t\t\t\tif (data[key] && _isTypeObject(data[key])) {\r\n\t\t\t\t\tlink(target, key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdelete data[key];\r\n\t\t\t\tdelete _data[key];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdelete _data[key];\r\n\t\t}\r\n\t\treturn success;\r\n\t};\r\n\t// ---------------------------------\r\n\tvar successStates = [];\r\n\tif (_isArray(keys) || ((_isString(keys) || _isNumber(keys)) && (keys = _arrFrom(keys)))) {\r\n\t\tsuccessStates = keys.map(key => handleSet(key, value, keys))\r\n\t} else if (_isObject(keysOrPayload)) {\r\n\t\tvar payloadKeys = Object.keys(keysOrPayload);\r\n\t\tsuccessStates = payloadKeys.map(key => handleSet(key, keysOrPayload[key], payloadKeys))\r\n\t}\r\n\t// ---------------------------------\r\n\tvar evt, mutationBase;\r\n\tif ((mutationBase = ObserverBase.getForTarget(target)) || returnEvent) {\r\n\t\tevt = new MutationEvent(target, {type:'set', data, _data, created});\r\n\t\tif (mutationBase) {\r\n\t\t\tmutationBase.fire(evt);\r\n\t\t}\r\n\t}\r\n\treturn returnEvent ? evt : _all(successStates, state => state);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _setProp from './_setProp.js';\r\n\r\n/**\r\n * Executes a \"set\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keysOrPayload, value = null, returnEvent = false) {\r\n\treturn _setProp(false/*define*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport reflexGet from './get.js';\r\nimport reflexSet from './set.js';\r\n\r\n/**\r\n * Initializes \"Reflxive getter/setter\" traps on the target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n *\r\n * @return void\r\n */\r\nexport default function(target, keys) {\r\n\t_arrFrom(keys).forEach(key => {\r\n\t\tvar value = target[key], onGetFire, onSetFire;\r\n\t\tvar currentDescriptor = Object.getOwnPropertyDescriptor(target, key)\r\n\t\t|| {enumerable: key in target ? false/*existing but hidden*/ : true};\r\n\t\tif ('value' in currentDescriptor) {\r\n\t\t\tdelete currentDescriptor.value;\r\n\t\t}\r\n\t\tif ('writable' in currentDescriptor) {\r\n\t\t\tdelete currentDescriptor.writable;\r\n\t\t}\r\n\t\tcurrentDescriptor.get = () => {\r\n\t\t\tif (onGetFire) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tonGetFire = true;\r\n\t\t\tvar _value = reflexGet(target, key);\r\n\t\t\tonGetFire = false;\r\n\t\t\treturn _value;\r\n\t\t};\r\n\t\tcurrentDescriptor.set = newValue => {\r\n\t\t\tif (onSetFire) {\r\n\t\t\t\tvalue = newValue;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tonSetFire = true;\r\n\t\t\tvar rspns = reflexSet(target, key, newValue);\r\n\t\t\tonSetFire = false;\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tObject.defineProperty(target, key, currentDescriptor);\r\n\t});\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\n\r\n/**\r\n * Runs a \"getProps\" type of query operation on a target.\r\n * Fires any observers for the specific type that may be bound to target.\r\n *\r\n * @param bool\t\t\townKeys\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(ownKeys, target) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"keys\" traps, otherwise \"test\" the default way\r\n\tvar trapBase, defaultKeys = function(_keys) {\r\n\t\treturn arguments.length ? _keys : (\r\n\t\t\townKeys ? Object.getOwnPropertyNames(target) : Object.keys(target)\r\n\t\t);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\treturn trapBase.fire(new QueryEvent(target, {type:ownKeys ? 'ownKeys' : 'keys'}), defaultKeys);\r\n\t}\r\n\treturn defaultKeys();\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _getProps from './_getProps.js';\r\n\r\n/**\r\n * Runs a \"keys\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(target) {\r\n\treturn _getProps(false/*ownKeys*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _getType from '@web-native-js/commons/js/getType.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport Trap from './internal/Trap.js';\r\n\r\n/**\r\n * Adds a trap to an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param function\t\t\t\t\tcallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return Trap\r\n */\r\nexport default function(object, callback, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (!_isFunction(callback)) {\r\n\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t}\r\n\tvar firebase;\r\n\tif (!(firebase = TrapBase.getForTarget(object))) {\r\n\t\tfirebase = TrapBase.createForTarget(object);\r\n\t}\r\n\treturn firebase.addFireable(new Trap(callback, params));\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _setProp from './_setProp.js';\r\n\r\n/**\r\n * Executes a \"set\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keysOrPayload, value = null, returnEvent = false) {\r\n\treturn _setProp(true/*define*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _all from '@web-native-js/commons/arr/all.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport unlink from './unlink.js';\r\nimport reflexHas from './has.js';\r\n\r\n/**\r\n * Executes a \"delete\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keys, returnEvent = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\tvar keys = _arrFrom(keys), _data = {}, data = {}, deleted = [];\r\n\tvar successStates = keys.map(key => {\r\n\t\t_data[key] = target[key];\r\n\t\tif (reflexHas(target, key)) {\r\n\t\t\tdeleted.push(key);\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\t// Execute any \"del\" traps, otherwise \"del\" the default way\r\n\t\tvar success, trapBase, defaultDel = function(_success) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\tdelete target[key];\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn _success;\r\n\t\t};\r\n\t\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\t\tsuccess = trapBase.fire(new QueryEvent(target, {type:'del', query:key, related:keys}), defaultDel);\r\n\t\t} else {\r\n\t\t\tsuccess = defaultDel();\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tif (success) {\r\n\t\t\tdata[key] = undefined;\r\n\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\tif (_data[key] && _isTypeObject(_data[key])) {\r\n\t\t\t\tunlink(target, key, _data[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t});\r\n\t// ---------------------------------\r\n\tvar evt, mutationBase;\r\n\tif ((mutationBase = ObserverBase.getForTarget(target)) || returnEvent) {\r\n\t\tevt = new MutationEvent(target, {type:'del', data, _data, deleted});\r\n\t\tif (mutationBase && Object.keys(data).length) {\r\n\t\t\tmutationBase.fire(evt);\r\n\t\t}\r\n\t}\r\n\treturn returnEvent ? evt : _all(successStates, state => state);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Firebase from './Firebase.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The ListenerBase class\r\n * ---------------------------\r\n */\t\t\t\t\r\nexport default class ListenerBase extends Firebase {\r\n\t\r\n\t/**\r\n\t * Fires all observers with the given evt (change).\r\n\t *\r\n\t * @param Event\t\t\t\tevt\r\n\t *\r\n\t * @return Event\r\n\t */\r\n\tfire(evt) {\r\n\t\tthis.fireables.forEach(listener => {\r\n\t\t\tif (evt.propagationStopped) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlistener.fire(evt);\r\n\t\t});\r\n\t\treturn evt;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic createForTarget(object, Static = ListenerBase) {\r\n\t\treturn super.createForTarget(object, 'listeners', Static);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic getForTarget(object) {\r\n\t\treturn super.getForTarget(object, 'listeners');\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport Fireable from './Fireable.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Listener class\r\n * ---------------------------\r\n */\t\t\t\t\r\nexport default class extends Fireable {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param function\t\thandler\r\n\t * @param object\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(handler, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.handler = handler;\r\n\t\tthis.params = params;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calls the observer's handler function\r\n\t * on matching with the event's fields.\r\n\t *\r\n\t * @param MutationEvent\t\t\t \tevt\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tfire(evt) {\r\n\t\tif (this.params.type === evt.type) {\r\n\t\t\tevt.response(this.handler.call(this.target, evt.e));\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport build from './build.js';\r\nimport observe from './observe.js';\r\nimport unobserve from './unobserve.js';\r\nimport trap from './trap.js';\r\nimport untrap from './untrap.js';\r\nimport def from './def.js';\r\nimport set from './set.js';\r\nimport del from './del.js';\r\nimport link from './link.js';\r\nimport unlink from './unlink.js';\r\nimport transaction from './transaction.js';\r\nimport get from './get.js';\r\nimport has from './has.js';\r\nimport init from './init.js';\r\nimport keys from './keys.js';\r\nimport ownKeys from './ownKeys.js';\r\nimport on from './on.js';\r\nimport off from './off.js';\r\nimport trigger from './trigger.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport Event from './internal/Event.js';\r\n\r\n// Now we'll mimick standard Trap properties\r\n// so that can be used as standard Trap out of the box.\r\nconst deleteProperty = del;\r\nconst defineProperty = def;\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default {\r\n\tbuild,\r\n\tobserve,\r\n\tunobserve,\r\n\ttrap,\r\n\tuntrap,\r\n\tdef,\r\n\tdefineProperty,\r\n\tset,\r\n\tdel,\r\n\tdeleteProperty,\r\n\tlink,\r\n\tunlink,\r\n\ttransaction,\r\n\tget,\r\n\thas,\r\n\tinit,\r\n\tkeys,\r\n\townKeys,\r\n\ton,\r\n\toff,\r\n\ttrigger,\r\n\t// Events\r\n\tMutationEvent,\r\n\tQueryEvent,\r\n\tEvent,\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport init from './init.js';\r\nimport reflexKeys from './keys.js';\r\nimport reflexGet from './get.js';\r\nimport link from './link.js';\r\n\r\n/**\r\n * Recursively \"connects\" an object's members to the object\r\n * for reflex actions.\r\n *\r\n * @param array|object\ttarget\r\n * @param bool\t\t\t_init\r\n *\r\n * @return void\r\n */\r\nexport default function build(target, _init = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\tvar keys = reflexKeys(target);\r\n\tkeys.forEach(key => {\r\n\t\tvar value = reflexGet(target, key);\r\n\t\tif (_isTypeObject(value) && value) {\r\n\t\t\tlink(target, key, value);\r\n\t\t\tbuild(value, _init);\r\n\t\t}\r\n\t});\r\n\tif (_init) {\r\n\t\tinit(target, keys);\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\n\r\n/**\r\n * Removes a trap from an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param function\t\t\t\t\toriginalCallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return void\r\n */\r\nexport default function(object, originalCallback = null, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tvar firebase;\r\n\tif (firebase = ObserverBase.getForTarget(object)) {\r\n\t\tfirebase.findFireables({handler:originalCallback, params}).forEach(trap => {\r\n\t\t\tfirebase.removeFireable(trap);\r\n\t\t});\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _getProps from './_getProps.js';\r\n\r\n/**\r\n * Runs a \"ownKeys\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(target) {\r\n\treturn _getProps(true/*ownKeys*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _merge from '@web-native-js/commons/obj/merge.js';\r\nimport ListenerBase from './internal/ListenerBase.js';\r\nimport Listener from './internal/Listener.js';\r\n\r\n/**\r\n * Binds listeners to an element's event controller.\r\n *\r\n * @param array|object \t\t\t\tobject\r\n * @param string\t\t \t\t\ttype\r\n * @param function\t\t \t\t\tcallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return object\r\n */\r\nexport default function(object, type, callback, params = {}) {\r\n\tvar firebase;\r\n\tif (!(firebase = ListenerBase.getForTarget(object))) {\r\n\t\tfirebase = ListenerBase.createForTarget(object);\r\n\t}\r\n\treturn firebase.addFireable(new Listener(callback, _merge(params, {type})));\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport ListenerBase from './internal/ListenerBase.js';\r\n\r\n/**\r\n * Unbinds listeners from an element's event controller.\r\n *\r\n * @param array|object \t\t\t\tobject\r\n * @param string\t\t \t\t\ttype\r\n * @param function\t\t \t\t\toriginalCallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return void\r\n */\r\nexport default function(object, type, originalCallback = null, params = {}) {\r\n\tvar firebase;\r\n\tif (firebase = ListenerBase.getForTarget(object)) {\r\n\t\tfirebase.findFireables({handler:originalCallback, type, params}).forEach(listener => {\r\n\t\t\tfirebase.removeFireable(listener);\r\n\t\t});\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _merge from '@web-native-js/commons/obj/merge.js';\r\nimport ListenerBase from './internal/ListenerBase.js';\r\nimport Event from './internal/Event.js';\r\n\r\n/**\r\n * Fires an event on an object's listenerBase.\r\n *\r\n * @param array|object \t\t\tobject\r\n * @param string                type\r\n * @param object                data\r\n *\r\n * @return Event\r\n */\r\nexport default function(object, type, data = {}) {\r\n\tvar firebase;\r\n\tif (firebase = ListenerBase.getForTarget(object)) {\r\n\t\treturn firebase.fire(new Event(object, _merge(data, {type})));\r\n\t}\r\n};","\r\n/**\r\n * Return the remainder of a string after a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   afterLast\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search, afterLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = afterLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn '';\r\n\t}\r\n\treturn subject.substr(pos + search.length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\nimport SCOPED_HTML_ENV from './scoped-html/ENV.js';\r\nimport SCOPED_JS_ENV from './scoped-js/ENV.js';\r\nimport CHTML_ENV from './chtml/ENV.js';\r\n\r\n/**\r\n * Configures all ENVs with common values.\r\n * \r\n * @param object COMMON_ENV\r\n * \r\n * @return void\r\n */\r\nexport default function ENV_ALL(commons) {\r\n    _each(commons, (property, value) => {\r\n        SCOPED_HTML_ENV[property] = value;\r\n        SCOPED_JS_ENV[property] = value;\r\n        CHTML_ENV[property] = value;\r\n    });\r\n};\r\n\r\n// Individual Access\r\nENV_ALL.ScopedHTML = SCOPED_HTML_ENV;\r\nENV_ALL.ScopedJS = SCOPED_JS_ENV;\r\nENV_ALL.Chtml = CHTML_ENV;\r\n// Default common Trap\r\nENV_ALL.Chtml.ScopedHTML = SCOPED_HTML_ENV;\r\nENV_ALL.Chtml.ScopedJS = SCOPED_JS_ENV;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _pushUnique from '@web-native-js/commons/arr/pushUnique.js';\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The HTML Context Model Schema.\r\n * @see https://html.spec.whatwg.org/multipage\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n/**\r\n * @object\r\n */\r\nconst Schema = {\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\tstd: {\r\n\t\t/**\r\n\t\t * @uncategorized\r\n\t\t */\r\n\t\thtml: {\r\n\t\t\ttype: ['#sectioning-root'],\r\n\t\t\tmodel: ['head', 'body'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcaption: {\r\n\t\t\tmodel: ['#flow', '!table'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcol: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tcolgroup: {\r\n\t\t\tmodel: [{'colgroup[span]': ['#nothing']}, {':not(colgroup[span])': ['col', 'template']}],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tdd: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'definition',\r\n\t\t},\r\n\t\tdt: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tfigcaption: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thead: {\r\n\t\t\tmodel: ['#metadata'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlegend: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tli: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'listitem',\r\n\t\t},\r\n\t\toptgroup: {\r\n\t\t\tmodel: ['option', '#script-supporting'],\r\n\t\t\timplicitRole: 'group',\r\n\t\t},\r\n\t\toption: {\r\n\t\t\tmodel: [{'option[label][value]': ['#nothing']}, {'option[label]:not(option[value])': ['#text']}, {':not(option[label])': ['#text']}],\r\n\t\t},\r\n\t\tparam: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\trp: {\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\trt: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsource: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tsummary: {\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#phrasing', '#heading'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttrack: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttbody: {\r\n\t\t\tmodel: ['#script-supporting', 'tr'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t},\r\n\t\ttfoot: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tthead: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttr: {\r\n\t\t\tmodel: ['#script-supporting', 'td', 'th'],\r\n\t\t},\r\n\t\t/**\r\n\t\t * @categorized\r\n\t\t */\r\n\t\ta: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'a[href]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#interactive', '!a'],\r\n\t\t},\r\n\t\tabbr: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing',],\r\n\t\t},\r\n\t\taddress: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer', '!address',],\r\n\t\t},\r\n\t\t// If a child of <map>\r\n\t\tarea: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tarticle: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'article',\r\n\t\t\tacceptableRoles: ['application', 'article', 'document', 'main',],\r\n\t\t},\r\n\t\taside: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'complementary',\r\n\t\t\tacceptableRoles: ['complementary', 'note', 'search',],\r\n\t\t},\r\n\t\taudio: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'audio[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(audio[src])': ['source']}],\r\n\t\t},\r\n\t\tb: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbase: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbdi: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbdo: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tblockquote: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\tbody: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow', '@banner', '@contentinfo', '@complementary', '@main'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tbutton: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#phrasing', '!#interactive'],\r\n\t\t},\r\n\t\tcanvas: {\r\n\t\t\ttype: ['#embedded', '#flow', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#transparent', '!#interactive', 'a', 'img[usemap]', 'button', 'input[type=\"button\"]', 'input[type=\"radio\"]', 'input[type=\"checkbox\"]', 'select[multiple]', 'select[size>=1]', /*has tabindex but not #interactive*/'[tabindex]!#interactive'],\r\n\t\t},\r\n\t\tcite: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tcode: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdata: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdatalist: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '#script-supporting', 'option'],\r\n\t\t},\r\n\t\tdel: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tdetails: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow', 'summary'],\r\n\t\t},\r\n\t\tdfn: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '!dfn'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tdialog: {\r\n\t\t\ttype: ['#flow', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'dialog',\r\n\t\t},\r\n\t\tdiv: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [{'dl > div': ['dt', 'dd']}, {div/*TODO':not(dl > div)'*/: ['#flow']}],\r\n\t\t},\r\n\t\tdl: {\r\n\t\t\t/*complicated*/\r\n\t\t\ttype: ['#flow', /*{:contains(> * name-value group): ['#palpable']}*/],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#script-supporting', 'dl', 'dt', 'div'],\r\n\t\t},\r\n\t\tem: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tembed: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tfieldset: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['legend', '#flow'],\r\n\t\t},\r\n\t\tfigure: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['#flow', 'figcaption'],\r\n\t\t\timplicitRole: 'figure',\r\n\t\t},\r\n\t\tfooter: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['contentinfo',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tform: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!form'],\r\n\t\t},\r\n\t\th1: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th2: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th3: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th4: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th5: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th6: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\theader: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['banner',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thgroup: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '#script-supporting'],\r\n\t\t},\r\n\t\thr: {\r\n\t\t\ttype: ['#flow'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\timplicitRole: 'separator',\r\n\t\t},\r\n\t\ti: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tiframe: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\timg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'img[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tinput: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'input:not([type!=\"hidden\"])': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tins: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tkbd: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!label'],\r\n\t\t},\r\n\t\tlink: {\r\n\t\t\ttype: ['#metadata', {'body link': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tmain: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'main',\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tmap: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmark: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmath: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\tmenu: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tmeta: {\r\n\t\t\ttype: ['#metadata', {'meta[itemprop]': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tnames: ['application-name', 'author', 'description', 'generator', 'keywords', 'referrer', 'theme-color'],\r\n\t\t},\r\n\t\tmeter: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tnav: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'navigation',\r\n\t\t\tacceptableRoles: ['navigation',],\r\n\t\t},\r\n\t\tnoscript: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing'], \r\n\t\t\tmodel: [{'head link': ['style', 'meta', 'link']}, {':not(head link)': ['#transparent', '!noscript']}],\r\n\t\t},\r\n\t\tobject: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'object[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', 'param'],\r\n\t\t},\r\n\t\tol: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\toutput: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tp: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tpicture: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing'], \r\n\t\t\tmodel: ['source', 'img', '#acript-supporting'],\r\n\t\t},\r\n\t\tpre: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tprogress: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!progress'],\r\n\t\t},\r\n\t\tq: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\truby: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'],\r\n\t\t\t/*complicated*/ \r\n\t\t\tmodel: ['rp', 'rt'],\r\n\t\t},\r\n\t\ts: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsamp: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tscript: {\r\n\t\t\ttype: ['#flow', '#metadata', '#phrasing', '#acript-supporting'], \r\n\t\t\tmodel: [{'script[src]': []}],\r\n\t\t},\r\n\t\tsection: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'region',\r\n\t\t\tacceptableRoles: ['alert', 'alertdialog', 'application', 'contentinfo', 'dialog', 'document', 'log', 'main', 'marquee', 'region', 'search', 'status',],\r\n\t\t},\r\n\t\tselect: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['option', 'optgroup', '#acript-supporting'],\r\n\t\t},\r\n\t\tslot: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tsmall: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tspan: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstrong: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstyle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\tsub: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsup: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsvg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\ttable: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['caption', 'colgroup', 'thead', 'tbody', 'tr', 'tfoot', '#script-supporting'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\ttemplate: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing', '#script-supporting'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttextarea: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\ttime: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: [{'time[datetime]': ['#phrasing']}, {':not(time[datetime])': ['#text']}],\r\n\t\t},\r\n\t\ttitle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tu: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tul: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tvar: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tvideo: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'video[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(video[src])': ['source']}],\r\n\t\t},\r\n\t\twbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\taria: {\r\n\t\tbanner: {\r\n\t\t\ttype: ['@banner'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcontentinfo: {\r\n\t\t\ttype: ['@contentinfo'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcomplementary: {\r\n\t\t\ttype: ['@complementary'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tnavigation: {\r\n\t\t\ttype: ['@navigation'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlist: {\r\n\t\t\ttype: ['@list'], \r\n\t\t},\r\n\t\tlistitem: {\r\n\t\t\ttype: ['@listitem'], \r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic content model for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetContentModelFor(el) { \r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\treturn Schema.std[elTagName] ? Schema.expandRules(el, Schema.std[elTagName].model || []) : [];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic categories for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param bool\t\t\t\t\t\troleInclusive\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCategoriesFor(el, roleInclusive = true) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\tvar elSchema = Schema.std[elTagName] || Schema.aria[elTagName] || {};\r\n\t\tvar currentElCategories = [];\r\n\t\tif (roleInclusive && !el.nodeName.startsWith('#') \r\n\t\t&& (el.hasAttribute('role') || elSchema.implicitRole)) {\r\n\t\t\t// Current el's impliable/acceptable roles\r\n\t\t\t// (These take precedence over native semantics)\r\n\t\t\tif (el.hasAttribute('role')) {\r\n\t\t\t\tvar definedRoles = el.getAttribute('role').split(' ');\r\n\t\t\t\tel.getAttribute('role').split(' ').forEach(role => {\r\n\t\t\t\t\tif (elSchema && elSchema.acceptableRoles && !elSchema.acceptableRoles.includes(role)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trole = role.trim();\r\n\t\t\t\t\tcurrentElCategories.push('@' + role);\r\n\t\t\t\t\tif (Schema.aria[role] && Schema.aria[role].type) {\r\n\t\t\t\t\t\tcurrentElCategories = currentElCategories.concat(Schema.expandRules(el, Schema.aria[role].type || []));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (elSchema.implicitRole) {\r\n\t\t\t\t_pushUnique(currentElCategories, '@' + elSchema.implicitRole, elTagName);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Current node's categories/tagname\r\n\t\t\tvar currentElCategories = _pushUnique(Schema.expandRules(el, elSchema.type || []), elTagName);\r\n\t\t}\r\n\t\treturn currentElCategories;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node belongs in the context's content model\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tcontext\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInContentModel(context, node) {\r\n\t\tvar contextModel = context instanceof HTMLElement \r\n\t\t\t? Schema.getContentModelFor(context)\r\n\t\t\t: context;\r\n\t\tvar nodeCategories = node instanceof HTMLElement \r\n\t\t\t? Schema.getCategoriesFor(node)\r\n\t\t\t: node;\r\n\t\tif (_intersect(contextModel, ['#nothing', '#text']).length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar valid;\r\n\t\t// So current content model has to list either this node's categories,\r\n\t\t// tagname, or impliable/acceptable roles\r\n\t\tcontextModel.forEach(allowedNode => {\r\n\t\t\tif (allowedNode.startsWith('!')) {\r\n\t\t\t\tvar disallowedNode = allowedNode.substr(1);\r\n\t\t\t\tif (nodeCategories.includes(disallowedNode)) {\r\n\t\t\t\t\tvalid = false;\r\n\t\t\t\t}\r\n\t\t\t} else if (valid !== false) {\r\n\t\t\t\tif (nodeCategories.includes(allowedNode)) {\r\n\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn valid && true;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node is associated to the context directly\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tscope\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t * @param object\t\t\t\t\tnodeSchema\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInScopeAs(scope, node, nodeSchema = null) {\r\n\t\tvar contextCategories = Schema.getCategoriesFor(scope);\r\n\t\tvar closest, current = node, nodeModel;\r\n\t\twhile (!closest && (current = current.parentNode)) {\r\n\t\t\tif (_intersect(contextCategories, Schema.getCategoriesFor(current)).length\r\n\t\t\t\t&& Schema.assertNodeBelongsInContentModel(current, nodeSchema ? (nodeSchema.type || node) : node)\r\n\t\t\t) {\r\n\t\t\t\tclosest = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn closest === scope;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Flattens the schema rules for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param array\t\t\t\t\t\trules\r\n\t *\r\n\t * @return array\r\n\t */\r\n\texpandRules(el, rules) {\r\n\t\tvar rles = rules.reduce((categories, rule) => {\r\n\t\t\tif (_isObject(rule)) {\r\n\t\t\t\tif (el.matches(Object.keys(rule)[0])) {\r\n\t\t\t\t\tcategories = categories.concat(Object.values(rule)[0]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcategories.push(rule);\r\n\t\t\t}\r\n\t\t\treturn categories;\r\n\t\t}, []);\r\n\t\tif (rles.includes('#sectioning-root')) {\r\n\t\t\trles.push('#sectioning-content');\r\n\t\t}\r\n\t\treturn rles;\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Schema;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isNumeric from '@web-native-js/commons/js/isNumeric.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\nimport disconnectedCallback from './disconnectedCallback.js';\r\nimport Schema from './Schema.js';\r\nimport ENV from './ENV.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class {\r\n\r\n\t/**\r\n\t * Initializes the new Chtml instance.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el) {\r\n\t\t// ---------------------------\r\n\t\tObject.defineProperty(this, '_el', {value:el});\r\n\t\tObject.defineProperty(this, 'el', {\r\n\t\t\tvalue:el.nodeName === '#document' ? el.querySelector('html') : el,\r\n\t\t});\r\n\r\n\t\t// ------------\r\n\t\t// ROLES\r\n\t\t// ------------\r\n\t\t\r\n\t\tconst scopeDefinition = (el.getAttribute(ENV.params.rootAttribute) || '')\r\n\t\t\t.split(' ').map(r => r.trim()).filter(r => r);\r\n\t\tObject.defineProperty(this, 'definition', {value:scopeDefinition});\r\n\t\t\r\n\t\t// ------------\r\n\t\t// TREE\r\n\t\t// ------------\r\n\t\t\r\n\t\tconst store = {};\r\n\t\tObject.defineProperty(this, 'store', {value:store});\r\n\t\tif (ENV.Trap) {\r\n\t\t\tif (ENV.Trap.trap) {\r\n\t\t\t\tENV.Trap.trap(store, (e, recieved, next) => {\r\n\t\t\t\t\treturn next(recieved || this.find(e.query));\r\n\t\t\t\t}, {type:'get'});\r\n\t\t\t}\r\n\t\t\tif (ENV.Trap.init) {\r\n\t\t\t\t// The following nodes, being prelisted,\r\n\t\t\t\t// can be accessed dynamically\r\n\t\t\t\tconst nodesHint = (el.getAttribute(ENV.params.hintAttribute) || '')\r\n\t\t\t\t\t.split(' ').map(r => r.trim()).filter(r => r);\r\n\t\t\t\tENV.Trap.init(this.store, nodesHint);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds a node instance.\r\n\t *\r\n\t * @param string|int\t nodeName\r\n\t * @param mixed\t\t\t node\r\n\t *\r\n\t * @return Element\r\n\t */\r\n\tadd(nodeName, node) {\r\n\t\tvar add = (target, key, node, isNode = false) => {\r\n\t\t\tvar _node = node;\r\n\t\t\tif (isNode) {\r\n\t\t\t\t_node = ENV.factory ? ENV.factory(node, this) : node;\r\n\t\t\t}\r\n\t\t\t// Set with trap?\r\n\t\t\tif (ENV.Trap && ENV.Trap.set) {\r\n\t\t\t\tENV.Trap.set(target, key, _node);\r\n\t\t\t} else if (_isArray(target)) {\r\n\t\t\t\ttarget.push(_node);\r\n\t\t\t} else {\r\n\t\t\t\ttarget[key] = _node;\r\n\t\t\t}\r\n\t\t\tif (isNode) {\r\n\t\t\t\t// We'll remove from tree at the\r\n\t\t\t\t// time it leaves the DOM\r\n\t\t\t\tdisconnectedCallback(node, () => {\r\n\t\t\t\t\tif (ENV.Trap && ENV.Trap.deleteProperty) {\r\n\t\t\t\t\t\tENV.Trap.deleteProperty(target, key);\r\n\t\t\t\t\t} else if (_isArray(target)) {\r\n\t\t\t\t\t\t_remove(target, _node);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdelete target[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t};\r\n\t\tif (_isArray(node)) {\r\n\t\t\tvar nodeList = [];\r\n\t\t\tnode.forEach((_node, i) => add(nodeList, i, _node, true/** isNode */));\r\n\t\t\tadd(this.store, nodeName, nodeList);\r\n\t\t\treturn nodeList;\r\n\t\t}\r\n\t\treturn add(this.store, nodeName, node);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets a node or list of nodes.\r\n\t *\r\n\t * @param string|int|array\t nodeNames\r\n\t *\r\n\t * @return Chtml|array|object\r\n\t */\r\n\tfind(nodeNames) {\r\n\t\t_arrFrom(nodeNames).forEach(nodeName => {\r\n\t\t\tif (nodeName in this.store) {\r\n\t\t\t\t// Arrays must not be reused!\r\n\t\t\t\t// Their sources of nodes cant be guaranteed to be same.\r\n\t\t\t\t// this.store[nodeName] could also be an empty getter/setter\r\n\t\t\t\t// So the instanceof is the way to go for both problems\r\n\t\t\t\treturn this.store[nodeName];\r\n\t\t\t}\r\n\t\t\tvar node;\r\n\t\t\tif ((node = this.findExplicit(nodeName))\r\n\t\t\t|| (node = this.findImplicit(nodeName))) {\r\n\t\t\t\tthis.add(nodeName, node);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn _isArray(nodeNames) ? _objFrom(nodeNames, this.store) : this.store[nodeNames];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from explicit tree.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tfindExplicit(requestNodeName) {\r\n\t\t// If given a rolecase, we can perform a query if we understand the semantics.\r\n\t\tif (this.definition && this.definition.length) {\r\n\t\t\tvar definition = this.case ? [this.case] : this.definition;\r\n\t\t\t// Find matches...\r\n\t\t\tvar CSSEscape = ENV.Window.CSS ? ENV.Window.CSS.escape : str => str;\r\n\t\t\treturn definition.reduce((matchedNode, role) => {\r\n\t\t\t\tif (!matchedNode) {\r\n\t\t\t\t\tvar closestSuperSelector = '[' + CSSEscape(ENV.params.rootAttribute) + '~=\"' + role + '\"]';\r\n\t\t\t\t\tvar nodeSelector = '[' + CSSEscape(ENV.params.roleAttribute) + '~=\"' + role + '-' + requestNodeName + '\"]';\r\n\t\t\t\t\tvar closestSuper, _matchedNode;\r\n\t\t\t\t\tif ((_matchedNode = (this.el.shadowRoot || this.el).querySelector(nodeSelector))\r\n\t\t\t\t\t// If this.el has a shadowRoot, we don't expect _matchedNode to be able to find is superRole element.\r\n\t\t\t\t\t// If it finds one, then its not for the curren superRole element.\r\n\t\t\t\t\t&& ((this.el.shadowRoot && !(_matchedNode.parentNode.closest && _matchedNode.parentNode.closest(closestSuperSelector)))\r\n\t\t\t\t\t// _matchedNode must find this.el as its superRole element to qualify.\r\n\t\t\t\t\t\t|| (!this.el.shadowRoot && _matchedNode.parentNode && (closestSuper = _matchedNode.parentNode.closest(closestSuperSelector)) && closestSuper.isSameNode(this.el))\r\n\t\t\t\t\t)) {\r\n\t\t\t\t\t\tmatchedNode = _matchedNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn matchedNode;\r\n\t\t\t}, null);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from implicit tree.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|array\r\n\t */\r\n\tfindImplicit(requestNodeName) {\r\n\t\tif (_isNumeric(requestNodeName) || requestNodeName.match(/[^a-zA-Z0-9\\-]/)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Use Schema...\r\n\t\tvar nodeSchema, nodeSelector = [];\r\n\t\tvar tries = [];\r\n\t\tif (Schema.aria[requestNodeName]) {\r\n\t\t\ttries.push({\r\n\t\t\t\tSchema: Schema.aria[requestNodeName],\r\n\t\t\t\tselector: ['[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\ttries.push({\r\n\t\t\t\tSchema: Schema.std[requestNodeName] || Schema.aria[requestNodeName],\r\n\t\t\t\tselector: [requestNodeName, '[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t}\r\n\t\t_each(Schema.std, (tagname, Schema) => {\r\n\t\t\tif (Schema.implicitRole === requestNodeName) {\r\n\t\t\t\ttries.push({\r\n\t\t\t\t\tSchema: Schema,\r\n\t\t\t\t\tselector: [tagname],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar matches = null;\r\n\t\ttries.forEach(trie => {\r\n\t\t\t(this.el.shadowRoot || this.el).querySelectorAll(trie.selector.join(',')).forEach(node => {\r\n\t\t\t\tif (Schema.assertNodeBelongsInScopeAs(this.el, node, trie.schema)) {\r\n\t\t\t\t\tif (trie.schema && trie.schema.singleton) {\r\n\t\t\t\t\t\tmatches = node;\r\n\t\t\t\t\t} else if (!matches || _isArray(matches)) {\r\n\t\t\t\t\t\tmatches = matches || [];\r\n\t\t\t\t\t\tmatches.push(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (!matches && trie.schema && !trie.schema.singleton) {\r\n\t\t\t\tmatches = [];\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn matches;\r\n\t}\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport ENV from '../ENV_ALL.js';\r\n\r\n/**\r\n * Creates a MutationObserver that fires when\r\n * the element leaves the DOM.\r\n *\r\n * @param string\t\t\t\t\t\tinput\r\n * @param function\t\t\t\t\tcallback\r\n *\r\n * @return void\r\n */\r\nexport default function disconnectedCallback(el, callback) {\r\n\tif (el.parentNode && ENV.Window.MutationObserver) {\r\n\t\tvar called = false;\r\n\t\tvar observer = new ENV.Window.MutationObserver(mutations => {\r\n\t\t\tmutations.forEach(m => {\r\n\t\t\t\tif (!called && _arrFrom(m.removedNodes).includes(el)) {\r\n\t\t\t\t\tcalled = true;\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tobserver.observe(el.parentNode, {childList:true});\r\n\t\tdisconnectedCallback(el.parentNode, () => {\r\n\t\t\tif (!called) {\r\n\t\t\t\tcalled = true;\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Reflex from '@web-native-js/reflex';\r\nimport ScopedHTML from './ScopedHTML.js';\r\nimport Schema from './Schema.js';\r\nimport ENV from './ENV.js';\r\n\r\n/**\r\n * @init\r\n */\r\nScopedHTML.init = function(Window, Trap = Reflex) {\r\n    ENV.Window = Window;\r\n    ENV.Trap = Trap;\r\n    if (!ENV.Window || !('Element' in ENV.Window)) {\r\n        throw new Error('The \"Element\" class not found in global context!');\r\n    }\r\n    if (ENV.params.scopeTreePropertyName in ENV.Window.Element.prototype) {\r\n        throw new Error('The \"Element\" class already has a \"scope\" property!');\r\n    }\r\n    Object.defineProperty(ENV.Window.Element.prototype, ENV.params.scopeTreePropertyName, {\r\n        get: function() {\r\n            if (!this['.scopedHTML']) {\r\n                this['.scopedHTML'] = new ScopedHTML(this);\r\n                if (ENV.Trap && ENV.Trap.link) {\r\n                    ENV.Trap.link(this, ENV.params.scopeTreePropertyName, this['.scopedHTML'].store);\r\n                }\r\n            }\r\n            return this['.scopedHTML'].store;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n    ScopedHTML as default,\r\n    Schema,\r\n    ENV,\r\n}","\r\n/**\r\n * @imports\r\n */\r\nimport ScopedHTML, {ENV} from './index.js';\r\n\r\n/**\r\n * @window\r\n */\r\nScopedHTML.init(window);\r\nif (!window.WebNative) {\r\n    window.WebNative = {};\r\n}\r\nwindow.WebNative.ScopedHTML = ScopedHTML;\r\nwindow.WebNative.ScopedHTML.ENV = ENV;\r\n"],"sourceRoot":""}