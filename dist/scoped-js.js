(()=>{function x(n){return!Array.isArray(n)&&typeof n=="object"&&n}function g(n){return Array.isArray(n)}function N(n){return typeof n=="function"}function I(n){return n===null||n===""}function E(n){return arguments.length&&(n===void 0||typeof n>"u")}function b(n){return Array.isArray(n)||typeof n=="object"&&n||N(n)}function D(n){return I(n)||E(n)||n===!1||n===0||b(n)&&!Object.keys(n).length}function _(n){return N(n)||n&&{}.toString.call(n)==="[object function]"}function j(n){return n instanceof Number||typeof n=="number"}function S(n){return j(n)||n!==!0&&n!==!1&&n!==null&&n!==""&&!isNaN(n*1)}function P(n){return n instanceof String||typeof n=="string"&&n!==null}function V(n){return!P(n)&&!E(n.length)}function R(n,...e){return e.forEach(t=>{n.indexOf(t)<0&&n.push(t)}),n}function U(i,e){e=e||Object.prototype,e=e&&!g(e)?[e]:e;for(var t=[],i=i;i&&(!e||e.indexOf(i)<0)&&i.name!=="default";)t.push(i),i=i?Object.getPrototypeOf(i):null;return t}function Q(n,e){var t=[];return U(n,e).forEach(i=>{R(t,...Object.getOwnPropertyNames(i))}),t}function A(n,e,t=!1,i=!1,r=!1){var s=0,o=n.shift();if((S(o)||o===!0||o===!1)&&(s=o,o=n.shift()),!n.length)throw new Error("_merge() requires two or more array/objects.");return n.forEach((u,l)=>{!b(u)&&!_(u)||(t?Q(u):Object.getOwnPropertyNames(u)).forEach(f=>{if(!!e(f,o,u,l)){var a=o[f],c=u[f];if((g(a)&&g(c)||x(a)&&x(c))&&(s===!0||s>0))o[f]=g(a)&&g(c)?[]:{},A([S(s)?s-1:s,o[f],a,c],e,t,i,r);else if(g(o)&&g(u))i?o[f]=c:o.push(c);else try{r?Object.defineProperty(o,f,Object.getOwnPropertyDescriptor(u,f)):o[f]=u[f]}catch{}}})}),o}function $(...n){return A(n,(e,t,i)=>!0,!1,!1,!1)}function v(n,e=!0){return g(n)?n:!e&&x(n)?[n]:n!==!1&&n!==0&&D(n)?[]:V(n)?Array.prototype.slice.call(n):x(n)?Object.values(n):[n]}function F(n,e,t={},i={}){e=v(e).slice();for(var r=n;!E(r)&&!I(r)&&e.length;){var s=e.shift();if(!(t.get?t.get(r,s):b(r)?s in r:r[s])){i.exists=!1;return}r=t.get?t.get(r,s):r[s]}return i.exists=!0,r}function J(n,e,t,i={},r={}){let s=(a,c,p)=>r.set?r.set(a,c,p):(S(e[u])&&g(a)?a.push(p):a[c]=p,!0);e=v(e);for(var o=n,u=0;u<e.length;u++)if(u<e.length-1){if(!o||!b(o)&&!_(o))return!1;var l=F(o,e[u],r);if(!b(l)){if(r.buildTree===!1)return!1;l=_(r.buildTree)?r.buildTree(u):S(e[u+1])?[]:{};var f=s(o,e[u],l);if(!f)return!1}o=l}else return s(o,e[u],t)}var se=n=>{let e=n.wq;return e.apiMutationsBindings=[new Map,new Map],e.apiMutationsBindings.hasListeners=()=>e.apiMutationsBindings.some(t=>t.size),e.apiMutationsHooks=new Set,class{attr(i,r,s){[i,r,s]=W(arguments);let o=new n.MutationObserver(l=>{l.forEach(f=>s({target:f.target,name:f.attributeName,oldValue:f.oldValue,type:"attribute-record"},i))}),u={attributes:!0,attributeOldValue:!0};return r.length&&(u.attributeFilter=r),o.observe(i,u),o}match(i,r,s,o={}){[i,r,s,o={}]=W(arguments);let u=new Set,l=f=>(u.has(f)||u.set(f,{target:f,connectedNodes:[],disconnectedNodes:[],type:"query-record"}),u.get(f));return r.every(f=>P(f))&&(r=r.join(","))?(!o.on||o.on==="connected")&&(o.subtree?i.querySelectorAll(r):i.children||[]).forEach(f=>{l(f.parentNode).connectedNodes.push(f)}):r.every(f=>x(f))&&(i!==document||o.subtree)&&r.forEach(f=>{let a=i===document?f.isConnected:f.parentNode===i||o.subtree&&i.contains(f);((!o.on||o.on==="connected")&&a||o.on==="disconnected"&&!a)&&l(f.parentNode)[a?"connectedNodes":"disconnectedNodes"].push(f)}),u.forEach(f=>s(f,i)),this.observe(...arguments)}observe(i,r,s,o={}){let{document:u}=n;u.readyState==="loading"&&!e.parsetimeApiMutations&&(e.parsetimeApiMutations=new Set,oe(n,c=>{!e.parsetimeApiMutations||c.incomingNodes.concat(c.outgoingNodes).forEach(p=>{e.parsetimeApiMutations.add(p)})}),u.addEventListener("readystatechange",()=>{e.parsetimeApiMutations?.clear(),e.parsetimeApiMutations=null})),[i,r,s,o={}]=W(arguments);let l=new n.MutationObserver(c=>{c.forEach(({target:p,addedNodes:m,removedNodes:d})=>{ie.call(this,i,{target:p,addedNodes:m,removedNodes:d,type:"mutation-record"},{selectors:r,callback:s,params:{deepIntersect:h=>u.readyState!=="loading"||e.parsetimeApiMutations?.has(h),...o}})})}),f=()=>l.observe(i,{childList:!0,subtree:o.subtree});f();let a={disconnect(){return l.disconnect(),{reconnect(){return f(),a}}}};return a}intercept(i,r,s,o={}){if([i,r,s,o={}]=W(arguments),!e.apiMutationsBindings.intercepting){let{document:c}=n;e.apiMutationsBindings.intercepting=!0;let p=m=>{e.apiMutationsBindings.forEach((d,h)=>{d.forEach((O,y)=>{!(m.target===y||h&&(y===c&&m.target.isConnected||y.contains(m.target)))||O.forEach(w=>{m.type==="mutation-record"?w={...w,params:{...w.params,deepIntersect:!1}}:w={...w,params:{deepIntersect:!0,...w.params}},ie.call(this,y,m,w)})})})};if(oe(n,p),c.readyState==="loading"){let m=this.observe(c,d=>{d={target:d.target,incomingNodes:d.addedNodes.filter(h=>!e.parsetimeApiMutations?.has(h)),outgoingNodes:d.removedNodes.filter(h=>!e.parsetimeApiMutations?.has(h)),type:d.type},!(!d.incomingNodes.length&&!d.outgoingNodes.length)&&p(d)},{subtree:!0});c.addEventListener("readystatechange",()=>m.disconnect())}}let u=e.apiMutationsBindings[o.subtree?1:0];u.has(i)||u.set(i,new Set);let l=u.get(i),f={selectors:r,callback:s,params:o};l.add(f);let a={disconnect(){return l.delete(f),l.size||u.delete(i),{reconnect(){return l.size?(l.add(f),a):this.intercept(i,r,s,o)}}}};return a}}};function W(n){return _(n[1])?n=[n[0],[],...[...n].slice(1)]:n[1]=v(n[1],!1),n}function ie(n,e,t){let i,r={...e};["addedNodes","incomingNodes","removedNodes","outgoingNodes"].forEach(s=>{if(!(s in r))return;let o=["removedNodes","outgoingNodes"].includes(s);o&&t.params.on==="connected"||!o&&t.params.on==="disconnected"?r[s]=[]:t.selectors.length?(r[s]=Te.call(this,t.selectors,r[s],t.params.deepIntersect)).length&&(i=!0):(r[s]=[...r[s]],i=!0)}),i&&t.callback(r,n)}function Te(n,e,t){e=Array.isArray(e)?e:[...e];let i=(r,s)=>{if(r=r.filter(o=>o.matches),P(s)){let o=r.filter(u=>u.matches(s));if((t===!0||_(t))&&(o=r.reduce((u,l)=>{let f=_(t)&&!t(l)?[]:l.querySelectorAll(s);return[...u,...f]},o)),o.length)return o}else if(r.includes(s)||(t===!0||_(t))&&r.some(o=>_(t)&&!t(o)?!1:o.contains(s)))return[s]};return e.$$searchCache||(e.$$searchCache=new Map),n.reduce((r,s)=>{let o;return e.$$searchCache.has(s)?o=e.$$searchCache.get(s):(o=i(e,s)||[],x(s)&&e.$$searchCache.set(s,o)),r.concat(o)},[])}function oe(n,e){let t=n.wq;if(t.apiMutationsHooks.add(e),t.apiMutationsHooks.intercepting)return;t.apiMutationsHooks.intercepting=!0,console.warn("DOM mutation APIs are now being intercepted.");let{document:i,Node:r,Element:s,HTMLElement:o}=n,u=f=>{t.apiMutationsHooks.forEach(a=>a(f))},l=Object.create(null);["insertBefore","insertAdjacentElement","insertAdjacentHTML","setHTML","replaceChildren","replaceWith","remove","replaceChild","removeChild","before","after","append","prepend","appendChild"].forEach(f=>{let a=["insertBefore","replaceChild","removeChild","appendChild"].includes(f)?r:s;l[f]=a.prototype[f],l[f]&&(a.prototype[f]=function(...c){let p=()=>l[f].call(this,...c);if(!(this instanceof s))return p();let m=[],d=[],h=this;["insertBefore"].includes(f)?d=[c[0]]:["insertAdjacentElement","insertAdjacentHTML"].includes(f)?(d=[c[1]],["beforebegin","afterend"].includes(c[0])&&(h=this.parentNode)):["setHTML","replaceChildren"].includes(f)?(m=[...this.childNodes],d=f==="replaceChildren"?[...c]:[c[0]]):["replaceWith","remove"].includes(f)?(m=[this],d=f==="replaceWith"?[...c]:[],h=this.parentNode):["replaceChild"].includes(f)?(m=[c[1]],d=[c[0]]):["removeChild"].includes(f)?m=[...c]:(d=[...c],["before","after"].includes(f)&&(h=this.parentNode));let O=f;if(["insertAdjacentHTML","setHTML"].includes(f)){let y=this.nodeName;if(f==="insertAdjacentHTML"&&["beforebegin","afterend"].includes(c[0])){if(!this.parentNode)return l[f].call(this,...c);y=this.parentNode.nodeName}let w=i.createElement(y);l.setHTML.call(w,d[0],f==="setHTML"?c[1]:{}),d=[...w.childNodes],f==="insertAdjacentHTML"?(O="insertAdjacentElement",c[1]=new DocumentFragment,c[1].append(...w.childNodes)):(O="replaceChildren",c=[...w.childNodes])}return u({target:h,incomingNodes:d,outgoingNodes:m,type:"interception-record",event:[this,f]}),l[O].call(this,...c)})}),["outerHTML","outerText","innerHTML","innerText","textContent","nodeValue"].forEach(f=>{let a=["textContent","nodeValue"].includes(f)?r:["outerText","innerText"].includes(f)?o:s;l[f]=Object.getOwnPropertyDescriptor(a.prototype,f),Object.defineProperty(a.prototype,f,{...l[f],set:function(c){let p=()=>l[f].set.call(this,c);if(!(this instanceof s))return p();let m=[],d=[],h=this;if(["outerHTML","outerText"].includes(f)?(m=[this],h=this.parentNode):m=[...this.childNodes],["outerHTML","innerHTML"].includes(f)){let O=this.nodeName;if(f==="outerHTML"){if(!this.parentNode)return p();O=this.parentNode.nodeName}let y=i.createElement(O);l[f].set.call(y,c),d=[...y.childNodes],f==="outerHTML"?(c=new DocumentFragment,c.append(...y.childNodes),p=()=>l.replaceWith.call(this,c)):p=()=>l.replaceChildren.call(this,...y.childNodes)}return u({target:h,incomingNodes:d,outgoingNodes:m,type:"interception-record",event:[this,f]}),p()}})}),["append","prepend"].forEach(f=>{let a=i[f];i[f]=function(...c){return u({target:i,incomingNodes:c,outgoingNodes:[],type:"interception-record",event:[i,f]}),a.call(this||i,...c)}})}var fe=n=>class{constructor(t=!0){Object.defineProperty(this,"window",{value:n}),Object.defineProperty(this,"readCallbacks",{value:new Set}),Object.defineProperty(this,"writeCallbacks",{value:new Set}),this.async=t,this.window.requestAnimationFrame?this._run():this.async=!1}_run(){this.window.requestAnimationFrame(()=>{this.readCallbacks.forEach(t=>{t()||this.readCallbacks.delete(t)}),this.writeCallbacks.forEach(t=>{t()||this.writeCallbacks.delete(t)}),this._run()})}onread(t,i=!1){if(i)return new Promise((r,s)=>{this.async===!1?t(r,s):this.readCallbacks.add(()=>{t(r,s)})});this.async===!1?t():this.readCallbacks.add(t)}onwrite(t,i=!1){if(i)return new Promise((r,s)=>{this.async===!1?t(r,s):this.writeCallbacks.add(()=>{t(r,s)})});this.async===!1?t():this.writeCallbacks.add(t)}cycle(t,i,r){this.onread(()=>{let s=t(r),o=u=>{u!==void 0&&this.onwrite(()=>{let l=i(u,r),f=a=>{a!==void 0&&this.cycle(t,i,a)};l instanceof Promise?l.then(f):f(l)})};s instanceof Promise?s.then(o):o(s)})}};function ue(){Pe.call(this),Fe.call(this),Ne.call(this)}function Pe(){let n=this;n.CSS||(n.CSS={}),n.CSS.escape||(n.CSS.escape=e=>e.replace(/([\:@\~\$\&])/g,"\\$1"))}function Fe(){let n=this;"isConnected"in n.Node.prototype||Object.defineProperty(n.Node.prototype,"isConnected",{get:function(){return!this.ownerDocument||!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}function Ne(){let n=this;n.Element.prototype.matches||(n.Element.prototype.matches=n.Element.prototype.matchesSelector||n.Element.prototype.mozMatchesSelector||n.Element.prototype.msMatchesSelector||n.Element.prototype.oMatchesSelector||n.Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),i=t.length;--i>=0&&t.item(i)!==this;);return i>-1})}function le(){let n=this;if(n.wq||(n.wq={}),n.wq.dom)return n.wq.dom;n.wq.dom={},ue.call(n);let e=fe(n);n.wq.dom.Reflow=new e;let t=se(n);return n.wq.dom.Realtime=new t,n.wq.dom.ready=qe.bind(n),n.wq.dom.meta=Ie.bind(n),n.wq.dom}function qe(n){let e=this;e.document.readyState==="complete"?n(e):(e.document.domReadyCallbacks||(e.document.domReadyCallbacks=[],e.document.addEventListener("DOMContentLoaded",()=>{e.document.domReadyCallbacks.splice(0).forEach(t=>t(e))},!1)),e.document.domReadyCallbacks.push(n))}function Ie(n,e=!1){let t=this,i={content:{}};return!(i.el=t.document.querySelector(`meta[name="${n}"]`))&&e&&(i.el=t.document.createElement("meta"),i.el.setAttribute("name",n),t.document.head.append(i.el)),i.el&&(i.content=(i.el.getAttribute("content")||"").split(";").filter(r=>r).reduce((r,s)=>{let o=s.split("=").map(u=>u.trim());return J(r,o[0].split("."),o[1]==="true"?!0:o[1]==="false"?!1:S(o[1])?parseInt(o[1]):o[1]),r},{})),i.get=function(r){return JSON.parse(JSON.stringify(F(this.content,r.split("."))))},i.copy=function(){return JSON.parse(JSON.stringify(this.content))},i.copyWithDefaults=function(...r){return r.length?$(!0,{},...r.reverse().concat(this.content)):this.copy()},i}function ce(n={}){return{runtimeParams:{...Le,...n.runtimeParams||{}},compilerParams:{...$e,...n.compilerParams||{}},parserParams:{...je,...n.parserParams||{}}}}var je={ecmaVersion:"2020",allowReturnOutsideFunction:!0,allowAwaitOutsideFunction:!0,allowSuperOutsideMethod:!0,preserveParens:!1,locations:!1},$e={globalsNoObserve:["globalThis","arguments","console"],originalSource:!0,globalsOnlyPaths:!1,locations:!0,compact:2},Le={apiVersion:1};function ae(n,e=!1){let t=n.split(/\n/g);if(t.length>1){for(;!t[0].trim().length;)t.shift();let i=t[e?1:0].split(/[^\s]/)[0].length;if(i)return t.map((r,s)=>{let o=r.substring(0,i);return o.trim().length?o.trim()==="}"&&s===t.length-1?"}":r:r.substring(i)}).join(`
`)}return n}var C=(n,e)=>n instanceof Promise?n.then(e):e(n);var pe=new Map;function q(n,e,t=void 0){let i=pe.get(n);if(arguments.length>2){i||(i=new Map,pe.set(n,i)),i.set(e,t);return}return i&&i.get(e)}var M=class{constructor(e,t,i,r={},s=null,o=null){this.ownerContract=e,this.graph=t,this.callee=i,this.params=e?r:{...r,isSubscriptFunction:!0},this.exits=o||new Map,this.$thread=s||{entries:new Map,sequence:[],ownerContract:this},this.subContracts=new Map,this.observers=[],this.contract=function(u,l,f=null,a=null){if(!this.graph.subContracts[u])throw new Error(`[${this.graph.type}:${this.graph.lineage}]: Graph not found for child contract ${u}.`);let c=this.graph.subContracts[u],p={...this.params,isIterationContract:arguments.length===3,iterationId:arguments.length===3&&l,isFunctionContract:arguments.length===4,functionType:arguments.length===4&&l,isSubscriptFunction:arguments.length===4&&f,functionScope:this.params.isFunctionContract&&this.graph.lineage||this.params.functionScope};if(p.isIterationContract){let O=f,y=new M(this,c,O,p,this.$thread,this.exits),w=this.subContracts.get(u);return w||(w=new Map,this.subContracts.set(u,w)),w.has(p.iterationId)&&w.get(p.iterationId).dispose(),w.set(p.iterationId,y),y.call()}let m,d,h;if(this.subContracts.has(u)&&this.subContracts.get(u).dispose(),p.isFunctionContract){m=a;let O=()=>new M(this,c,m,p);if(p.functionType!=="FunctionDeclaration")h=this.createFunction(O);else{let y=O();p.apiVersion>1?(h=function(...w){let T=y.call(this,...w);return T=C(T,Z=>[T,y.thread.bind(y),y]),y=O(),T},h.target=y):h=y}}else m=l,d=new M(this,c,m,p,this.$thread,this.exits),this.subContracts.set(u,d),h=d.call();return h}.bind(this),this.contract.memo=Object.create(null),this.ownerContract&&!["FunctionDeclaration","FunctionExpression"].includes(this.graph.type)&&(this.contract.args=this.ownerContract.contract.args),this.contract.exiting=function(u,l){if(!arguments.length)return this.exits.size;let f=this.exits.get(u)===l;return f&&this.exits.clear(),f}.bind(this),this.contract.exit=function(u,l){this.exits.set(u,l)}.bind(this),this.contract.functions=new Map,this.contract.functions.declaration=(u,l)=>{this.contract.functions.set(u,l),this.applyReflection(u,typeof l=="function"?l.target:l)}}fire(e,t,i){if(!this.ownerContract)return;let r=this.ownerContract.fire(e,t,i);return this.observers.forEach(s=>{s.contractUrl===e&&s.callback(t,i)}),r}observe(e,t){!this.params.isFunctionContract||this.observers.push({contractUrl:e,callback:t})}call(e,...t){if(this.disposed)throw new Error(`[${this.graph.type}:${this.graph.lineage}]: Instance not runable after having been disposed.`);this.ownerContract||(this.contract.args=t,Object.defineProperty(this.contract.args,Symbol.toStringTag,{value:"Arguments"}));let i=this.callee.call(e,this.contract,...t);if(this.graph.$sideEffects)for(let r in this.graph.effects)for(let s of this.graph.effects[r].refs)this.buildThread([],s,[],0,!0);return C(i,()=>{if(!this.ownerContract||this.params.isFunctionContract){let r=this.exits.get("return");if(this.exits.clear(),r!==void 0)return r}return i})}iterate(e=[]){if(this.disposed)return!1;if(!["ForOfStatement","ForInStatement"].includes(this.graph.type)||this.subContracts.size!==1)throw new Error(`Contract ${this.graph.lineage} is not an iterator.`);let[[,t]]=this.subContracts,i;if(!e.length||e.includes("length")&&this.graph.type==="ForOfStatement")for(let[,r]of t)i=C(i,()=>r.call());else for(let r of e){let s=t.get(r)||t.get(parseInt(r));!s||(i=C(i,()=>s.call()))}return i}thread(...e){if(this.disposed)return!1;this.$thread.active=!0;for(let t in this.graph.effects)for(let i of this.graph.effects[t].refs)for(let r of e){let[s,o,u]=this.matchRefs(r,i);!s||this.buildThread(r,i,u,o)}return this.runThread()}runThread(){let e=(s,o)=>{if(["ForOfStatement","ForInStatement"].includes(s.graph.type)&&o.every(u=>u.executionPlan.isIterationContractTarget)){let u=o.map(l=>l.executionPlan.iterationTarget);return this.fire(s.graph.lineage,"iterating",o),s.iterate(u)}return this.fire(s.graph.lineage,"executing",o),s.call()},t,i,r;for(;(i=this.$thread.sequence.shift())&&(r=[...this.$thread.entries.get(i)])&&this.$thread.entries.delete(i);)t=C(t,()=>{if(i.disposed||!i.filterRefs(r).length)return;this.$thread.current=i;let s=e(i,r);return C(s,()=>{for(let o of r)[].concat(o.executionPlan.assigneeRef||o.executionPlan.assigneeRefs||[]).forEach(u=>{i.buildThread([],u,[],0)})}),s});return C(t,()=>{let s=this.exits.get("return");return this.exits.clear(),this.$thread.current=null,this.$thread.active=!1,s})}buildThread(e,t,i,r=0,s=!1){let o=r>0;if(this.ownerContract){if(!this.compute(i)||t.condition!==void 0&&!this.assert(t.condition))return}else o||(o=i.length||t.condition!==void 0);let u=s?t.$subscriptions:t.subscriptions;Object.keys(u).forEach(l=>{let[f,a]=l.split(":"),c=m=>{!m||m.selectRefs(a,u[l],o?e:null)},p=this.locate(f);Array.isArray(p)?p.forEach(c):c(p)})}selectRefs(e,t,i=null){let r=this.$thread,s=this.graph.signals[e],o=(l,f)=>l.graph.lineage.localeCompare(f.graph.lineage,void 0,{numeric:!0}),u=(l,f=[],a={})=>{if(!r.active||r.current&&o(this,r.current)<0)return;let c=r.entries.get(this);if(c||(c=new Set,r.entries.set(this,c),r.sequence.push(this),r.sequence.sort(o)),c.add({...l,computes:f,executionPlan:a}),!a.assigneeRef&&["VariableDeclaration","AssignmentExpression"].includes(this.graph.type)){a.assigneeRefs=[];for(let p in this.graph.effects)a.assigneeRefs.push(...this.graph.effects[p].refs)}};for(let l of t){let f=s.refs[l];if(!i){u(f);continue}let[a,c,p]=this.matchRefs(i,f);if(!a)continue;if(c<=0){u(f,p);continue}let m=i.slice(-c),d="assignee"in s?this.graph.effects[s.assignee]:null;if(d){d.refs.forEach(h=>{if(h.depth.length){let[O,y,w]=this.matchRefs(m,h.depth),T=p.concat(w);if(O&&y>0){let Z=h.path.concat(m.slice(-y));this.buildThread(Z,h,T,y)}else O&&u(f,T,{assigneeRef:h})}else{let O=h.path.concat(m);this.buildThread(O,h,p,c)}});continue}if(c===1&&this.graph.type==="ForOfStatement"){u(f,p,{isIterationContractTarget:!0,iterationTarget:m[0]});continue}if(c===1&&this.graph.type==="ForInStatement"){u(f,p,{isIterationContractTarget:!0,iterationTarget:m[0]});continue}}}filterRefs(e){return e.filter(t=>{if(!!this.compute(t.computes)&&!(t.condition!==void 0&&!this.assert(t.condition)))return!0})}matchRefs(e,t){let i,r,s,o;Array.isArray(e)?(i=e,r=e.dotSafe?e.join("."):void 0):(i=e.path,r=e.$path),Array.isArray(t)?(s=t,o=t.dotSafe?t.join("."):void 0):(s=t.path,o=t.$path);let u=i.length-s.length;if(u>0&&([i,s,r,o]=[s,i,o,r]),r&&o)return[`${o}.`.startsWith(`${r}.`),u,[]];let l=[],f=c=>typeof c=="object"?c.name:c,a=(c,p)=>{if(!c||!p)return!1;let m=typeof c=="object"&&"memoId"in c,d=typeof p=="object"&&"memoId"in p;return m||d?(l.push(h=>(m?h[c.memoId]:f(c))===(d?h[p.memoId]:f(p))),!0):f(c)===f(p)};return[i.reduce((c,p,m)=>c&&a(p,s[m]),!0),u,l]}locate(e){let t=this.graph.lineage+"/",i=e+"/";if(i===t)return this;if(i.startsWith(t)){let r=e.slice(t.length).split("/"),s=this.subContracts.get(parseInt(r.shift()));if(r.length){if(s instanceof Map)return Array.from(s).reduce((o,[u,l])=>o.concat(l.locate(e)),[]);if(s)return s.locate(e)}return s}if(this.ownerContract)return this.ownerContract.locate(e)}compute(e){return!e.some(t=>t(this.contract.memo)===!1)}assert(e){if(typeof e=="string"&&e.includes(":")){let[r,s]=e.split(":");return this.locate(r).assert(s)}let t=this.graph.conditions[e],i=this.contract.memo;return typeof t.parent<"u"&&!this.assert(t.parent)?!1:typeof t.switch<"u"?t.cases.some(r=>i[r]===i[t.switch]):typeof t.whenNot<"u"?!i[t.whenNot]:typeof t.when<"u"?i[t.when]:!0}dispose(){this.params.isFunctionContract||(this.subContracts.forEach((e,t)=>{e instanceof Map?(e.forEach(i=>i.dispose()),e.clear()):e.dispose()}),this.subContracts.clear(),delete this.ownerContract,delete this.callee,delete this.params,delete this.contract.memo,this.disposed=!0)}createFunction(e,t=void 0){let i=e(),r=function(o,...u){let l=o.call(this===void 0?t:this,...u);return o.params.isSubscriptFunction&&o.params.apiVersion>1&&(l=C(l,f=>[f,o.thread.bind(o),o]),i=e(i)),l},s=i instanceof Promise||i.callee instanceof async function(){}.constructor?async function(){return C(i,o=>r.call(this,o,...arguments))}:function(){return r.call(this,i,...arguments)};return C(i,o=>{this.applyReflection(s,o)}),q(s,"properties",C(i,o=>{let u={type:o.params.functionType||"Program",isSubscriptFunction:o.params.isSubscriptFunction,sideEffects:o.graph.sideEffects||!1};if(o.params.isSubscriptFunction){u.dependencies=[];for(let[l,f]of Object.entries(o.graph.effects))u.dependencies.push(...f.refs.map(a=>a.path.map(c=>c.name)))}return u})),s}applyReflection(e,t){Object.defineProperty(t.callee,"length",{configurable:!0,value:t.callee.length-1});let i=t.callee.toString();Object.defineProperty(t.callee,"toString",{configurable:!0,value:(s=!1)=>!s&&t.graph.originalSource?t.graph.originalSource:i});let r={name:t.callee.name,length:t.callee.length,toString:t.callee.toString};t.params.isSubscriptFunction&&(t.params.apiVersion>1||(r={...r,thread:t.thread.bind(t),dispose:t.dispose.bind(t),runtime:t})),Object.keys(r).forEach(s=>{Object.defineProperty(e,s,{configurable:!0,value:r[s]})})}};var L=class extends M{static create(e,t=[],i={}){let s=i.async||e.graph.hoistedAwaitKeyword?Object.getPrototypeOf(async function(){}).constructor:Function,o=i.compileFunction?i.compileFunction(e.source,[e.identifier+""].concat(t)):new s(e.identifier+"",...t,e.source);return new this(null,e.graph,o,i)}static createFunction(e,t,i=[],r={},s,o=null){r={...r,functionType:"Constructor"},t instanceof Promise&&(r={...r,async:!0});let u=a=>a?new this(null,a.graph,a.callee,r):C(t,c=>l(this.create(c,i,r))),l=a=>{if(a.graph.originalSource&&!a.graph.originalSourceModified){let c=`${r.async||a.graph.hoistedAwaitKeyword?"async ":""}function ${e||"anonymous"}`,p=a.graph.originalSource.split(/\n/g).map(m=>`    ${m}`).join(`
`);a.graph.originalSource=`${c}(${i.join(", ")}) {
${p}
}`,a.graph.originalSourceModified=!0}return e&&Object.defineProperty(a.callee,"name",{configurable:!0,value:e}),a},f=this.prototype.createFunction(u,s);return q(f,"locations",C(t,a=>({locations:a.locations}))),f}};function B(...n){if(typeof window!="object")throw new Error("No window in context.");let e=ce(typeof n[n.length-1]=="object"?n.pop():{}),t=ae(n.pop()||""),i=n,r=s=>L.createFunction(void 0,s,i,e.runtimeParams,this,t);if(window.wq?.SubscriptCompiler&&!e.runtimeParams.async){let{parse:s,compile:o}=window.wq.SubscriptCompiler,u=s(t,e.parserParams);return r(o(u,e.compilerParams))}if(!window.wq?.SubscriptCompilerWorker){let u=`
        importScripts( '${document.querySelector('meta[name="subscript-compiler-url"]')?.content||"https://unpkg.com/@webqit/subscript/dist/compiler.js"}' );
        const { parse, compile } = self.wq.SubscriptCompiler;
        self.onmessage = e => {
            const { source, params } = e.data;
            const ast = parse( source, params.parserParams );
            const compilation = compile( ast, params.compilerParams );
            compilation.identifier = compilation.identifier.toString();
            e.ports[ 0 ]?.postMessage( compilation );
        };`;window.wq=window.wq||{},window.wq.SubscriptCompilerWorker=new Worker(`data:text/javascript;base64,${btoa(u)}`)}return r(new Promise(s=>{let o=new MessageChannel;wq.SubscriptCompilerWorker.postMessage({source:t,params:e},[o.port2]),o.port1.onmessage=u=>s(u.data)}))}Object.defineProperty(B,"inspect",{value:q});function Y(n={}){let e=this,i=le.call(e).meta("oohtml").copyWithDefaults(n,{selectors:{script:'script[type="subscript"]'},retention:"retain"});Re.call(this,i)}function Re(n){let e=this,{dom:t}=e.wq;e.wq.transformCache=new Map,e.wq.compileCache=[new Map,new Map];let i=()=>{};t.Realtime.intercept(e.document,"script[scoped],script[contract]",r=>{r.incomingNodes.forEach(s=>{if("contract"in s||(Object.defineProperty(s,"contract",{value:s.hasAttribute("contract")}),"scoped"in s))return i(s);Object.defineProperty(s,"scoped",{value:s.hasAttribute("scoped")});let o=s.scoped?r.target:s.type==="module"?void 0:e;We.call(this,s,o,n)})},{subtree:!0,on:"connected"}),e.wq.exec=r=>{let s=ze(r);if(!s)throw new Error("Argument must be a valid exec hash.");let{script:o,compiledScript:u,thisContext:l}=s;switch(l instanceof e.Element&&o.scoped&&(l.scripts||Object.defineProperty(l,"scripts",{value:new Set}),l.scripts.add(o)),n.retention){case"dispose":o.remove();break;case"hidden":o.textContent='"hidden"';break;default:o.textContent=u.function.originalSource}return He.call(this,u,l,o)}}function He(n,e,t){if(!n.function)throw new Error("Input script must already be compiled!");let i=n.function.call(e);n.contract&&Object.defineProperty(t,"sync",{value:(...u)=>Qe(i,([,l])=>l(...u))});let r=this,{dom:s}=r.wq;if(!(e instanceof r.EventTarget))return i;let o;return t.contract&&(o=u=>{t.sync()},e.addEventListener("namespacechange",o),e.addEventListener("statechange",o)),s.Realtime.intercept(r.document,e,()=>{t.contract&&(e.removeEventListener("namespacechange",o),e.removeEventListener("statechange",o)),e.dispatchEvent(new r.CustomEvent("beforeremove")),e.scripts.delete(t)},{subtree:!0,on:"disconnected"}),t}function We(n,e,t={}){let i=this.wq,r=i.compileCache[n.contract?0:1],s=me(n.textContent),o=n.textContent,u;if(!(u=r.get(s))){let f=[],a={},c=[];n.type==="module"&&c.push("import "),n.type==="module"&&!n.contract&&c.push("await "),c.length&&new RegExp(c.join("|")).test(o)&&([f,o,a]=Be(o),f.length&&(o=`
	${De(f).join(`
	`)}
	${o}
`));let p;if(n.contract){let m={...t.parserParams||{},allowReturnOutsideFunction:!1,allowAwaitOutsideFunction:n.type==="module",allowSuperOutsideMethod:!1},d={...t.runtimeParams||{},async:n.type==="module",apiVersion:2};p=B(o,{...t,parserParams:m,runtimeParams:d})}else{let d=n.type==="module"?Object.getPrototypeOf(async function(){}).constructor:Function;p=t.runtimeParams?.compileFunction?t.runtimeParams.compileFunction(o):new d(o),Object.defineProperty(p,"originalSource",{configurable:!0,value:n.textContent})}u=Object.defineProperty(n.cloneNode(),"function",{value:p}),n.scoped&&Object.defineProperty(u,"scoped",Object.getOwnPropertyDescriptor(n,"scoped")),n.contract&&Object.defineProperty(u,"contract",Object.getOwnPropertyDescriptor(n,"contract")),r.set(s,u)}let l=me({script:n,compiledScript:u,thisContext:e});n.textContent=`wq.exec('${l}');`}function Be(n){let[e,t]=de(n,(o,u,l,f,a,c)=>{if(u==="start-enclosure"&&l==="{"&&!f.openAsync?.type&&f.openEnclosures.length===f.openAsync?.scopeId)f.openAsync.type="block";else if(u==="end-enclosure"&&l==="}"&&f.openAsync?.type==="block"&&f.openEnclosures.length===f.openAsync.scopeId)f.openAsync=null;else if(u==="start-quote"&&!f.openEnclosures.length&&["starting","from"].includes(f.openImport))f.openImport="url";else if(u==="end-quote"&&f.openImport==="url")f.openImport="closing";else if(u==="char"){if(f.openImport==="closing"&&(l===";"||![" ",`
`].includes(l)||c))return l===";"||c?(o[0]+=l,o.unshift("")):o.unshift(l),f.openImport=null,!1;let p=n.substring(a-1);if(!f.openImport&&/^[\W]?import[ ]*[^\(]/.test(p))return f.openImport="starting",o.unshift(""),6;if(f.openImport==="starting"&&/^[\W]?from /.test(p))return f.openImport="from",4;if(!f.openAsync){if(/^[\W]?async /.test(p))return f.openAsync={scopeId:f.openEnclosures.length},5;if(/^[\W]?await /.test(p))return f.topLevelAwait=!0,5}f.openAsync&&(!f.openAsync.type&&/.?\=\>[ ]*?\{/.test(p)?f.openAsync.type="inline-arrow":f.openAsync.type==="inline-arrow"&&[`
`,";"].includes(l)&&f.openEnclosures.length===f.openAsync.scopeId&&(f.openAsync=null))}}),i=[],r="",s;for(let o of e.reverse())(s=o.trim()).startsWith("import ")?i.push(o):s&&(r+=o);return[i,r,t]}function De(n){let e=[],t=[];return n.forEach((i,r)=>{i=Ve(i);let[s,o]=i.items.reduce(([u,l],f)=>f.id==="*"?[f.alias,l]:[u,l.concat(f)],[null,[]]);if(s&&e.push(`const ${s} = __$imports$__[${r}];`),o.length){let u=o.map(l=>`${l.id}${l.id!==l.alias?`: ${l.alias}`:""}`).join(", ");e.push(`const { ${u} } = __$imports$__[${r}];`)}t.push(`import("${i.url}")`)}),[`
	const __$imports$__ = await Promise.all([
		${t.join(`,
		`)}
	]);`,e.join(`
	`)]}function Ve(n){let e=r=>{let s=/^[`'"]/.exec(r);return s&&r.substring(1,r.lastIndexOf(s[0]))},t={items:[{id:""}]},i=n.replace("import","").trim();return(t.url=e(i))||de(i,(r,s,o,u,l,f)=>{if(["start-quote","ongoing-quote","end-quote","char"].includes(s)){if(t.url)return;if(!u.openQuote){let a=i.substring(l);if(o===","){t.items.unshift({id:""});return}if(a.startsWith(" as "))return t.items[0].alias="",3;if(a.startsWith(" from "))return t.url=e(a.replace("from","").trim()),a.length}"alias"in t.items[0]?t.items[0].alias+=o:(t.items[0].id+=o,u.openEnclosures.length&&(t.items[0].enclosed=!0))}}),t.items=t.items.map(r=>({id:r.id&&!r.alias&&!r.enclosed?"default":r.id.trim(),alias:r.alias?r.alias.trim():r.id.trim()})).filter(r=>r.id).reverse(),t}function de(n,e){let t=n.length-1;return[...n].reduce(([i,r,s],o,u)=>{if(s)return i[0]+=o,[i,r,--s];let l;if(r.openQuote||r.openComment)return o===r.openQuote?(r.openQuote=null,l=e(i,"end-quote",o,r,u,u===t)):r.openQuote?l=e(i,"ongoing-quote",o,r,u,u===t):r.openComment&&(r.openComment==="//"&&o===`
`||r.openComment==="/*"&&i[0].substr(-1)==="*"&&o==="/")&&(r.openComment=null,l=e(i,"end-comment",o,r,u,u===t)),l!==!1&&(i[0]+=o),[i,r,typeof l=="number"?l:s];let f;return(f=["()","{}","[]"].filter(a=>o===a[0])[0])?(l=e(i,"start-enclosure",o,r,u,u===t),r.openEnclosures.unshift(f)):r.openEnclosures.length&&o===r.openEnclosures[0][1]?(r.openEnclosures.shift(),l=e(i,"end-enclosure",o,r,u,u===t)):['"',"'","`"].includes(o)?(l=e(i,"start-quote",o,r,u,u===t),r.openQuote=o):!r.openComment&&["/*","//"].includes(n.substr(u,2))?(l=e(i,"start-comment",o,r,u,u===t),r.openComment=n.substr(u,2)):l=e(i,"char",o,r,u,u===t),l!==!1&&(i[0]+=o),[i,r,typeof l=="number"?l:s]},[[""],{openEnclosures:[]},0])}var X=new Map,Ue=()=>(0|Math.random()*9e6).toString(36),Qe=(n,e)=>n instanceof Promise?n.then(e):e(n);function me(n){let e;return(e=X.get(n))||(e=Ue(),X.set(n,e)),e}function ze(n){let e;return X.forEach((t,i)=>{t===n&&(e=i)}),e}Y.call(window);})();
//# sourceMappingURL=scoped-js.js.map
