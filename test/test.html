<!DOCTYPE html>
<html>
    <head>
        <meta name="oohtml" content="script.retention=hidden" />
        <script src="https://unpkg.com/@webqit/oohtml/dist/main.js"></script>
        <script>
            window.extVar = 'External variable initial value.';
            window.Observer = wq.Observer;
        </script>
        <template exportid="temp0">
            <input exportid="input" />
            <template exportid="temp1">
                <textarea exportid="input"></textarea>
                <template exportid="temp2">
                    <select exportid="input"></select>
                </template>
                <template exportid="temp2b" inherits="#input"></template>
                <template exportid="temp2c">
                    <textarea exportid="input"></textarea>
                </template>
            </template>
        </template>
    </head>
    <body>

        <div importscontext="temp0/temp1">
            <textarea exportid="input"></textarea>
            <!--<import module="#input"></import>-->
        </div>

        <div id="div1">
            [1]: Scoped contract script here! See the console.
            <script type="module" scoped contract>
                console.log( '[1]: Execution context: ' + this.tagName, this.someProp );
                console.log( '[1]: Dependencies: ', ( await [ ...this.scripts ][ 0 ].properties ).dependencies );
                console.log( `[1]: ${ extVar }` );
                this.addEventListener( 'remove', e => { console.log( '[1]: Removing...' ); } );
                setTimeout( () => { this.remove(); }, 10000 );
            </script>
        </div>

        <div id="div2">
            [2]: Scoped contract script here! See the console.
            <script type="module" scoped contract>
                console.log( '[2]: Execution context: ', this.tagName );
                console.log( '[2]: Dependencies: ', ( await [ ...this.scripts ][ 0 ].properties ).dependencies );
                console.log( `[2]: ${ extVar }` );
                this.addEventListener( 'remove', e => { console.log( '[2]: Removing...' ); } );
                setTimeout( () => { this.remove(); }, 10000 );
            </script>
        </div>

        <script>
            const div1 = document.querySelector( '#div1' );
            setTimeout( () => {
                Observer.set( globalThis, 'extVar', 'External variable updated value!' );
                Observer.set( div1, 'someProp', 'someProp value!' );
                setTimeout( () => {
                    Observer.set( globalThis, 'extVar', 'External variable updated value again!' );
                }, 6000 );
                /*
                extVar = 'External variable updated value!';
                div1.scripts.forEach( script => {
                    script.rerender( [ 'extVar' ] );
                } );
                */
            }, 5000 );
        </script>
        
    </body>
</html>